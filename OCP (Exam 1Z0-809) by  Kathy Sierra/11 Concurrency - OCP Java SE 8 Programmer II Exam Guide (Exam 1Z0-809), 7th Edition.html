<!--[if IE]><![endif]-->
<!DOCTYPE html>
<!--[if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/ocp-java-se/9781260117370/ch3.xhtml"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3340835"
  data-user-uuid="47f1b03c-b626-4c20-9277-e4d681dbf059"
  data-username="mayurshahapure1"
  data-account-type="Trial"
  
  data-activated-trial-date="09/06/2018"


  data-archive="9781260117370"
  data-publishers="McGraw-Hill"



  data-htmlfile-name="ch3.xhtml"
  data-epub-title="OCP Java SE 8 Programmer II Exam Guide (Exam 1Z0-809), 7th Edition" data-debug=0 data-testing=0><![endif]-->
<!--[if gt IE 8]><!-->
<html class=" js flexbox flexboxlegacy no-touch no-websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg no-zoom" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/ocp-java-se/9781260117370/ch3.xhtml" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="3340835" data-user-uuid="47f1b03c-b626-4c20-9277-e4d681dbf059" data-username="mayurshahapure1" data-account-type="Trial" data-activated-trial-date="09/06/2018" data-archive="9781260117370" data-publishers="McGraw-Hill" data-htmlfile-name="ch3.xhtml" data-epub-title="OCP Java SE 8 Programmer II Exam Guide (Exam 1Z0-809), 7th Edition" data-debug="0" data-testing="0" style="" lang="en"><!--<![endif]--><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Safari Books Online"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781260117370"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><script type="text/javascript" async="" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/cool-2.js"></script><script type="text/javascript" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/510f1a6865"></script><script src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/nr-1071.js"></script><script src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/1732687426968531.js" async=""></script><script async="" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/fbevents.js"></script><script type="text/javascript" async="" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/bat.js"></script><script type="text/javascript" async="" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/conversion_async.js"></script><script type="text/javascript" async="" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/insight.js"></script><script type="text/javascript" async="" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/conversion_async.js"></script><script type="text/javascript" async="" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/linkid.js"></script><script async="" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/gtm.js"></script><script async="" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/analytics.js"></script><script type="text/javascript">window.NREUM||(NREUM={}),__nr_require=function(e,t,n){function r(n){if(!t[n]){var o=t[n]={exports:{}};e[n][0].call(o.exports,function(t){var o=e[n][1][t];return r(o||t)},o,o.exports)}return t[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({1:[function(e,t,n){function r(){}function o(e,t,n){return function(){return i(e,[f.now()].concat(u(arguments)),t?null:this,n),t?void 0:this}}var i=e("handle"),a=e(2),u=e(3),c=e("ee").get("tracer"),f=e("loader"),s=NREUM;"undefined"==typeof window.newrelic&&(newrelic=s);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],d="api-",l=d+"ixn-";a(p,function(e,t){s[t]=o(d+t,!0,"api")}),s.addPageAction=o(d+"addPageAction",!0),s.setCurrentRouteName=o(d+"routeName",!0),t.exports=newrelic,s.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(e,t){var n={},r=this,o="function"==typeof t;return i(l+"tracer",[f.now(),e,n],r),function(){if(c.emit((o?"":"no-")+"fn-start",[f.now(),r,o],n),o)try{return t.apply(this,arguments)}catch(e){throw c.emit("fn-err",[arguments,this,e],n),e}finally{c.emit("fn-end",[f.now()],n)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(e,t){m[t]=o(l+t)}),newrelic.noticeError=function(e){"string"==typeof e&&(e=new Error(e)),i("err",[e,f.now()])}},{}],2:[function(e,t,n){function r(e,t){var n=[],r="",i=0;for(r in e)o.call(e,r)&&(n[i]=t(r,e[r]),i+=1);return n}var o=Object.prototype.hasOwnProperty;t.exports=r},{}],3:[function(e,t,n){function r(e,t,n){t||(t=0),"undefined"==typeof n&&(n=e?e.length:0);for(var r=-1,o=n-t||0,i=Array(o<0?0:o);++r<o;)i[r]=e[t+r];return i}t.exports=r},{}],4:[function(e,t,n){t.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(e,t,n){function r(){}function o(e){function t(e){return e&&e instanceof r?e:e?c(e,u,i):i()}function n(n,r,o,i){if(!d.aborted||i){e&&e(n,r,o);for(var a=t(o),u=m(n),c=u.length,f=0;f<c;f++)u[f].apply(a,r);var p=s[y[n]];return p&&p.push([b,n,r,a]),a}}function l(e,t){v[e]=m(e).concat(t)}function m(e){return v[e]||[]}function w(e){return p[e]=p[e]||o(n)}function g(e,t){f(e,function(e,n){t=t||"feature",y[n]=t,t in s||(s[t]=[])})}var v={},y={},b={on:l,emit:n,get:w,listeners:m,context:t,buffer:g,abort:a,aborted:!1};return b}function i(){return new r}function a(){(s.api||s.feature)&&(d.aborted=!0,s=d.backlog={})}var u="nr@context",c=e("gos"),f=e(2),s={},p={},d=t.exports=o();d.backlog=s},{}],gos:[function(e,t,n){function r(e,t,n){if(o.call(e,t))return e[t];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return e[t]=r,r}var o=Object.prototype.hasOwnProperty;t.exports=r},{}],handle:[function(e,t,n){function r(e,t,n,r){o.buffer([e],r),o.emit(e,t,n)}var o=e("ee").get("handle");t.exports=r,r.ee=o},{}],id:[function(e,t,n){function r(e){var t=typeof e;return!e||"object"!==t&&"function"!==t?-1:e===window?0:a(e,i,function(){return o++})}var o=1,i="nr@id",a=e("gos");t.exports=r},{}],loader:[function(e,t,n){function r(){if(!x++){var e=h.info=NREUM.info,t=d.getElementsByTagName("script")[0];if(setTimeout(s.abort,3e4),!(e&&e.licenseKey&&e.applicationID&&t))return s.abort();f(y,function(t,n){e[t]||(e[t]=n)}),c("mark",["onload",a()+h.offset],null,"api");var n=d.createElement("script");n.src="https://"+e.agent,t.parentNode.insertBefore(n,t)}}function o(){"complete"===d.readyState&&i()}function i(){c("mark",["domContent",a()+h.offset],null,"api")}function a(){return E.exists&&performance.now?Math.round(performance.now()):(u=Math.max((new Date).getTime(),u))-h.offset}var u=(new Date).getTime(),c=e("handle"),f=e(2),s=e("ee"),p=window,d=p.document,l="addEventListener",m="attachEvent",w=p.XMLHttpRequest,g=w&&w.prototype;NREUM.o={ST:setTimeout,SI:p.setImmediate,CT:clearTimeout,XHR:w,REQ:p.Request,EV:p.Event,PR:p.Promise,MO:p.MutationObserver};var v=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1071.min.js"},b=w&&g&&g[l]&&!/CriOS/.test(navigator.userAgent),h=t.exports={offset:u,now:a,origin:v,features:{},xhrWrappable:b};e(1),d[l]?(d[l]("DOMContentLoaded",i,!1),p[l]("load",r,!1)):(d[m]("onreadystatechange",o),p[m]("onload",r)),c("mark",["firstbyte",u],null,"api");var x=0,E=e(4)},{}]},{},["loader"]);</script><link rel="apple-touch-icon" href="https://www.safaribooksonline.com/static/images/apple-touch-icon.0c29511d2d72.png"><link rel="shortcut icon" href="https://www.safaribooksonline.com/favicon.ico" type="image/x-icon"><link href="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/css.css" rel="stylesheet" type="text/css"><title>11 Concurrency - OCP Java SE 8 Programmer II Exam Guide (Exam 1Z0-809), 7th Edition</title><link rel="stylesheet" href="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/5e586a47a3b7.css" type="text/css"><link rel="stylesheet" type="text/css" href="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/annotator.css"><link rel="stylesheet" href="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/font-awesome.css"><style type="text/css" title="ibis-book">@page{margin:1.5em}#sbo-rt-content div{margin:0 .5em 0 .5em}#sbo-rt-content img{max-width:98%;max-height:100%}#sbo-rt-content a{text-decoration:none}#sbo-rt-content sup{font-size:.8em}#sbo-rt-content .copyrightt{margin-top:2em;margin-bottom:1em;text-indent:.01em}#sbo-rt-content .copyright{margin-top:.1em;margin-bottom:1em;text-indent:.01em}#sbo-rt-content .h4{font-size:150%;margin-top:1em;margin-bottom:.3em;text-indent:.01em}#sbo-rt-content .black{background-color:#231F20;color:#FFF;padding-left:1em;padding-right:1em;padding-top:.07em;padding-bottom:.07em}#sbo-rt-content .image{margin-top:1em;margin-bottom:1em;text-align:center}#sbo-rt-content .imagef{margin-top:1em;margin-bottom:1.5em;text-align:center}#sbo-rt-content .indent{margin-top:.1em;margin-bottom:.1em;text-indent:1.2em}#sbo-rt-content .indentb{margin-top:.1em;margin-bottom:1em;text-indent:1.2em}#sbo-rt-content .noindent{margin-top:.1em;margin-bottom:.1em;text-indent:.01em}#sbo-rt-content .noindentb{margin-top:.1em;margin-bottom:1em;text-indent:.01em}#sbo-rt-content .bull{margin-top:.1em;margin-bottom:.3em;margin-left:3.5em;text-indent:-1.7em}#sbo-rt-content .bullb{margin-top:.1em;margin-bottom:1em;margin-left:3.5em;text-indent:-1.7em}#sbo-rt-content .que{margin-top:.1em;margin-bottom:.3em;margin-left:2em;text-indent:-1.5em}#sbo-rt-content .que1{margin-top:.1em;margin-bottom:.3em;margin-left:2em;text-indent:-2em}#sbo-rt-content .toc1{margin-top:.7em;margin-bottom:.5em;margin-left:1.8em;text-indent:.01em}#sbo-rt-content .toc2{margin-top:.7em;margin-bottom:.5em;margin-left:1.9em;text-indent:-1.8em}#sbo-rt-content .toc-front{margin-top:1em;margin-bottom:.1em;margin-left:.1em;text-indent:.01em}#sbo-rt-content .toc-1a{margin-top:1em;margin-bottom:.1em;margin-left:1.8em;text-indent:.01em}#sbo-rt-content .toc-chap{margin-top:.7em;margin-bottom:.5em;margin-left:1.8em;text-indent:-1.8em}#sbo-rt-content .toc3{margin-top:.1em;margin-bottom:.1em;margin-left:2.8em;text-indent:-1em}#sbo-rt-content .toc4{margin-top:.1em;margin-bottom:.1em;margin-left:5.8em;text-indent:-1em}#sbo-rt-content .ded{margin-top:4em;margin-bottom:.5em;text-align:center}#sbo-rt-content .side{margin-top:1em;margin-bottom:.01em;background-color:#606163;text-indent:.01em}#sbo-rt-content .figcap1{margin-top:.1em;margin-bottom:1em;text-indent:.01em}#sbo-rt-content .indexmain{margin-top:.1em;margin-bottom:.1em;margin-left:.8em;text-indent:-.8em}#sbo-rt-content .indexsub{margin-top:.1em;margin-bottom:.1em;margin-left:2.4em;text-indent:-.8em}#sbo-rt-content .h2f{font-size:170%;margin-top:2em;margin-bottom:2em;text-indent:.01em}#sbo-rt-content .imaget{margin-top:.2em;margin-bottom:1em;text-indent:.01em}#sbo-rt-content .image-t{margin-top:1em;margin-bottom:1em;text-indent:.01em}#sbo-rt-content .h3{font-size:140%;margin-top:1em;margin-bottom:.3em;text-indent:.01em}#sbo-rt-content .noindent-t{margin-top:1.3em;margin-bottom:.1em;text-indent:.01em}#sbo-rt-content .exercise{text-decoration:underline}#sbo-rt-content .gray{color:#949598}#sbo-rt-content .h2p{font-size:180%;margin-top:2em;margin-bottom:.5em;text-align:left}#sbo-rt-content .h2p1{font-size:160%;margin-top:.5em;margin-bottom:2em;text-align:left}#sbo-rt-content .white{color:#FFF}#sbo-rt-content .title-o{font-size:130%;background-color:#000;font-weight:bold;padding-left:.9em;padding-right:.07em;padding-top:.07em;padding-bottom:.07em}#sbo-rt-content .toc-lq{margin-top:.1em;margin-bottom:.1em;margin-left:.3em;text-indent:.01em}#sbo-rt-content .toc-q{margin-top:.1em;margin-bottom:.1em;margin-left:.01em;text-indent:.01em}#sbo-rt-content .h3-a{font-size:160%;margin-top:1em;margin-bottom:.5em;text-indent:.01em}#sbo-rt-content .figure{background-color:#231F20;color:#FFF;padding-left:.7em;padding-right:1em;padding-top:.07em;padding-bottom:.07em}#sbo-rt-content .bullp{margin-top:.4em;margin-bottom:.4em;margin-left:2.6em;text-indent:.01em}#sbo-rt-content .exam{margin-top:.01em;margin-bottom:1em;background-color:#606163;text-indent:.01em}#sbo-rt-content .side1{margin-top:-1em;margin-bottom:1em;background-color:#EEEFEF;border-bottom:solid .1em;border-right:solid .1em;border-left:solid .1em;text-indent:.01em;padding:.7em}#sbo-rt-content .imagep{margin-top:1em;margin-bottom:1em;text-align:left}#sbo-rt-content .tabcap{margin-top:1em;margin-bottom:.5em;text-indent:.01em}#sbo-rt-content .tabcap1{margin-top:.1em;margin-bottom:1em;text-indent:.01em}#sbo-rt-content .table{background-color:#231F20;color:#FFF;padding-left:.7em;padding-right:1em;padding-top:.07em;padding-bottom:.07em}#sbo-rt-content .text-icon{margin-top:1em;margin-bottom:1em;text-indent:.01em}#sbo-rt-content .text-icon1{margin-top:1em;margin-bottom:1em;margin-left:1em;margin-right:1em;text-indent:.01em}#sbo-rt-content .head-h{font-weight:bold;margin-top:1.5em;margin-bottom:.7em}#sbo-rt-content .white1{padding-left:.5em;padding-top:.5em;padding-bottom:.5em;padding-right:4em;background-color:#000;color:#FFF}#sbo-rt-content .border{margin-top:.1em;margin-bottom:.1em;border-top:solid .2em}#sbo-rt-content .sidebox{margin-top:1em;margin-bottom:.1em;background-color:#E7E7E8;border-right:solid #B2B3B6 .2em;border-left:solid #B2B3B6 .2em;text-indent:.01em}#sbo-rt-content .head{font-size:1.6em;margin-top:1em;margin-bottom:.01em;background-color:#919396;border-bottom:solid #B2B3B6 .2em;border-top:solid #B2B3B6 .2em;text-align:center}#sbo-rt-content .sidebox1{margin-top:-.1em;margin-bottom:1em;background-color:#E7E7E8;border-bottom:solid #B2B3B6 .2em;border-top:solid #B2B3B6 .2em;border-right:solid #B2B3B6 .2em;border-left:solid #B2B3B6 .2em;text-indent:.01em;padding:.8em}#sbo-rt-content .hr{margin-top:.1em;margin-bottom:.1em;border-top:solid #939598 .2em}#sbo-rt-content .bull-image{margin-top:.3em;margin-bottom:.3em;margin-left:2.7em;text-indent:-1.5em}#sbo-rt-content .que-q{margin-top:.3em;margin-bottom:.3em;margin-left:2em;text-indent:-1.5em}#sbo-rt-content .quep{margin-top:.5em;margin-bottom:.5em;margin-left:2em;text-indent:.01em}#sbo-rt-content .que-q1{margin-top:.3em;margin-bottom:.3em;margin-left:2em;text-indent:-2em}#sbo-rt-content .num{margin-top:.5em;margin-bottom:.5em;margin-left:3.5em;text-indent:-1.2em}#sbo-rt-content .nump{margin-top:.5em;margin-bottom:.5em;margin-left:3.5em;text-indent:.01em}#sbo-rt-content .indentt{margin-top:1em;margin-bottom:.1em;text-indent:1.2em}#sbo-rt-content .indenttb{margin-top:1em;margin-bottom:1em;text-indent:1.2em}#sbo-rt-content .bull-image1{margin-top:.3em;margin-bottom:.3em;margin-left:4.1em;text-indent:-1.4em}#sbo-rt-content .alpha-a{margin-top:.1em;margin-bottom:.3em;margin-left:5em;text-indent:-1.5em}#sbo-rt-content .bull1{margin-top:.1em;margin-bottom:.1em;margin-left:4.4em;text-indent:-1.7em}#sbo-rt-content .noindentt{margin-top:1em;margin-bottom:.1em;text-indent:.01em}#sbo-rt-content .cover-image{margin-top:.1em;margin-bottom:.1em;text-align:center}#sbo-rt-content .coverimage{margin-top:.1em;height:98%;margin-bottom:.1em;text-align:center}#sbo-rt-content .inline{vertical-align:middle}#sbo-rt-content .cap-c{margin-top:1em;margin-bottom:1em;text-align:center}#sbo-rt-content .image-c{margin-top:1em;margin-bottom:.1em;text-align:center}#sbo-rt-content .h5{font-size:110%;margin-top:1em;margin-bottom:.3em;text-indent:.01em}#sbo-rt-content .h5a{font-size:110%;margin-top:.3em;margin-bottom:.3em;text-indent:.01em}#sbo-rt-content span.dropcap{font-size:400%;line-height:.8em;margin-top:.01em;margin-bottom:.01em;float:left}#sbo-rt-content .noindent-d{margin-top:2em;margin-bottom:2em;text-indent:.01em}#sbo-rt-content .gray1{font-size:150%;color:#949598}#sbo-rt-content .imagett{margin-top:.1em;margin-bottom:.1em;text-indent:.01em}#sbo-rt-content .toc-l{margin-top:.1em;margin-bottom:.1em;margin-left:3.1em;text-indent:-2.15em}#sbo-rt-content .pre{margin-top:1.5em;margin-bottom:1.5em;text-indent:1.2em}#sbo-rt-content .num-pre{margin-top:.5em;margin-bottom:.5em;margin-left:5em;text-indent:.1em}#sbo-rt-content .h3b{font-size:160%;margin-top:1em;margin-bottom:.2em;text-indent:.01em}#sbo-rt-content .hr{margin-top:.1em;margin-bottom:.1em;border-top:solid #939598 .2em}#sbo-rt-content .imageip{margin-top:1em;margin-bottom:1em;margin-left:1.2em}#sbo-rt-content .imageep{margin-top:1em;margin-bottom:1em;text-align:left}#sbo-rt-content .imageqp{margin-top:1em;margin-bottom:1em;margin-left:3.7em}#sbo-rt-content .imagebp{margin-top:1em;margin-bottom:1em;margin-left:3em}#sbo-rt-content .romani{margin-top:.5em;margin-bottom:.5em;margin-left:5em;text-indent:-1.2em}#sbo-rt-content .romanii{margin-top:.5em;margin-bottom:.5em;margin-left:5.1em;text-indent:-1.6em}#sbo-rt-content .romaniii{margin-top:.5em;margin-bottom:.5em;margin-left:5.1em;text-indent:-1.85em}#sbo-rt-content .alpha-no{margin-top:.3em;margin-bottom:.2em;margin-left:2em;text-indent:.1em}#sbo-rt-content .bq{margin-top:.7em;margin-bottom:.7em;margin-left:1.2em;text-indent:.01em}#sbo-rt-content .bullt{margin-top:1em;margin-bottom:.3em;margin-left:3.5em;text-indent:-1.7em}#sbo-rt-content .bull-image-1{margin-top:.3em;margin-bottom:.3em;margin-left:4.2em;text-indent:-1.5em}#sbo-rt-content .indent1{margin-top:1em;margin-bottom:1em;text-indent:1.2em}#sbo-rt-content .bull-h{margin-top:.4em;margin-bottom:.4em;margin-left:3em;text-indent:.01em}#sbo-rt-content .figcap{margin-top:1.5em;margin-bottom:.5em;text-indent:.01em}#sbo-rt-content .num-bull{margin-top:.5em;margin-bottom:.5em;margin-left:5em;text-indent:-1.8em}#sbo-rt-content .numlist{margin-top:.5em;margin-bottom:.5em;margin-left:3em;text-indent:-1.5em}#sbo-rt-content .numlistt{margin-top:1em;margin-bottom:.5em;margin-left:3em;text-indent:-1.6em}#sbo-rt-content .numlistb{margin-top:.1em;margin-bottom:1em;margin-left:3em;text-indent:-1.6em}#sbo-rt-content .num-pre{margin-top:.5em;margin-bottom:.5em;margin-left:3.4em;text-indent:.1em}#sbo-rt-content .alpha{margin-top:.1em;margin-bottom:.3em;margin-left:3.3em;text-indent:-1.3em}#sbo-rt-content .alpha-no-1{margin-top:.3em;margin-bottom:.2em;margin-left:3.1em;text-indent:.1em}#sbo-rt-content .num-bull-h{margin-top:.5em;margin-bottom:.5em;margin-left:5.3em;text-indent:.01em}#sbo-rt-content .right{margin-top:1em;margin-bottom:1em;text-align:right}#sbo-rt-content .ind-bq{margin-top:.8em;margin-bottom:.8em;margin-left:1.2em;text-indent:.1em}#sbo-rt-content .numlist-no{margin-top:.5em;margin-bottom:.5em;margin-left:2.8em;text-indent:.1em}#sbo-rt-content .numlist-1{margin-top:.5em;margin-bottom:.5em;margin-left:4.7em;text-indent:-1.4em}#sbo-rt-content .alpha-no1{margin-top:.3em;margin-bottom:.2em;margin-left:7.5em;text-indent:.1em}#sbo-rt-content .alpha-no2{margin-top:.3em;margin-bottom:.2em;margin-left:3em;text-indent:.1em}#sbo-rt-content .h3f{font-size:150%;margin-top:1em;margin-bottom:1em;margin-left:4.5em;text-indent:.01em}#sbo-rt-content .ash{background-color:#6d6e71;color:#FFF;padding-left:2.5em;padding-right:2.5em;padding-top:.07em;padding-bottom:.07em}#sbo-rt-content .imagesp{margin-top:1em;margin-bottom:1em;margin-left:2.3em}#sbo-rt-content .alpharp{margin-top:.3em;margin-bottom:.2em;margin-left:3.7em;text-indent:.1em}#sbo-rt-content .bullp{margin-top:.4em;margin-bottom:.4em;margin-left:2.8em;text-indent:.01em}#sbo-rt-content .alpha-not{margin-top:1em;margin-bottom:.2em;margin-left:2em;text-indent:.1em}#sbo-rt-content .side1a{margin-top:-1em;margin-bottom:1em;background-color:#EEEFEF;border-bottom:solid .1em;border-right:solid .1em;border-left:solid .1em;text-indent:1.5em;padding:.7em}#sbo-rt-content .noindent1{margin-top:1em;margin-bottom:1em;text-indent:.01em}#sbo-rt-content .s-bull{margin-top:1em;margin-bottom:.1em;text-indent:.01em}#sbo-rt-content .noindenttb{margin-top:1em;margin-bottom:1em;text-indent:.01em}#sbo-rt-content .queaa{margin-top:.1em;margin-bottom:.3em;margin-left:1.2em;text-indent:0}#sbo-rt-content .quea{margin-top:1em;margin-bottom:1em;text-indent:.01em}#sbo-rt-content .bulln{margin-top:.1em;margin-bottom:.3em;margin-left:7em;text-indent:-1.7em}#sbo-rt-content .bullnt{margin-top:1em;margin-bottom:.3em;margin-left:7em;text-indent:-1.7em}</style><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9781260117370/chapter/ch3.xhtml",
          "book_id": "9781260117370",
          "chapter_uri": "ch3.xhtml",
          "position": 1.6165715305,
          "user_uuid": "47f1b03c-b626-4c20-9277-e4d681dbf059",
          "next_chapter_uri": "/library/view/ocp-java-se/9781260117370/ch4.xhtml"
        
      },
      title: "OCP Java SE 8 Programmer II Exam Guide (Exam 1Z0\u002D809), 7th Edition",
      author_list: "Elisabeth Robson, Bert Bates, Kathy Sierra",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: false,
      show_ios_app_teaser: false
    };
    // ]]></script><script src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/modernizr.js"></script><script>
    
      

      

      
        
          window.PUBLIC_ANNOTATIONS = true;
        
      

      window.MOBILE_PUBLIC_ANNOTATIONS = false;

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

    
      window.PRIVACY_CONTROL_SWITCH = true;
    

    
      window.PUBLISHER_PAGES = true;
    

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "https://www.safaribooksonline.com/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://www.safaribooksonline.com/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch3.xhtml"><meta name="description" content=" 3 Assertions and Java Exceptions CERTIFICATION OBJECTIVES •&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Use try-catch and throw Statements •&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Use catch, Multi-catch, and finally Clauses •&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Use Autoclose Resources with a try-with-resources Statement •&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Create Custom Exceptions and Auto-closeable ... "><meta property="og:title" content="3 Assertions and Java Exceptions"><meta itemprop="isPartOf" content="/library/view/ocp-java-se/9781260117370/"><meta itemprop="name" content="3 Assertions and Java Exceptions"><meta property="og:url" itemprop="url" content="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch3.xhtml"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://www.safaribooksonline.com/library/cover/9781260117370/"><meta property="og:description" itemprop="description" content=" 3 Assertions and Java Exceptions CERTIFICATION OBJECTIVES •&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Use try-catch and throw Statements •&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Use catch, Multi-catch, and finally Clauses •&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Use Autoclose Resources with a try-with-resources Statement •&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Create Custom Exceptions and Auto-closeable ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="McGraw-Hill"><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9781260117370"><meta property="og:book:author" itemprop="author" content="Elisabeth Robson"><meta property="og:book:author" itemprop="author" content="Bert Bates"><meta property="og:book:author" itemprop="author" content="Kathy Sierra"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: &lt;%= font_size %&gt; !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: &lt;%= font_family %&gt; !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: &lt;%= column_width %&gt;% !important; margin: 0 auto !important; }"></style><noscript><meta http-equiv="refresh" content="0; url=/library/no-js/" /></noscript><script type="text/javascript">
    (function(i,s,o,g,r,a,m) {
      i['GoogleAnalyticsObject']=r;
      i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();
      a=s.createElement(o),m=s.getElementsByTagName(o)[0];
      a.async=1;
      a.src=g;
      m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    var matches = document.cookie.match(/BrowserCookie\s*=\s*([a-f0-9\-]{36})/),
      user_uuid = null;

    if (matches && matches.length === 2) {
      user_uuid = matches[1];
    }

  
    ga('create', 'UA-39299553-7', {'userId': '47f1b03c-b626-4c20-9277-e4d681dbf059' });
  

  
    
      ga('set', 'dimension1', 'Trial');
    
  

  ga('set', 'dimension6', user_uuid);

  
    ga('set', 'dimension2', '47f1b03c-b626-4c20-9277-e4d681dbf059');
    
  

  

  

  //enable enhanced link tracking
  ga('require', 'linkid', 'linkid.js');

  // reading interface will track pageviews itself
  if (document.location.pathname.indexOf("/library/view") !== 0) {
    ga('send', 'pageview');
  }
  </script><script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5P4V6Z');
  </script><script defer="defer" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/vendor.js"></script><script defer="defer" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/reader.js"></script><script async="" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/MathJax.js"></script><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 2147483020;
}
.annotator-filter {
  z-index: 2147483010;
}</style><script src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/a_002"></script><script src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/a"></script><style type="text/css" id="kampyleStyle">.noOutline{outline: none !important;}.wcagOutline:focus{outline: 1px dashed #595959 !important;outline-offset: 2px !important;transition: none !important;}</style></head>


<body class="reading sidenav nav-collapsed  scalefonts subscribe-panel library">

    
  
  <noscript> 
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P4V6Z"
            height="0" width="0"
            style="display:none;visibility:hidden">
    </iframe>
  </noscript>
  



    
      <div class="working hide" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        





<a href="#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="https://www.safaribooksonline.com/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>Safari Home Icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M4 9.9L4 9.9 4 18 16 18 16 9.9 10 4 4 9.9ZM2.6 8.1L2.6 8.1 8.7 1.9 10 0.5 11.3 1.9 17.4 8.1 18 8.7 18 9.5 18 18.1 18 20 16.1 20 3.9 20 2 20 2 18.1 2 9.5 2 8.7 2.6 8.1Z"></path><rect x="10" y="12" width="3" height="7"></rect><rect transform="translate(18.121320, 10.121320) rotate(-315.000000) translate(-18.121320, -10.121320) " x="16.1" y="9.1" width="4" height="2"></rect><rect transform="translate(2.121320, 10.121320) scale(-1, 1) rotate(-315.000000) translate(-2.121320, -10.121320) " x="0.1" y="9.1" width="4" height="2"></rect></g></svg><span>Safari Home</span></a></li><li><a href="https://www.safaribooksonline.com/r/" class="t-recommendations-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recommendations icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M50 25C50 18.2 44.9 12.5 38.3 11.7 37.5 5.1 31.8 0 25 0 18.2 0 12.5 5.1 11.7 11.7 5.1 12.5 0 18.2 0 25 0 31.8 5.1 37.5 11.7 38.3 12.5 44.9 18.2 50 25 50 31.8 50 37.5 44.9 38.3 38.3 44.9 37.5 50 31.8 50 25ZM25 3.1C29.7 3.1 33.6 6.9 34.4 11.8 30.4 12.4 26.9 15.1 25 18.8 23.1 15.1 19.6 12.4 15.6 11.8 16.4 6.9 20.3 3.1 25 3.1ZM34.4 15.6C33.6 19.3 30.7 22.2 27.1 22.9 27.8 19.2 30.7 16.3 34.4 15.6ZM22.9 22.9C19.2 22.2 16.3 19.3 15.6 15.6 19.3 16.3 22.2 19.2 22.9 22.9ZM3.1 25C3.1 20.3 6.9 16.4 11.8 15.6 12.4 19.6 15.1 23.1 18.8 25 15.1 26.9 12.4 30.4 11.8 34.4 6.9 33.6 3.1 29.7 3.1 25ZM22.9 27.1C22.2 30.7 19.3 33.6 15.6 34.4 16.3 30.7 19.2 27.8 22.9 27.1ZM25 46.9C20.3 46.9 16.4 43.1 15.6 38.2 19.6 37.6 23.1 34.9 25 31.3 26.9 34.9 30.4 37.6 34.4 38.2 33.6 43.1 29.7 46.9 25 46.9ZM27.1 27.1C30.7 27.8 33.6 30.7 34.4 34.4 30.7 33.6 27.8 30.7 27.1 27.1ZM38.2 34.4C37.6 30.4 34.9 26.9 31.3 25 34.9 23.1 37.6 19.6 38.2 15.6 43.1 16.4 46.9 20.3 46.9 25 46.9 29.7 43.1 33.6 38.2 34.4Z"></path></g></svg><span>Recommended</span></a></li><li><a href="https://www.safaribooksonline.com/playlists/" class="t-queue-nav l0 nav-icn None"><!--?xml version="1.0" encoding="UTF-8"?--><svg width="21px" height="17px" viewBox="0 0 21 17" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink"><!-- Generator: Sketch 46.2 (44496) - http://www.bohemiancoding.com/sketch --><title>icon_Playlist_sml</title><desc>Created with Sketch.</desc><defs></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="icon_Playlist_sml" fill-rule="nonzero" fill="#000000"><g id="playlist-icon"><g id="Group-6"><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle></g><g id="Group-5" transform="translate(0.000000, 7.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g><g id="Group-5-Copy" transform="translate(0.000000, 14.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g></g></g></g></svg><span>
               Playlists
            </span></a></li><li class="search"><a href="#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="https://www.safaribooksonline.com/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z"></path></g></svg><span>History</span></a></li><li><a href="https://www.safaribooksonline.com/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" width="20" height="20" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z"></path></g></svg><span>Topics</span></a></li><li><a href="https://www.safaribooksonline.com/tutorials/" class="l1 nav-icn t-tutorials-nav js-toggle-menu-item None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>tutorials icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M15.8 18.2C15.8 18.2 15.9 18.2 16 18.2 16.1 18.2 16.2 18.2 16.4 18.2 16.5 18.2 16.7 18.1 16.9 18 17 17.9 17.1 17.8 17.2 17.7 17.3 17.6 17.4 17.5 17.4 17.4 17.5 17.2 17.6 16.9 17.6 16.7 17.6 16.6 17.6 16.5 17.6 16.4 17.5 16.2 17.5 16.1 17.4 15.9 17.3 15.8 17.2 15.6 17 15.5 16.8 15.3 16.6 15.3 16.4 15.2 16.2 15.2 16 15.2 15.8 15.2 15.7 15.2 15.5 15.3 15.3 15.4 15.2 15.4 15.1 15.5 15 15.7 14.9 15.8 14.8 15.9 14.7 16 14.7 16.1 14.6 16.3 14.6 16.4 14.6 16.5 14.6 16.6 14.6 16.6 14.6 16.7 14.6 16.9 14.6 17 14.6 17.1 14.7 17.3 14.7 17.4 14.8 17.6 15 17.7 15.1 17.9 15.2 18 15.3 18 15.5 18.1 15.5 18.1 15.6 18.2 15.7 18.2 15.7 18.2 15.7 18.2 15.8 18.2L15.8 18.2ZM9.4 11.5C9.5 11.5 9.5 11.5 9.6 11.5 9.7 11.5 9.9 11.5 10 11.5 10.2 11.5 10.3 11.4 10.5 11.3 10.6 11.2 10.8 11.1 10.9 11 10.9 10.9 11 10.8 11.1 10.7 11.2 10.5 11.2 10.2 11.2 10 11.2 9.9 11.2 9.8 11.2 9.7 11.2 9.5 11.1 9.4 11 9.2 10.9 9.1 10.8 8.9 10.6 8.8 10.5 8.7 10.3 8.6 10 8.5 9.9 8.5 9.7 8.5 9.5 8.5 9.3 8.5 9.1 8.6 9 8.7 8.8 8.7 8.7 8.8 8.6 9 8.5 9.1 8.4 9.2 8.4 9.3 8.2 9.5 8.2 9.8 8.2 10 8.2 10.1 8.2 10.2 8.2 10.3 8.2 10.5 8.3 10.6 8.4 10.7 8.5 10.9 8.6 11.1 8.7 11.2 8.9 11.3 9 11.4 9.1 11.4 9.2 11.4 9.3 11.5 9.3 11.5 9.3 11.5 9.4 11.5 9.4 11.5L9.4 11.5ZM3 4.8C3.1 4.8 3.1 4.8 3.2 4.8 3.4 4.8 3.5 4.8 3.7 4.8 3.8 4.8 4 4.7 4.1 4.6 4.3 4.5 4.4 4.4 4.5 4.3 4.6 4.2 4.6 4.1 4.7 4 4.8 3.8 4.8 3.5 4.8 3.3 4.8 3.1 4.8 3 4.8 2.9 4.7 2.8 4.7 2.6 4.6 2.5 4.5 2.3 4.4 2.2 4.2 2.1 4 1.9 3.8 1.9 3.6 1.8 3.5 1.8 3.3 1.8 3.1 1.8 2.9 1.8 2.7 1.9 2.6 2 2.4 2.1 2.3 2.2 2.2 2.3 2.1 2.4 2 2.5 2 2.6 1.8 2.8 1.8 3 1.8 3.3 1.8 3.4 1.8 3.5 1.8 3.6 1.8 3.8 1.9 3.9 2 4 2.1 4.2 2.2 4.4 2.4 4.5 2.5 4.6 2.6 4.7 2.7 4.7 2.8 4.7 2.9 4.8 2.9 4.8 3 4.8 3 4.8 3 4.8L3 4.8ZM13.1 15.2C13.2 15.1 13.2 15.1 13.2 15.1 13.3 14.9 13.4 14.7 13.6 14.5 13.8 14.2 14.1 14 14.4 13.8 14.7 13.6 15.1 13.5 15.5 13.4 15.9 13.4 16.3 13.4 16.7 13.5 17.2 13.5 17.6 13.7 17.9 13.9 18.2 14.1 18.5 14.4 18.7 14.7 18.9 15 19.1 15.3 19.2 15.6 19.3 15.9 19.4 16.1 19.4 16.4 19.4 17 19.3 17.5 19.1 18.1 19 18.3 18.9 18.5 18.7 18.7 18.5 19 18.3 19.2 18 19.4 17.7 19.6 17.3 19.8 16.9 19.9 16.6 20 16.3 20 16 20 15.8 20 15.6 20 15.4 19.9 15.4 19.9 15.4 19.9 15.4 19.9 15.2 19.9 15 19.8 14.9 19.8 14.8 19.7 14.7 19.7 14.6 19.7 14.4 19.6 14.3 19.5 14.1 19.3 13.7 19.1 13.4 18.7 13.2 18.4 13.1 18.1 12.9 17.8 12.9 17.5 12.8 17.3 12.8 17.1 12.8 16.9L3.5 14.9C3.3 14.9 3.1 14.8 3 14.8 2.7 14.7 2.4 14.5 2.1 14.3 1.7 14 1.4 13.7 1.2 13.3 1 13 0.9 12.6 0.8 12.3 0.7 12 0.7 11.7 0.7 11.4 0.7 11 0.8 10.5 1 10.1 1.1 9.8 1.3 9.5 1.6 9.2 1.8 8.9 2.1 8.7 2.4 8.5 2.8 8.3 3.2 8.1 3.6 8.1 3.9 8 4.2 8 4.5 8 4.6 8 4.8 8 4.9 8.1L6.8 8.5C6.8 8.4 6.8 8.4 6.8 8.4 6.9 8.2 7.1 8 7.2 7.8 7.5 7.5 7.7 7.3 8 7.1 8.4 6.9 8.7 6.8 9.1 6.7 9.5 6.7 10 6.7 10.4 6.8 10.8 6.8 11.2 7 11.5 7.2 11.8 7.5 12.1 7.7 12.4 8 12.6 8.3 12.7 8.6 12.8 8.9 12.9 9.2 13 9.4 13 9.7 13 9.7 13 9.8 13 9.8 13.6 9.9 14.2 10.1 14.9 10.2 15 10.2 15 10.2 15.1 10.2 15.3 10.2 15.4 10.2 15.6 10.2 15.8 10.1 16 10 16.2 9.9 16.4 9.8 16.5 9.6 16.6 9.5 16.8 9.2 16.9 8.8 16.9 8.5 16.9 8.3 16.9 8.2 16.8 8 16.8 7.8 16.7 7.7 16.6 7.5 16.5 7.3 16.3 7.2 16.2 7.1 16 7 15.9 6.9 15.8 6.9 15.7 6.9 15.6 6.8 15.5 6.8L6.2 4.8C6.2 5 6 5.2 5.9 5.3 5.7 5.6 5.5 5.8 5.3 6 4.9 6.2 4.5 6.4 4.1 6.5 3.8 6.6 3.5 6.6 3.2 6.6 3 6.6 2.8 6.6 2.7 6.6 2.6 6.6 2.6 6.5 2.6 6.5 2.5 6.5 2.3 6.5 2.1 6.4 1.8 6.3 1.6 6.1 1.3 6 1 5.7 0.7 5.4 0.5 5 0.3 4.7 0.2 4.4 0.1 4.1 0 3.8 0 3.6 0 3.3 0 2.8 0.1 2.2 0.4 1.7 0.5 1.5 0.7 1.3 0.8 1.1 1.1 0.8 1.3 0.6 1.6 0.5 2 0.3 2.3 0.1 2.7 0.1 3.1 0 3.6 0 4 0.1 4.4 0.2 4.8 0.3 5.1 0.5 5.5 0.8 5.7 1 6 1.3 6.2 1.6 6.3 1.9 6.4 2.3 6.5 2.5 6.6 2.7 6.6 3 6.6 3 6.6 3.1 6.6 3.1 9.7 3.8 12.8 4.4 15.9 5.1 16.1 5.1 16.2 5.2 16.4 5.2 16.7 5.3 16.9 5.5 17.2 5.6 17.5 5.9 17.8 6.2 18.1 6.5 18.3 6.8 18.4 7.2 18.6 7.5 18.6 7.9 18.7 8.2 18.7 8.6 18.7 9 18.6 9.4 18.4 9.8 18.3 10.1 18.2 10.3 18 10.6 17.8 10.9 17.5 11.1 17.3 11.3 16.9 11.6 16.5 11.8 16 11.9 15.7 12 15.3 12 15 12 14.8 12 14.7 12 14.5 11.9 13.9 11.8 13.3 11.7 12.6 11.5 12.5 11.7 12.4 11.9 12.3 12 12.1 12.3 11.9 12.5 11.7 12.7 11.3 12.9 10.9 13.1 10.5 13.2 10.2 13.3 9.9 13.3 9.6 13.3 9.4 13.3 9.2 13.3 9 13.2 9 13.2 9 13.2 9 13.2 8.8 13.2 8.7 13.2 8.5 13.1 8.2 13 8 12.8 7.7 12.6 7.4 12.4 7.1 12 6.8 11.7 6.7 11.4 6.6 11.1 6.5 10.8 6.4 10.6 6.4 10.4 6.4 10.2 5.8 10.1 5.2 9.9 4.5 9.8 4.4 9.8 4.4 9.8 4.3 9.8 4.1 9.8 4 9.8 3.8 9.8 3.6 9.9 3.4 10 3.2 10.1 3 10.2 2.9 10.4 2.8 10.5 2.6 10.8 2.5 11.1 2.5 11.5 2.5 11.6 2.5 11.8 2.6 12 2.6 12.1 2.7 12.3 2.8 12.5 2.9 12.6 3.1 12.8 3.2 12.9 3.3 13 3.5 13.1 3.6 13.1 3.7 13.1 3.8 13.2 3.9 13.2L13.1 15.2 13.1 15.2Z"></path></g></svg><span>Tutorials</span></a></li><li class="nav-offers flyout-parent"><a href="#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>offers icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M35.9 20.6L27 15.5C26.1 15 24.7 15 23.7 15.5L14.9 20.6C13.9 21.1 13.2 22.4 13.2 23.4L13.2 41.4C13.2 42.4 13.9 43.7 14.9 44.2L23.3 49C24.2 49.5 25.6 49.5 26.6 49L35.9 43.6C36.8 43.1 37.6 41.8 37.6 40.8L37.6 23.4C37.6 22.4 36.8 21.1 35.9 20.6L35.9 20.6ZM40 8.2C39.1 7.6 37.6 7.6 36.7 8.2L30.2 11.9C29.3 12.4 29.3 13.2 30.2 13.8L39.1 18.8C40 19.4 40.7 20.6 40.7 21.7L40.7 39C40.7 40.1 41.4 40.5 42.4 40L48.2 36.6C49.1 36.1 49.8 34.9 49.8 33.8L49.8 15.6C49.8 14.6 49.1 13.3 48.2 12.8L40 8.2 40 8.2ZM27 10.1L33.6 6.4C34.5 5.9 34.5 5 33.6 4.5L26.6 0.5C25.6 0 24.2 0 23.3 0.5L16.7 4.2C15.8 4.7 15.8 5.6 16.7 6.1L23.7 10.1C24.7 10.6 26.1 10.6 27 10.1ZM10.1 21.7C10.1 20.6 10.8 19.4 11.7 18.8L20.6 13.8C21.5 13.2 21.5 12.4 20.6 11.9L13.6 7.9C12.7 7.4 11.2 7.4 10.3 7.9L1.6 12.8C0.7 13.3 0 14.6 0 15.6L0 33.8C0 34.9 0.7 36.1 1.6 36.6L8.4 40.5C9.3 41 10.1 40.6 10.1 39.6L10.1 21.7 10.1 21.7Z"></path></g></svg><span>Offers &amp; Deals</span></a><ul class="flyout"><li><a href="https://get.oreilly.com/email-signup.html" target="_blank" class="l2 nav-icn"><span>Newsletters</span></a></li></ul></li><li class="nav-highlights"><a href="https://www.safaribooksonline.com/u/47f1b03c-b626-4c20-9277-e4d681dbf059/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" width="20" height="20" version="1.1" fill="#4A3C31"><desc>highlights icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M13.325 18.071L8.036 18.071C8.036 11.335 12.36 7.146 22.5 5.594L22.5 0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35 15.545 35 19.578 31.485 19.578 26.184 19.578 21.556 17.211 18.891 13.325 18.071L13.325 18.071ZM40.825 18.071L35.565 18.071C35.565 11.335 39.86 7.146 50 5.594L50 0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35 43.045 35 47.078 31.485 47.078 26.184 47.078 21.556 44.74 18.891 40.825 18.071L40.825 18.071Z"></path></g></svg><span>Highlights</span></a></li><li><a href="https://www.safaribooksonline.com/u/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a></li><li><a href="https://www.safaribooksonline.com/public/support" class="l1 no-icon">Support</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="https://www.safaribooksonline.com/u/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a><span class="l2 t-nag-notification" id="nav-nag"><strong class="trial-green">10</strong> days left in your trial.
  
  

  
    
      

<a class="" href="https://www.safaribooksonline.com/subscribe/">Subscribe</a>.


    
  

  

</span></li><li><a href="https://www.safaribooksonline.com/public/support" class="l2">Support</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>


      </div>
      <div id="container" class="application" style="height: auto;">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      OCP Java SE 8 Programmer II Exam Guide (Exam 1Z0-809), 7th Edition
      
    </h1></span></a><div class="toc-contents" style="max-height: 0px;">
  <div class="sbo-toc ">
    <button type="button" class="sbo-toc-thumb close"><div class="visuallyhidden">Close</div></button>
      <section class="ios-app-teaser">
        <ul>
            <li><a class="js-toc-link toc-link" href="https://itunes.apple.com/gb/app/safari-queue-library-over/id881697395?mt=8" role="button">Install App</a></li>
            <li><a class="js-toc-link toc-link" href="safaridetail://9781260117370" role="button">Open in App</a></li>
        </ul>
      </section>
      <div class="sbo-book-meta">
        
        <span class="cover">
         <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/">
          <img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/a.jpg" alt="Cover image for OCP Java SE 8 Programmer II Exam Guide (Exam 1Z0-809), 7th Edition" width="143" height="176">
        </a>
        </span>
        <span class="title">
          
            
                <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/publisher/mcgraw-hill/">
                  <img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/mcgraw-hill.png" class="publisher-logo video" alt="publisher logo">
                </a>
            
          

          <a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/">OCP Java SE 8 Programmer II Exam Guide (Exam 1Z0-809), 7th Edition</a>
        </span>
        
        <span class="authors">by Bert Bates; Elisabeth Robson; Kathy Sierra</span>
        

        
        <span class="publishers t-publishers">Published by
          <!-- Show publisher page link if publisher pages switch is on -->
          
            <a class="t-publisher-link toc-link js-toc-link" href="https://www.safaribooksonline.com/library/publisher/mcgraw-hill/">
              McGraw-Hill</a>, 2018
          
        </span>
        

    

    </div>
  <ol class="tocList">
    
    
    
     

     <li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/cover.xhtml">
        Cover <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/title.xhtml">
        Title Page <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/copy.xhtml">
        Copyright Page <span class="minutes">(03:27 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ded.xhtml">
        Dedication <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/content.xhtml">
        Contents <span class="minutes">(08:03 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ack.xhtml#ack">
        Acknowledgments 
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/preface.xhtml#preface">
        Preface 
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/intro.xhtml#intro">
        Introduction 
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch1.xhtml#ch1">
        1 Declarations, Access Control, and Enums 
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch2.xhtml#ch2">
        2 Object Orientation 
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch3.xhtml#ch3">
        3 Assertions and Java Exceptions 
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch4.xhtml#ch4">
        4 Dates, Times, Locales, and Resource Bundles 
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch5.xhtml#ch5">
        5 I/O and NIO 
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch6.xhtml#ch6">
        6 Generics and Collections 
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch7.xhtml#ch7">
        7 Inner Classes 
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch8.xhtml#ch8">
        8 Lambda Expressions and Functional Interfaces 
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch9.xhtml#ch9">
        9 Streams 
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1 currently-reading">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch10.xhtml#ch10">
        10 Threads 
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11">
        11 Concurrency 
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch12.xhtml#ch12">
        12 JDBC 
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/app01.xhtml#app01">
        A About the Online Content 
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/index.xhtml#index">
        Index 
       </a>
      
        
      
   </li></ol>
 </div>



</div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input name="query" placeholder="Search inside this book..." autocomplete="off" type="search"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/9781260117370/chapter/ch3.xhtml"><div class="js-collections-dropdown collections-dropdown menu-bit-cards"><div data-reactroot="" class="menu-dropdown-wrapper js-menu-dropdown-wrapper align-right"><img class="hidden" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/ajax-transp.gif" alt="loading spinner"><div class="menu-control"><div class="control "><div class="js-playlists-menu"><button class="js-playlist-icon"><svg class="icon-add-to-playlist-sml" viewBox="0 0 16 14" version="1.1" xmlns="http://www.w3.org/2000/svg"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g fill-rule="nonzero" fill="#000000"><g transform="translate(-1.000000, 0.000000)"><rect x="5" y="0" width="12" height="2"></rect><title>Playlists</title><path d="M4.5,14 C6.43299662,14 8,12.4329966 8,10.5 C8,8.56700338 6.43299662,7 4.5,7 C2.56700338,7 1,8.56700338 1,10.5 C1,12.4329966 2.56700338,14 4.5,14 Z M2.5,10 L4,10 L4,8.5 L5,8.5 L5,10 L6.5,10 L6.5,11 L5,11 L5,12.5 L4,12.5 L4,11 L2.5,11 L2.5,10 Z"></path><circle cx="2" cy="5" r="1"></circle><circle cx="1.94117647" cy="1" r="1"></circle><rect x="5" y="4" width="12" height="2"></rect><rect x="9" y="8" width="8" height="2"></rect><rect x="9" y="12" width="8" height="2"></rect></g></g></g></svg><div class="js-playlist-addto-label">Add&nbsp;To</div></button></div></div></div></div></div></div></li><li class="js-font-control-panel font-control-activator"><a href="#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li class=""><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch3.xhtml&amp;text=OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20%28Exam%201Z0-809%29%2C%207th%20Edition&amp;via=safari"><span>Twitter</span></a></li><li class=""><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch3.xhtml"><span>Facebook</span></a></li><li class=""><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch3.xhtml"><span>Google Plus</span></a></li><li class=""><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari: 3%20Assertions%20and%20Java%20Exceptions&amp;body=https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch3.xhtml%0D%0Afrom OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20%28Exam%201Z0-809%29%2C%207th%20Edition%0D%0A"><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    <section role="document">
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch10.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">10 Threads</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch12.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">12 JDBC</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><div class="annotator-wrapper"><section epub:type="chapter">
<p class="image"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/common-01.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/common-01.jpg" width="700" height="348"></p>
<h2 class="h2p" id="ch11"><span id="page_721" epub:type="pagebreak"></span>11</h2>
<h2 class="h2p1">Concurrency</h2>
<p class="title-o"><span class="white">CERTIFICATION OBJECTIVES</span></p>
<p class="toc-l">•&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Create 
Worker Threads Using Runnable, Callable and Use an ExecutorService to 
Concurrently Execute Tasks</p>
<p class="toc-l">•&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Use 
Synchronized Keyword and java.util.concurrent.atomic Package to Control 
the Order of Thread Execution</p>
<p class="toc-l">•&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Use 
java.util.concurrent Collections and Classes Including CyclicBarrier and
 CopyOnWriteArrayList</p>
<p class="toc-l">•&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Use Parallel Fork/Join Framework</p>
<p class="toc-l">•&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Use Parallel
 Streams Including Reduction, Decomposition, Merging Processes, 
Pipelines and Performance</p>
<p class="toc-l">•&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Identify 
Potential Threading Problems among Deadlock, Starvation, Livelock, and 
Race Conditions</p>
<p class="toc-lq"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick.jpg" width="22" height="23">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Two-Minute Drill</p>
<p class="toc-q"><strong>Q&amp;A</strong>&nbsp;&nbsp;&nbsp;Self Test</p>
<h3 class="h3-a" id="ch11lev1sec1"><span id="page_722" epub:type="pagebreak"></span><strong>Concurrency with the java.util.concurrent Package</strong></h3>
<p class="noindent">As you learned in the previous chapter on threads, 
the Java platform supports multithreaded programming. Supporting 
multithreaded programming is essential for any modern programming 
language because servers, desktop computers, laptops, and most mobile 
devices contain multiple CPUs. If you want your applications to take 
advantage of all of the processing power present in a modern system, you
 must create multithreaded applications.</p>
<p class="indent">Unfortunately, creating efficient and error-free 
multithreaded applications can be a challenge. The low-level threading 
constructs such as <code>Thread</code>, <code>Runnable</code>, <code>wait()</code>, <code>notify()</code>,
 and synchronized blocks are too primitive for many requirements and 
force developers to create their own high-level threading libraries. 
Custom threading libraries can be both error prone and time consuming to
 create.</p>
<p class="indent">The <code>java.util.concurrent</code> package provides
 high-level APIs that support many common concurrent programming use 
cases. When possible, you should use these high-level APIs in place of 
the traditional low-level threading constructs (synchronized, wait, 
notify). Some features (such as the locking API) provide functionality 
similar to what existed already, but with more flexibility at the cost 
of slightly awkward syntax. Using the <code>java.util.concurrent</code> classes requires a solid understanding of the traditional Java threading types (<code>Thread</code> and <code>Runnable</code>)
 and their use (start, run, synchronized, wait, notify, join, sleep, 
etc.). If you are not comfortable with Java threads, you should return 
to the previous chapter before continuing with these high-level 
concurrency APIs.</p>
<p class="title-o"><span class="white"><strong>CERTIFICATION OBJECTIVE</strong></span></p>
<h3 class="h3" id="ch11lev1sec2"><strong>Apply Atomic Variables and Locks (OCP Objective 10.3)</strong></h3>
<p class="noindent"><em>10.3&nbsp;&nbsp;&nbsp;Use synchronized keyword and java.util.concurrent.atomic package to control the order of thread execution.</em></p>
<p class="indentt">The <code>java.util.concurrent.atomic</code> and <code>java.util.concurrent.locks</code>
 packages solve two different problems. They are grouped into a single 
exam objective simply because they are the only two packages below <code>java.util.concurrent</code> <span id="page_723" epub:type="pagebreak"></span>and both have a small number of classes and interfaces to learn. The <code>java.util.concurrent.atomic</code> package enables multithreaded applications to safely access individual variables without locking, whereas the <code>java.util.concurrent.locks</code>
 package provides a locking framework that can be used to create locking
 behaviors that are the same or superior to those of Java’s synchronized
 keyword.</p>
<h4 class="h4" id="ch11lev2sec1">Atomic Variables</h4>
<p class="noindent">Imagine a multiplayer video game that contains 
monsters that must be destroyed. The players of the game (threads) are 
vanquishing monsters, while at the same time a monster-spawning thread 
is repopulating the world to ensure players always have a new challenge 
to face. To keep the level of difficulty consistent, you would need to 
keep track of the monster count and ensure that the monster population 
stays the same (a hero’s work is never done). Both the player threads 
and the monster-spawning thread must access and modify the shared 
monster count variable. If the monster count somehow became incorrect, 
your players may find themselves with more adversaries than they could 
handle.</p>
<p class="indent">The following example shows how even the seemingly 
simplest of code can lead to undefined results. Here you have a class 
that increments and reports the current value of an integer variable:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un723-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un723-01.jpg" width="419" height="191"></p>
<p class="indent">A <code>Thread</code> that will increment the counter 10,000 times:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un723-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un723-02.jpg" width="436" height="151"></p>
<p class="imageip"><span id="page_724" epub:type="pagebreak"></span><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un724-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un724-01.jpg" width="331" height="94"></p>
<p class="indent">Here is the code from within this application’s main method:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un724-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un724-02.jpg" width="558" height="169"></p>
<p class="indent">The trap in this example is that <code>count++</code> looks like a single action when, in fact, it is not. When incrementing a field like this, what <em>probably</em> happens is the following sequence:</p>
<p class="numlistt">1.&nbsp;&nbsp;&nbsp;The value stored in <code>count</code> is copied to a temporary variable.</p>
<p class="numlist">2.&nbsp;&nbsp;&nbsp;The temporary variable is incremented.</p>
<p class="numlistb">3.&nbsp;&nbsp;&nbsp;The value of the temporary variable is copied back to the <code>count</code> field.</p>
<p class="noindent">We say “probably” in this example because while the Java compiler will translate the <code>count++</code>
 statement into multiple Java bytecode instructions, you really have no 
control over what native instructions are executed. The JIT (Just In 
Time compiler)–based nature of most Java runtime environments means you 
don’t know when or if the <code>count++</code> statement will be 
translated to native CPU instructions and whether it ends up as a single
 instruction or several. You should always act as if a single line of 
Java code takes multiple steps to complete. Getting an incorrect result 
also depends on many other factors, such as the type of CPU you have. Do
 both threads in the example run concurrently or in sequence? A large 
loop count was used in order to make the threads run longer and be more 
likely to execute concurrently.</p>
<p class="indent">While you could make this code thread-safe with 
synchronized blocks, the act of obtaining and releasing a lock flag 
would probably be more time consuming than the work being performed. 
This is where the classes in the <code>java.util.concurrent.atomic</code>
 package can benefit you. They provide variables whose values can be 
modified atomically. An atomic operation is one that, for all intents <span id="page_725" epub:type="pagebreak"></span>and purposes, appears to happen all at once. The <code>java.util.concurrent.atomic</code> package provides several classes for different data types, such as <code>AtomicInteger</code>, <code>AtomicLong</code>, <code>AtomicBoolean</code>, and <code>AtomicReference</code>, to name a few.</p>
<p class="indent">Here is a thread-safe replacement for the <code>Counter</code> class from the previous example:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un725-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un725-01.jpg" width="482" height="171"></p>
<p class="indent">In reality, even a method such as <code>getAndIncrement()</code>
 still takes several steps to execute. The reason this implementation is
 now thread-safe is something called CAS. CAS stands for Compare And 
Swap. Most modern CPUs have a set of CAS instructions. Following is a 
basic outline of what is happening now:</p>
<p class="numlistt">1.&nbsp;&nbsp;&nbsp;The value stored in <code>count</code> is copied to a temporary variable.</p>
<p class="numlist">2.&nbsp;&nbsp;&nbsp;The temporary variable is incremented.</p>
<p class="numlistb">3.&nbsp;&nbsp;&nbsp;Compare the value currently in <code>count</code> with the original value. If it is unchanged, then swap the old value for the new value.</p>
<p class="noindent">Step 3 happens atomically. If step 3 finds that some other thread has already modified the value of <code>count</code>, then repeat steps 1–3 until we increment the field without interference.</p>
<p class="indent">The central method in a class like <code>AtomicInteger</code> is the <code>boolean compareAndSet(int expect, int update)</code> method, which provides the CAS behavior. Other atomic methods delegate to the <code>compareAndSet</code> method. The <code>getAndIncrement</code> method implementation is simply:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un725-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un725-02.jpg" width="341" height="152"></p>
<h4 class="h4" id="ch11lev2sec2"><span id="page_726" epub:type="pagebreak"></span>Locks</h4>
<p class="noindent">The <code>java.util.concurrent.locks</code> package is about creating (not surprisingly) locks. Why would you want to use locks when so much of <code>java.util.concurrent</code> seems geared toward avoiding overt locking? You use <code>java.util.concurrent.locks</code>
 classes and traditional monitor locking (the synchronized keyword) for 
roughly the same purpose: creating segments of code that require 
exclusive execution (one thread at a time).</p>
<p class="indent">Why would you create code that limits the number of 
threads that can execute it? While atomic variables work well for making
 single variables thread-safe, imagine if you have two or more variables
 that are related. A video game character might have a number of gold 
pieces that can be carried in his backpack and a number of gold pieces 
he keeps in an in-game bank vault. Transferring gold into the bank is as
 simple as subtracting gold from the backpack and adding it to the 
vault. If we have 10 gold pieces in our backpack and 90 in the vault, we
 have a total of 100 pieces that belong to our character. If we want to 
transfer all 10 pieces to the vault, we can first add 10 to the vault 
count and then subtract 10 from the backpack, or first subtract 10 from 
the backpack and then add 10 to the vault. If another thread were to try
 to assess our character’s wealth during the middle of our transfer, it 
might see 90 pieces or 110 pieces, depending on the order of our 
operations, neither being the correct count of 100 pieces.</p>
<p class="indent">This other thread that is attempting to read the 
character’s total wealth might do all sorts of things, such as increase 
the likelihood of your character being robbed or a variety of other 
actions to control the in-game economics. All game threads must 
correctly gauge a character’s wealth even if there is a transfer in 
progress.</p>
<p class="indent">The solution to our balance inquiry transfer problem 
is to use locking. Create a single method to get a character’s wealth 
and another to perform gold transfers. You should never be able to check
 a character’s total wealth while a gold transfer is in progress. Having
 a single method to get a character’s total wealth is also important 
because you don’t want a thread to read the backpack’s gold count before
 a transfer and then the vault’s gold count after a transfer. That would
 lead to the same incorrect total as trying to calculate the total 
during a transfer.</p>
<p class="indent">Much of the functionality provided by the classes and interfaces of the <code>java.util.concurrent.locks</code>
 package duplicates that of traditional synchronized locking. In fact, 
the hypothetical gold transfer outlined earlier could be solved with 
either the synchronized keyword or classes in the <code>java.util.concurrent.locks</code> package. In Java 5, when <code>java.util.concurrent</code> was first introduced, the new locking classes performed better than the synchronized keyword, but there <span id="page_727" epub:type="pagebreak"></span>is no longer a vast difference in performance. So why would you use these newer locking classes? The <code>java.util.concurrent.locks</code> package provides</p>
<p class="bullt"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;The ability to duplicate traditional synchronized blocks.</p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;Nonblock scoped locking—obtain a lock in one method and release it in another (this can be dangerous, though).</p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;Multiple <code>wait</code>/<code>notify</code>/<code>notifyAll</code> pools per lock—threads can select which pool (<code>Condition</code>) they wait on.</p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;The ability to attempt to acquire a lock and take an alternative action if locking fails.</p>
<p class="bullb"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;An implementation of a multiple-reader, single-writer lock.</p>
<h5 class="h5">ReentrantLock</h5>
<p class="noindent">The <code>java.util.concurrent.locks.Lock</code> interface provides the outline of locking provided by the <code>java.util.concurrent.locks</code> package. Like any interface, the <code>Lock</code> interface requires an implementation to be of any real use. The <code>java.util.concurrent.locks.ReentrantLock</code> class provides that implementation. To demonstrate the use of <code>Lock</code>, we will first duplicate the functionality of a basic traditional synchronized block.</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un727-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un727-01.jpg" width="625" height="72"></p>
<p class="indent">Here is an equivalent piece of code using the <code>java.util.concurrent.locks</code> package. Notice how <code>ReentrantLock</code> can be stored in a <code>Lock</code> reference because it implements the <code>Lock</code> interface. This example blocks on attempting to acquire a lock, just like traditional synchronization.</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un727-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un727-02.jpg" width="420" height="131"></p>
<p class="indent">It is recommended that you always follow the <code>lock()</code> method with a <code>try</code>-<code>finally</code> block, which releases the lock. The previous example doesn’t really provide a compelling reason for you to choose to use a <code>Lock</code> instance instead of <span id="page_728" epub:type="pagebreak"></span>traditional
 synchronization. One of the very powerful features is the ability to 
attempt (and fail) to acquire a lock. With traditional synchronization, 
once you hit a synchronized block, your thread either immediately 
acquires the lock or blocks until it can.</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un728-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un728-01.jpg" width="513" height="169"></p>
<p class="indent">The ability to quickly fail to acquire the lock turns 
out to be powerful. You can process a different resource (lock) and come
 back to the failed lock later instead of just waiting for a lock to be 
released and thereby making more efficient use of system resources. 
There is also a variation of the <code>tryLock</code> method that allows you to specify an amount of time you are willing to wait to acquire the lock:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un728-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un728-02.jpg" width="491" height="247"></p>
<p class="indent">Another benefit of the <code>tryLock</code> method is 
deadlock avoidance. With traditional synchronization, you must acquire 
locks in the same order across all threads. For example, if you have two
 objects to lock against:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un728-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un728-03.jpg" width="231" height="34"></p>
<p class="noindent">and you synchronize using the internal lock flags of both objects:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un728-04.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un728-04.jpg" width="347" height="115"></p>
<p class="noindent"><span id="page_729" epub:type="pagebreak"></span>you should never acquire the locks in the opposite order because it could lead to deadlock. Although thread A has only the <code>o1</code> lock, thread B acquires the <code>o2</code> lock. You are now at an impasse because neither thread can obtain the second lock it needs to continue.</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un729-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un729-01.jpg" width="334" height="113"></p>
<p class="indent">Looking at a similar example using a <code>ReentrantLock</code>, start by creating two locks:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un729-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un729-02.jpg" width="276" height="32"></p>
<p class="indent">Next, you acquire both locks in thread A:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un729-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un729-03.jpg" width="495" height="189"></p>
<p class="indent">Notice the example is careful to always unlock any acquired lock, but ONLY the lock(s) that were acquired. A <code>ReentrantLock</code>
 has an internal counter that keeps track of the number of times it has 
been locked/unlocked, and it is an error to unlock without a 
corresponding successful lock operation. If a thread attempts to release
 a lock that it does not own, an <code>IllegalMonitorStateException</code> will be thrown.</p>
<p class="indent">Now in thread B, the locks are obtained in the reverse
 order in which thread A obtained them. With traditional locking, using 
synchronized code blocks and attempting to obtain locks in the reverse 
order could lead to deadlock.</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un729-04.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un729-04.jpg" width="249" height="91"></p>
<p class="imageip"><span id="page_730" epub:type="pagebreak"></span><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un730-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un730-01.jpg" width="209" height="94"></p>
<p class="indent">Now, even if thread A was only in possession of the <code>l1</code> lock, there is no possibility that thread B could block because we use the nonblocking <code>tryLock</code>
 method. Using this technique, you can avoid deadlocking scenarios, but 
you must deal with the possibility that both locks could not be 
acquired. Using a simple loop, you can repeatedly attempt to obtain both
 locks until successful (Note: This approach is CPU intensive; we’ll 
look at a better solution later):</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un730-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un730-02.jpg" width="267" height="266"></p>
<p class="text-icon"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/onjob.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/onjob.jpg" width="116" height="80"></p>
<p class="noindent"><strong><em>It is remotely possible that this example could lead to livelock. Imagine if thread A always acquires <code>lock1</code> at the same time that thread B acquires <code>lock2</code>.
 Each thread’s attempt to acquire the second lock would always fail, and
 you’d end up repeating forever, or at least until you were lucky enough
 to have one thread fall behind the other. You can avoid livelock in 
this scenario by introducing a short random delay with <code>Thread.sleep(int)</code> any time you fail to acquire both locks.</em></strong></p>
<h5 class="h5">Condition</h5>
<p class="noindent">A <code>Condition</code> provides the equivalent of the traditional <code>wait</code>, <code>notify</code>, and <code>notifyAll</code> methods. The traditional <code>wait</code> and <code>notify</code>
 methods allow developers to implement an await/signal pattern. You use 
an await/signal pattern when you would use locking, but with the added 
stipulation of trying to avoid spinning (endless checking if it is okay 
to do something). Imagine a video game character who wants to buy 
something from a store, but the store is out of stock at the moment. The
 character’s thread could repeatedly lock the store object and <span id="page_731" epub:type="pagebreak"></span>check
 for the desired item, but that would lead to unneeded system 
utilization. Instead, the character’s thread can say, “I’m taking a nap,
 wake me up when new stock arrives.”</p>
<p class="indent">The <code>java.util.concurrent.locks.Condition</code> interface is a replacement for the <code>wait</code> and <code>notify</code> methods. A three-part code example shows you how to use a condition. Part one shows that a <code>Condition</code> is created from a <code>Lock</code> object:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un731-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un731-01.jpg" width="426" height="33"></p>
<p class="indent">When your thread reaches a point where it must delay 
until another thread performs an activity, you “await” the completion of
 that other activity. Before calling <code>await</code>, you must have locked the <code>Lock</code> used to produce the <code>Condition</code>. It is possible that the awaiting thread may be interrupted, and you must handle the possible <code>InterruptedException</code>. When you call the <code>await</code> method, the <code>Lock</code> associated with the <code>Condition</code> is released. Before the <code>await</code> method returns, the lock will be reacquired. In order to use a <code>Condition</code>, a thread must first acquire a <code>Lock</code>. Part two of the three-part <code>Condition</code> example shows how a <code>Condition</code> is used to pause or wait for some event:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un731-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un731-02.jpg" width="475" height="189"></p>
<p class="indent">In another thread, you perform the activity that the 
first thread was waiting on and then signal that first thread to resume 
(return from the <code>await</code> method). Part three of the <code>Condition</code> example is run in a different thread than part two. This part causes the thread waiting in the second piece to wake up:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un731-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un731-03.jpg" width="559" height="150"></p>
<p class="indent"><span id="page_732" epub:type="pagebreak"></span>The <code>signalAll()</code> method causes all threads awaiting on the same <code>Condition</code> to wake up. You can also use the <code>signal()</code>
 method to wake up a single awaiting thread. Remember that “waking up” 
is not the same thing as proceeding. Each awoken thread will have to 
reacquire the <code>Lock</code> before continuing.</p>
<p class="indent">One advantage of a <code>Condition</code> over the traditional wait/notify operations is that multiple <code>Condition</code>s can exist for each <code>Lock</code>. A <code>Condition</code> is effectively a waiting/blocking pool for threads.</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un732-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un732-01.jpg" width="426" height="52"></p>
<p class="indent">By having multiple conditions, you are effectively 
categorizing the threads waiting on a lock and can, therefore, wake up a
 subset of the waiting threads.</p>
<p class="indent"><code>Conditions</code> can also be used when you can’t use a <code>BlockingQueue</code> to coordinate the activities of two or more threads.</p>
<h5 class="h5">ReentrantReadWriteLock</h5>
<p class="noindent">Imagine a video game that was storing a collection 
of high scores using a non-thread-safe collection. With a 
non-thread-safe collection, it is important that if a thread is 
attempting to modify the collection, it must have exclusive access to 
the collection. To allow multiple threads to concurrently read the high 
score list or allow a single thread to add a new score, you could use a <code>ReadWriteLock</code>.</p>
<p class="indent">A <code>ReentrantReadWriteLock</code> is not actually a <code>Lock</code>; it implements the <code>ReadWriteLock</code> interface. What a <code>ReentrantReadWriteLock</code> does is produce two specialized <code>Lock</code> instances, one to a read lock and the other to a write lock.</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un732-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un732-02.jpg" width="304" height="71"></p>
<p class="indent">These two locks are a matched set—one cannot be held 
at the same time as the other (by different threads). What makes these 
locks unique is that multiple threads can hold the read lock at the same
 time, but only one thread can hold the write lock at a time.</p>
<p class="indent">This example shows how a non-thread-safe collection (an <code>ArrayList</code>) can be made thread-safe, allowing concurrent reads but exclusive access by a writing thread:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un732-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un732-03.jpg" width="510" height="72"></p>
<p class="imageip"><span id="page_733" epub:type="pagebreak"></span><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un733-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un733-01.jpg" width="445" height="346"></p>
<p class="indent">Instead of wrapping a collection with <code>Lock</code> objects to ensure thread safety, you can use one of the thread-safe collections you’ll learn about in the next section.</p>
<p class="title-o"><span class="white"><strong>CERTIFICATION OBJECTIVE</strong></span></p>
<h3 class="h3" id="ch11lev1sec3"><strong>Use java.util.concurrent Collections (OCP Objective 10.4)</strong></h3>
<p class="noindent"><em>10.4&nbsp;&nbsp;&nbsp;Use java.util.concurrent collections and classes including CyclicBarrier and CopyOnWriteArrayList.</em></p>
<p class="indentt">Imagine an online video game with a list of the top 20 scores in the last 30 days. You could model the high score list using a <code>java.util.ArrayList</code>.
 As scores expire, they are removed from the list, and as new scores 
displace existing scores, remove and insert operations are performed. At
 the end of every game, the list of high scores is displayed. If the 
game is popular, then a lot of people (threads) will be reading the list
 at the same time. Occasionally, the list will be modified—734sometimes 
by multiple threads—probably at the same time that it is being read by a
 large number of threads.</p>
<p class="indent">A traditional <code>java.util.List</code> implementation such as <code>java.util.ArrayList</code> is not thread-safe. Concurrent threads can safely read from <span id="page_734" epub:type="pagebreak"></span>an <code>ArrayList</code>
 and possibly even modify the elements stored in the list, but if any 
thread modifies the structure of the list (add or remove operation), 
then unpredictable behavior can occur.</p>
<p class="indent">Look at the <code>ArrayListRunnable</code> class in 
the following example. What would happen if there were a single instance
 of this class being executed by several threads? You might encounter 
several problems, including <code>ArrayIndexOutOfBoundsException</code>,
 duplicate values, skipped values, and null values. Not all threading 
problems manifest immediately. To observe the bad behavior, you might 
have to execute the faulty code multiple times or under different system
 loads. It is important that you are able to recognize the difference 
between thread-safe and non-thread-safe code yourself, because the 
compiler will not detect thread-unsafe code.</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un734-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un734-01.jpg" width="585" height="541"></p>
<p class="indent">To make a collection thread-safe, you could surround 
all the code that accessed the collection in synchronized blocks or use a
 method such as <code>Collections.synchronizedList(new ArrayList())</code>. Using synchronization to safeguard <span id="page_735" epub:type="pagebreak"></span>a collection creates a performance bottleneck and reduces the liveness of your application. The <code>java.util.concurrent</code>
 package provides several types of collections that are thread-safe but 
do not use coarse-grained synchronization. When a collection will be 
concurrently accessed in an application you are developing, you should 
always consider using the collections outlined in the following 
sections.</p>
<div class="side">
<p class="exam"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/exam.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/exam.jpg" width="130" height="68"></p>
</div>
<div class="side1">
<p class="indent"><strong><em>Problems in multithreaded applications may
 not always manifest—a lot depends on the underlying operating system 
and how other applications affect the thread scheduling of a problematic
 application. On the exam, you might be asked about the “probable” or 
“most likely“ outcome. Unless you are asked to identify every possible 
outcome of a code sample, don’t get hung up on unlikely results. For 
example, if a code sample uses <code>Thread.sleep(1000)</code> and 
nothing indicates that the thread would be interrupted while it was 
sleeping, it would be safe to assume that the thread would resume 
execution around one second after the call to sleep.</em></strong></p>
</div>
<h4 class="h4" id="ch11lev2sec3">Copy-on-Write Collections</h4>
<p class="noindent">The copy-on-write collections from the <code>java.util.concurrent</code>
 package implement one of several mechanisms to make a collection 
thread-safe. By using the copy-on-write collections, you eliminate the 
need to implement synchronization or locking when manipulating a 
collection using multiple threads.</p>
<p class="indent">The <code>CopyOnWriteArrayList</code> is a <code>List</code> implementation that can be used concurrently without using traditional synchronization semantics. As its name implies, a <code>CopyOnWriteArrayList</code> will never modify its internal array of data. Any mutating operations on the <code>List</code>
 (add, set, remove, etc.) will cause a new modified copy of the array to
 be created, which will replace the original read-only array. The 
read-only nature of the underlying array in a <code>CopyOnWriteArrayList</code> allows it to be safely shared with multiple threads. <strong>Remember that read-only (immutable) objects are always thread-safe.</strong></p>
<p class="indent">The essential thing to remember with a copy-on-write 
collection is that a thread that is looping through the elements in a 
collection must keep a reference to the same unchanging elements 
throughout the duration of the loop; this is achieved with the use of an
 <code>Iterator</code>. You want to keep using the old, unchanging <span id="page_736" epub:type="pagebreak"></span>collection that you began a loop with. When you use <code>list.iterator()</code>, the returned <code>Iterator</code> will always reference the collection of elements as it was when <code>list.iterator()</code> was called, even if another thread modifies the collection. Any mutating methods called on a copy-on-write–based <code>Iterator</code> or <code>ListIterator</code> (such as add, set, or remove) will throw an <code>UnsupportedOperationException</code>.</p>
<p class="text-icon"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/onjob.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/onjob.jpg" width="116" height="80"></p>
<p class="noindent"><strong><em>A <code>for-each</code> loop uses an <code>Iterator</code> when executing, so it is safe to use with a copy-on-write collection, unlike a traditional <code>for</code> loop.</em></strong></p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un736-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un736-01.jpg" width="530" height="35"></p>
<p class="indent">The <code>java.util.concurrent</code> package provides two copy-on-write-based collections: <code>CopyOnWriteArrayList</code> and <code>CopyOnWriteArraySet</code>.
 Use the copy-on-write collections when your data sets remain relatively
 small and the number of read operations and traversals greatly 
outnumber modifications to the collections. Modifications to the 
collections (not the elements within) are expensive because the entire 
internal array must be duplicated for each modification.</p>
<div class="side">
<p class="exam"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/exam.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/exam.jpg" width="130" height="68"></p>
</div>
<div class="side1">
<p class="indent"><strong><em>A thread-safe collection does not make the
 elements stored within the collection thread-safe. Just because a 
collection that contains elements is threadsafe does not mean the 
elements themselves can be safely modified by multiple threads. You 
might have to use atomic variables, locks, synchronized code blocks, or 
immutable (read-only) objects to make the objects referenced by a 
collection thread-safe.</em></strong></p>
</div>
<h4 class="h4" id="ch11lev2sec4">Concurrent Collections</h4>
<p class="noindent">The <code>java.util.concurrent</code> package also 
contains several concurrent collections that can be concurrently read 
and modified by multiple threads, but without the copy-on-write behavior
 seen in the copy-on-write collections. The concurrent collections 
include</p>
<p class="bullt"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>ConcurrentHashMap</code></p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>ConcurrentLinkedDeque</code></p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>ConcurrentLinkedQueue</code></p>
<p class="bull"><span id="page_737" epub:type="pagebreak"></span><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>ConcurrentSkipListMap</code></p>
<p class="bullb"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>ConcurrentSkipListSet</code></p>
<p class="indent">Be aware that an <code>Iterator</code> for a concurrent collection is weakly consistent; it can return elements from the point in time the <code>Iterator</code> was created <strong>or later</strong>.
 This means that while you are looping through a concurrent collection, 
you might observe elements that are being inserted by other threads. In 
addition, you may observe only some of the elements that another thread 
is inserting with methods such as <code>addAll</code> when concurrently reading from the collection. Similarly, the <code>size</code>
 method may produce inaccurate results. Imagine attempting to count the 
number of people in a checkout line at a grocery store. While you are 
counting the people in line, some people may join the line and others 
may leave. Your count might end up close but not exact by the time you 
reach the end. This is the type of behavior you might see with a weakly 
consistent collection. The benefit to this type of behavior is that it 
is permissible for multiple threads to concurrently read and write a 
collection without having to create multiple internal copies of the 
collection, as is the case in a copy-on-write collection. If your 
application cannot deal with these inconsistencies, you might have to 
use a copy-on-write collection.</p>
<p class="indent">The <code>ConcurrentHashMap</code> and <code>ConcurrentSkipListMap</code> classes implement the <code>ConcurrentMap</code> interface. A <code>ConcurrentMap</code> enhances a <code>Map</code> by adding the atomic <code>putIfAbsent</code>, <code>remove</code>, and <code>replace</code> methods. For example, the <code>putIfAbsent</code> method is equivalent to performing the following code as an atomic operation:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un737-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un737-01.jpg" width="285" height="71"></p>
<p class="indent"><code>ConcurrentSkipListMap</code> and <code>ConcurrentSkipListSet</code> are sorted. <code>ConcurrentSkipListMap</code> keys and <code>ConcurrentSkipListSet</code> elements require the use of the <code>Comparable</code> or <code>Comparator</code> interfaces to enable ordering.</p>
<h4 class="h4" id="ch11lev2sec5">Blocking Queues</h4>
<p class="noindent">The copy-on-write and the concurrent collections are
 centered on the idea of multiple threads sharing data. Sometimes, 
instead of shared data (objects), you need to transfer data between two 
threads. A <code>BlockingQueue</code> is a type of shared collection 
that is used to exchange data between two or more threads while causing 
one or more of the threads to wait until the point in time when the data
 can be exchanged. One use <span id="page_738" epub:type="pagebreak"></span>case of a <code>BlockingQueue</code>
 is called the producer-consumer problem. In a producer-consumer 
scenario, one thread produces data, then adds it to a queue, and another
 thread must consume the data from the queue. A queue provides the means
 for the producer and the consumer to exchange objects. The <code>java.util.concurrent</code> package provides several <code>BlockingQueue</code> implementations. They include</p>
<p class="bullt"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>ArrayBlockingQueue</code></p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>LinkedBlockingDeque</code></p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>LinkedBlockingQueue</code></p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>PriorityBlockingQueue</code></p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>DelayQueue</code></p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>LinkedTransferQueue</code></p>
<p class="bullb"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>SynchronousQueue</code></p>
<h5 class="h5">General Behavior</h5>
<p class="noindent">A blocking collection, depending on the method being
 called, may cause a thread to block until another thread calls a 
corresponding method on the collection. For example, if you attempt to 
remove an element by calling <code>take()</code> on any <code>BlockingQueue</code>
 that is empty, the operation will block until another thread inserts an
 element. Don’t call a blocking operation in a thread unless it is safe 
for that thread to block. The commonly used methods in a <code>BlockingQueue</code> are described in the following table.</p>
<p class="imaget"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/t0738-01.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/t0738-01.jpg" width="901" height="402"></p>
<p class="imaget"><span id="page_739" epub:type="pagebreak"></span><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/t0739-01.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/t0739-01.jpg" width="901" height="422"></p>
<h5 class="h5">Bounded Queues</h5>
<p class="noindent"><code>ArrayBlockingQueue</code>, <code>LinkedBlockingDeque</code>, and <code>LinkedBlockingQueue</code> support a bounded capacity and will block on <code>put(e)</code> and similar operations if the collection is full. <code>LinkedBlockingQueue</code> is optionally bounded, depending on the constructor you use.</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un739-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un739-01.jpg" width="519" height="131"></p>
<h5 class="h5">Special-Purpose Queues</h5>
<p class="noindent">A <code>SynchronousQueue</code> is a special type of
 bounded blocking queue; it has a capacity of zero. Having a zero 
capacity, the first thread to attempt either an insert or remove 
operation on a <code>SynchronousQueue</code> will block until another thread performs the opposite operation. You use a <code>SynchronousQueue</code> when you need threads to meet up and exchange an object.</p>
<p class="indent">A <code>DelayQueue</code> is useful when you have objects that should not be consumed until a specific time. The elements added to a <code>DelayQueue</code> will implement the <span id="page_740" epub:type="pagebreak"></span><code>java.util.concurrent.Delayed</code> interface, which defines a single method: <code>public long getDelay(TimeUnit unit)</code>. The elements of a <code>DelayQueue</code> can only be taken once their delay has expired.</p>
<h5 class="h5">The LinkedTransferQueue</h5>
<p class="noindent">A <code>LinkedTransferQueue</code> (added in Java 7) is a superset of <code>ConcurrentLinkedQueue</code>, <code>SynchronousQueue</code>, and <code>LinkedBlockingQueue</code>. It can function as a concurrent <code>Queue</code> implementation similar to <code>ConcurrentLinkedQueue</code>. It also supports unbounded blocking (consumption blocking) similar to <code>LinkedBlockingQueue</code> via the <code>take()</code> method. Like a <code>SynchronousQueue</code>, a <code>LinkedTransferQueue</code> can be used to make two threads rendezvous to exchange an object. Unlike a <code>SynchronousQueue</code>, a <code>LinkedTransferQueue</code> has internal capacity, so the <code>transfer(E)</code> method is used to block until the inserted object (and any previously inserted objects) is consumed by another thread.</p>
<p class="indent">In other words, a <code>LinkedTransferQueue</code> might do almost everything you need from a <code>Queue</code>.</p>
<p class="indent">Because a <code>LinkedTransferQueue</code> implements the <code>BlockingQueue</code>, <code>TransferQueue</code>, and <code>Queue</code>
 interfaces, it can be used to showcase all the different methods that 
can be used to add and remove elements using the various types of 
queues. Creating a <code>LinkedTransferQueue</code> is easy. Because <code>LinkedTransferQueue</code> is not bound by size, a limit to the number of elements CANNOT be supplied to its constructor.</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un740-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un740-01.jpg" width="420" height="32"></p>
<p class="indent">There are many methods to add a single element to a <code>LinkedTransferQueue</code>. Note that any method that blocks or waits for any period may throw an <code>InterruptedException</code>.</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un740-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un740-02.jpg" width="677" height="209"></p>
<p class="imageip"><span id="page_741" epub:type="pagebreak"></span><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un741-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un741-01.jpg" width="612" height="169"></p>
<p class="indent">Shown next are the various methods to access a single value in a <code>LinkedTransferQueue</code>. Again, any method that blocks or waits for any period may throw an <code>InterruptedException</code>.</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un741-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un741-02.jpg" width="596" height="325"></p>
<p class="text-icon"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/onjob.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/onjob.jpg" width="116" height="80"></p>
<p class="noindent"><strong><em>Use a <code>LinkedTransferQueue</code> (added in Java 7) instead of another comparable queue type. The other <code>java.util.concurrent</code> queues (introduced in Java 5) are less efficient than <code>LinkedTransferQueue</code>.</em></strong></p>
<h4 class="h4" id="ch11lev2sec6">Controlling Threads with CyclicBarrier</h4>
<p class="noindent">Whereas blocking queues force threads to wait based on capacity or until a method is called on the queue, a <code>CyclicBarrier</code>
 can force threads to wait at a specific point in the execution until 
all threads reach that point before continuing. You can think of that 
point in the execution as a <em>barrier:</em> no thread can proceed beyond that point until all other threads have also reached it.</p>
<p class="indent">Imagine you have two threads that are processing data 
in arrays and you want to copy the processed data from the arrays to a 
final <code>ArrayList</code> that contains data <span id="page_742" epub:type="pagebreak"></span>from both threads. You can’t have both threads accessing the final <code>ArrayList</code> because <code>ArrayList</code>
 is not thread-safe. It is better to wait until both threads are done 
processing the arrays and only then copy the data to the final <code>ArrayList</code> using one thread.</p>
<p class="indent">This is an example of the type of problem where <code>CyclicBarrier</code>
 can be useful. When you can break up a problem into smaller pieces that
 can be processed concurrently and then combine the data into a result 
at certain key points in the processing, using a <code>CyclicBarrier</code> ensures the threads wait for each other at those key points in the execution.</p>
<p class="indent">Let’s take a look at some code to see how to use <code>CyclicBarrier</code> to force two threads to wait for each other. In this example, we’ll use the optional <code>Runnable</code> that <code>CyclicBarrier</code> will take and run, once both threads reach the barrier point. This <code>Runnable</code>
 is run only one time, by the last thread to reach the barrier and 
before any of the threads can continue, ensuring the code in the <code>Runnable</code>
 is thread-safe. Each thread processes a small array and then ends, but 
imagine how this idea might be applied to threads processing large 
arrays a chunk at a time and continuing after a barrier is reached. In 
fact, that’s exactly why <code>CyclicBarrier</code> is named “cyclic”: the <code>CyclicBarrier</code> can be reused after the threads are released to continue running.</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un742-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un742-01.jpg" width="638" height="462"></p>
<p class="imageip"><span id="page_743" epub:type="pagebreak"></span><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un743-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un743-01.jpg" width="661" height="616"></p>
<p class="indent">In this example, we have two arrays of dog names and 
the processing is quite simple; we just convert the first letter of each
 dog name from lowercase to uppercase. Once both arrays have been 
processed, we then combine the results into an <code>ArrayList</code> of dog names. In the class <code>CB</code>, we define the <code>result ArrayList</code>, where we’ll write results when both threads have finished processing the two arrays, <code>dogs1</code> and <code>dogs2</code>. We also declare the <code>CyclicBarrier</code> that both threads will use to wait for each other. Let’s step through how the code executes (follow the numbers in the code):</p>
<p class="numlistt">1.&nbsp;&nbsp;&nbsp;In the <code>CB</code> constructor, we create a new <code>CyclicBarrier</code>, passing in the number of threads that will wait at the <code>barrier</code> <strong>and a Runnable that will be run by the last thread to reach the barrier.</strong> Here, we’re using a lambda expression for this <code>Runnable</code>.</p>
<p class="numlist"><span id="page_744" epub:type="pagebreak"></span>2.&nbsp;&nbsp;&nbsp;We then create two threads, <code>t1</code> and <code>t2</code>, and pass each the <code>ProcessDogs Runnable</code>. When we create the <code>ProcessDogs Runnable</code>s for the threads, we pass in the array that the thread will process: we pass <code>dogs1</code> to thread <code>t1</code> and <code>dogs2</code> to thread <code>t2</code>.</p>
<p class="numlist">3.&nbsp;&nbsp;&nbsp;We then start both threads and print a message saying the main thread is done.</p>
<p class="numlist">4.&nbsp;&nbsp;&nbsp;The two threads begin running and process their respective arrays. The <code>ProcessDogs run()</code>
 method simply iterates through the array and converts the first letter 
of the dog name to uppercase, storing the modified string back in the 
original array.</p>
<p class="numlist">5.&nbsp;&nbsp;&nbsp;Once the loop is complete, the thread then waits at the barrier by calling the barrier’s <code>await()</code> method. We’ll come back and talk about the exception handling in a minute.</p>
<p class="numlist">6.&nbsp;&nbsp;&nbsp;Once both threads reach the barrier, then the <code>Runnable</code> we passed to the <code>CyclicBarrier</code> constructor is executed by the last thread to reach the barrier. This adds all the items from both arrays to the <code>ArrayList result</code> and prints the <code>result</code>.</p>
<p class="numlistb">7.&nbsp;&nbsp;&nbsp;When the <code>Runnable</code> 
completes, then both threads are released and can continue executing 
where they left off at the barrier. In this example, each thread just 
prints a message to the console indicating it’s done (with the thread 
name), but you can imagine that in a more realistic example, they could 
continue on to do more processing. Notice that neither thread can print 
out that it’s done until <em>both</em> threads have reached the barrier and the barrier <code>Runnable</code> is complete.</p>
<p class="indent">If you have a machine with at least two cores and you 
run this code several times, you may see thread 0 displaying the result 
or you may see thread 1 displaying the result. It just depends on which 
thread gets to the barrier last. Also, notice that the main thread often
 finishes before the other threads, but not always. The most important 
point to notice is that <em>every time</em> you run this code, you will see the resulting <code>ArrayList</code> displayed <em>before</em> the messages from the threads that they are done. Why? Because both threads must wait at the barrier for the barrier <code>Runnable</code> to complete before they can continue!</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un744-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un744-01.jpg" width="555" height="69"></p>
<p class="indent"><span id="page_745" epub:type="pagebreak"></span>Now let’s get back to the exception handling on the <code>barrier.await()</code> method. What if one of the threads gets stuck? If this happens, then all the other threads waiting at the barrier get an <code>InterruptedException</code> or a <code>BrokenBarrierException</code> and are all released. In that case, the barrier <code>Runnable</code> will not run and the remaining threads will continue.</p>
<p class="indent">You can reuse a <code>CyclicBarrier</code> or use multiple <code>CyclicBarriers</code> to coordinate threads at more than one barrier point. For example, you might have the thread <code>Runnable</code>
 execute some code, wait at barrier 1, then execute some more code, wait
 at barrier 2, and then finally execute more code and finish. To reset a
 barrier to its initial state, call the <code>reset()</code> method. If you need the main thread to also wait at the barrier, you can call <code>await()</code>
 on the barrier in the main thread, but don’t forget to increase the 
number of threads allowed at the barrier by one when you create the <code>CyclicBarrier</code>.</p>
<p class="title-o"><span class="white"><strong>CERTIFICATION OBJECTIVE</strong></span></p>
<h3 class="h3" id="ch11lev1sec4"><strong>Use Executors and ThreadPools (OCP Objective 10.1)</strong></h3>
<p class="noindent"><em>10.1&nbsp;&nbsp;&nbsp;Create worker threads using Runnable, Callable and use an ExecutorService to concurrently execute tasks.</em></p>
<p class="indentt"><code>Executor</code>s (and the <code>ThreadPools</code> used by them) help meet two of the same needs as <code>Thread</code>s do:</p>
<p class="numlistt">1.&nbsp;&nbsp;&nbsp;Creating and scheduling some Java code for execution and</p>
<p class="numlistb">2.&nbsp;&nbsp;&nbsp;Optimizing the execution of that
 code for the hardware resources you have available (using all CPUs, for
 example)</p>
<p class="indent">With traditional threading, you handle needs 1 and 2 yourself. With <code>Executor</code>s, you handle need 1, but you get to use an off-the-shelf solution for need 2. The <code>java.util.concurrent</code> package provides several different off-the-shelf solutions (<code>Executor</code>s and <code>ThreadPool</code>s), which you’ll read about in this chapter.</p>
<p class="text-icon"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/onjob.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/onjob.jpg" width="116" height="80"></p>
<p class="noindent"><strong><em>When you have multiple needs or 
concerns, it is common to separate the code for each need into different
 classes. This makes your application more modular and flexible. This is
 a fundamental programming principle called “separation of concerns.”</em></strong></p>
<p class="indentt"><span id="page_746" epub:type="pagebreak"></span>In a way, an <code>Executor</code> is an alternative to starting new threads. Using <code>Thread</code>s directly can be considered low-level multithreading, whereas using <code>Executor</code>s can be considered high-level multithreading. To understand how an <code>Executor</code> can replace manual thread creation, let us first analyze what happens when starting a new thread.</p>
<p class="numlistt">1.&nbsp;&nbsp;&nbsp;First, you must identify a task 
of some sort that forms a self-contained unit of work. You will 
typically code this task as a class that implements the <code>Runnable</code> interface.</p>
<p class="numlist">2.&nbsp;&nbsp;&nbsp;After creating a <code>Runnable</code>, the next step is to execute it. You have two options for executing a <code>Runnable</code>:</p>
<p class="num-bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<strong>Option one</strong> Call the <code>run</code> method synchronously (i.e., without starting a thread). This is probably <strong>not</strong> what you would normally do.</p>
<p class="num-bull-h"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un746-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un746-01.jpg" width="354" height="33"></p>
<p class="num-bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<strong>Option two</strong> Call the method indirectly, most likely with a new thread.</p>
<p class="num-bull-h"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un746-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un746-02.jpg" width="314" height="51"></p>
<p class="indent">The second approach has the benefit of executing your 
task asynchronously, meaning the primary flow of execution in your 
program can continue executing, without waiting for the task to 
complete. On a multiprocessor system, you must divide a program into a 
collection of asynchronous tasks that can execute 747concurrently in 
order to take advantage of all of the computing power a system 
possesses.</p>
<h4 class="h4" id="ch11lev2sec7">Identifying Parallel Tasks</h4>
<p class="noindent">Some applications are easier to divide into separate
 tasks than others. A single-user desktop application may only have a 
handful of tasks that are suitable for concurrent execution. Networked 
multiuser servers, on the other hand, have a natural division of work. 
Each user’s actions can be a task. Continuing our computer game 
scenario, imagine a computer program that can play chess against 
thousands of people simultaneously. Each player submits his or her move,
 the computer calculates its move, and finally it informs the player of 
that move.</p>
<p class="indent">Why do we need an alternative to <code>new Thread(r).start()</code>? What are the drawbacks? If we use our online chess game scenario, then having 10,000 concurrent <span id="page_747" epub:type="pagebreak"></span>players might mean 10,001 concurrent threads. (One thread awaits network connections from clients and performs a <code>Thread(r).start()</code>
 for each player.) The player thread would be responsible for reading 
the player’s move, computing the computer’s move, and making the 
response.</p>
<h4 class="h4" id="ch11lev2sec8">How Many Threads Can You Run?</h4>
<p class="noindent">Do you own a computer that can concurrently run 
10,000 threads or 1,000 or even 100? Probably not—this is a trick 
question. A quad-core CPU (with four processors per unit) might be able 
to execute two threads per core for a total of eight concurrently 
executing threads. You can start 10,000 threads, but not all of them 
will be running at the same time. The underlying operating system’s task
 scheduler rotates the threads so that they each get a slice of time on a
 processor. Ten thousand threads all competing for a turn on a processor
 wouldn’t make for a very responsive system. Threads would either have 
to wait so long for a turn or get such small turns (or both) that 
performance would suffer.</p>
<p class="indent">In addition, each thread consumes system resources. It
 takes processor cycles to perform a context switch (saving the state of
 a thread and resuming another thread), and each thread consumes system 
memory for its stack space. Stack space is used for temporary storage 
and to keep track of where a thread returns to after completing a method
 call. Depending on a thread’s behavior, it might be possible to lower 
the cost (in RAM) of creating a thread by reducing a thread’s stack 
size.</p>
<p class="text-icon"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/onjob.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/onjob.jpg" width="116" height="80"></p>
<p class="noindent"><strong><em>To reduce a thread’s stack size, the Oracle JVM supports using the nonstandard-<code>Xss1024k</code> option to the <code>java</code>
 command. Note that decreasing the value too far can result in some 
threads throwing exceptions when performing certain tasks, such as 
making a large number of recursive method calls.</em></strong></p>
<p class="indentt">Another limiting factor in being able to run 10,000 
threads in an application has to do with the underlying limits of the 
OS. Operating systems typically have limits on the number of threads an 
application can create. These limits can prevent a buggy application 
from spawning countless threads and making your system unresponsive. If 
you have a legitimate need to run 10,000 threads, you will probably have
 to consult your operating system’s documentation to discover possible 
limits and configuration options.</p>
<h4 class="h4" id="ch11lev2sec9"><span id="page_748" epub:type="pagebreak"></span>CPU-Intensive vs. I/O-Intensive Tasks</h4>
<p class="noindent">If you correctly configure your OS and you have 
enough memory for each thread’s stack space plus your application’s 
primary memory (heap), will you be able to run an application with 
10,000 threads? It depends…. Remember that your processor can only run a
 small number of concurrent threads (in the neighborhood of 8 to 16 
threads). Yet many network server applications, such as our online chess
 game, would have traditionally started a new thread for each connected 
client. A system might be able to run an application with such a high 
number of threads because most of the threads are not doing anything. 
More precisely, in an application like our online chess server, most 
threads would be blocked waiting on I/O operations such as <code>InputStream.read</code> or <code>OutputStream.write</code> method calls.</p>
<p class="indent">When a thread makes an I/O request using <code>InputStream.read</code>
 and the data to be read isn’t already in memory, the calling thread 
will be put to sleep by the system until the requested data can be 
loaded. This is much more efficient than keeping the thread on the 
processor while it has nothing to do. I/O operations are extremely slow 
when compared to compute operations—reading a sector from a hard drive 
takes much longer than adding hundreds of numbers. A processor might 
execute hundreds of thousands, or even millions, of instructions while 
awaiting the completion of an I/O request. The type of work (either CPU 
intensive or I/O intensive) a thread will be performing is important 
when considering how many threads an application can safely run. Imagine
 your world-class-computer 749chess-playing program takes one minute of 
processor time (no I/O at all) to calculate each move. In this scenario,
 it would only take about 16 concurrent players to cause your system to 
have periods of maximum CPU utilization.</p>
<p class="text-icon"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/onjob.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/onjob.jpg" width="116" height="80"></p>
<p class="noindent"><strong><em>If your tasks will be performing I/O 
operations, you should be concerned about how increased load (users) 
might affect scalability. If your tasks perform blocking I/O, then you 
might need to utilize a thread-per-task model. If you don’t, then all 
your threads may be tied up in I/O operations with no threads remaining 
to support additional users. Another option would be to investigate 
whether you can use nonblocking I/O instead of blocking I/O.</em></strong></p>
<h4 class="h4" id="ch11lev2sec10">Fighting for a Turn</h4>
<p class="noindent">If it takes the computer player one minute to 
calculate a turn and it takes a human player about the same time, then 
each player only uses one minute of CPU time out of every two minutes of
 real time. With a system capable of executing 16 concurrent game 
threads, that means we could handle 32 connected players. <span id="page_749" epub:type="pagebreak"></span>But
 if all 32 players make their turn at once, the computer will be stuck 
trying to calculate 32 moves at once. If the system uses preemptive 
multitasking (the most common type), then each thread will get preempted
 while it is running (paused and kicked off the CPU) so a different 
thread can take a turn (time slice). In most JVM implementations, this 
is handled by the underlying operating system’s task scheduler. The task
 scheduler is itself a software program. The more CPU cycles spent 
scheduling and preempting threads, the less processor time you have to 
execute your application threads. Note that it would appear to the 
untrained observer that all 32 threads were running concurrently because
 a preemptive multitasking system will switch out the running threads 
frequently (millisecond time slices).</p>
<h4 class="h4" id="ch11lev2sec11">Decoupling Tasks from Threads</h4>
<p class="noindent">The best design would be one that utilized as many 
system resources as possible without attempting to overutilize the 
system. If 16 threads are all you need to fully utilize your CPU, why 
would you start more than that? In a traditional system, you start more 
threads than your system can concurrently run and hope that only a small
 number are in a running state. If we want to adjust the number of 
threads that are started, we need to decouple the tasks that are to be 
performed (our <code>Runnable</code> instances) from our thread creation and starting. This is where a <code>java.util.concurrent.Executor</code> can help. The basic usage looks something like this:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un749-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un749-01.jpg" width="317" height="51"></p>
<p class="indent">A <code>java.util.concurrent.Executor</code> is used to execute the <code>run</code> method in a <code>Runnable</code> instance much like a thread. Unlike a more traditional <code>new Thread(r).start()</code>, an <code>Executor</code> can be designed to use any number of threading approaches, including</p>
<p class="bullt"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;Not starting any threads at all (task is run in the calling thread)</p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;Starting a new thread for each task</p>
<p class="bullb"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;Queuing tasks and processing them with only enough threads to keep the CPU utilized</p>
<p class="indent">You can easily create your own implementations of an <code>Executor</code>
 with custom behaviors. As you’ll see soon, several implementations are 
provided in the standard Java SE libraries. Looking at sample <code>Executor</code> implementations can help you to <span id="page_750" epub:type="pagebreak"></span>understand their behavior. This next example doesn’t start any new threads; instead, it executes the <code>Runnable</code> using the thread that invoked the <code>Executor</code>.</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un750-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un750-01.jpg" width="492" height="131"></p>
<p class="indent">The following <code>Executor</code> implementation would use a new thread for each task:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un750-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un750-02.jpg" width="483" height="150"></p>
<p class="indent">This example shows how an <code>Executor</code> implementation can be put to use:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un750-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un750-03.jpg" width="532" height="51"></p>
<p class="indent">By coding to the <code>Executor</code> interface, the 
submission of tasks is decoupled from the execution of tasks. The result
 is that you can easily modify how threads are used to execute tasks in 
your applications.</p>
<p class="text-icon"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/onjob.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/onjob.jpg" width="116" height="80"></p>
<p class="noindent"><strong><em>There is no “right number” of threads 
for task execution. The type of task (CPU intensive versus I/O 
intensive), number of tasks, I/O latency, and system resources all 
factor into determining the ideal number of threads to use. You should 
test your applications to determine the ideal threading model. This is 
one reason why the ability to separate task submission from task 
execution is important.</em></strong></p>
<p class="indentt">Several <code>Executor</code> implementations are supplied as part of the standard Java libraries. The <code>Executors</code> class (notice the “s” at the end) is a factory for <code>Executor</code> implementations.</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un750-04.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un750-04.jpg" width="606" height="51"></p>
<p class="indent"><span id="page_751" epub:type="pagebreak"></span>The <code>Executor</code> instances returned by <code>Executors</code> are actually of type <code>ExecutorService</code> (which extends <code>Executor</code>). An <code>ExecutorService</code> provides management capability and can return <code>Future</code> instances that are used to obtain the result of executing a task asynchronously. We’ll talk more about <code>Future</code> in a few pages!</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un751-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un751-01.jpg" width="665" height="50"></p>
<p class="indent">Three types of <code>ExecutorService</code> instances can be created by the factory methods in the <code>Executors</code> class: cached thread pool executors, fixed thread pool executors, and single thread pool executors.</p>
<h5 class="h5">Cached Thread Pools</h5>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un751-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un751-02.jpg" width="491" height="13"></p>
<p class="indent">A cached thread pool will create new threads as they 
are needed and reuse threads that have become free. Threads that have 
been idle for 60 seconds are removed from the pool.</p>
<p class="indent">Watch out! Without some type of external limitation, a
 cached thread pool may be used to create more threads than your system 
can handle.</p>
<h5 class="h5">Fixed Thread Pools—Most Common</h5>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un751-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un751-03.jpg" width="491" height="13"></p>
<p class="indent">A fixed thread pool is constructed using a numeric 
argument (4 in the preceding example) that specifies the number of 
threads used to execute tasks. This type of pool will probably be the 
one you use the most because it prevents an application from overloading
 a system with too many threads. Tasks that cannot be executed 
immediately are placed on an unbounded queue for later execution.</p>
<p class="text-icon"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/onjob.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/onjob.jpg" width="116" height="80"></p>
<p class="noindent"><strong><em>You might base the number of threads in a
 fixed thread pool on some attribute of the system your application is 
executing on. By tying the number of threads to system resources, you 
can create an application that scales with changes in system hardware. 
To query the number of available processors, you can use the <code>java.lang.Runtime</code> class.</em></strong></p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un751-04.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un751-04.jpg" width="332" height="33"></p>
<h5 class="h5"><span id="page_752" epub:type="pagebreak"></span>ThreadPoolExecutor</h5>
<p class="noindent">Both <code>Executors.newCachedThreadPool()</code> and <code>Executors.newFixedThreadPool(4)</code> return objects of type <code>java.util.concurrent.ThreadPoolExecutor</code> (which implements <code>ExecutorService</code> and <code>Executor</code>). You will typically use the <code>Executors</code> factory methods instead of creating <code>ThreadPoolExecutor</code> instances directly, but you can cast the fixed or cached thread pool <code>ExecutorService</code>
 references if you need access to the additional methods. The following 
example shows how you could dynamically adjust the thread count of a 
pool at runtime:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un752-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un752-01.jpg" width="671" height="52"></p>
<h5 class="h5">Single Thread Pools</h5>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un752-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un752-02.jpg" width="528" height="13"></p>
<p class="indent">A single thread pool uses a single thread to execute 
tasks. Tasks that cannot be executed immediately are placed on an 
unbounded queue for later execution. Unlike a fixed thread pool executor
 with a size of 1, a single thread executor prevents any adjustments to 
the number of threads in the pool.</p>
<h5 class="h5">Scheduled Thread Pool</h5>
<p class="noindent">In addition to the three basic <code>ExecutorService</code> behaviors outlined already, the Executors class has factory methods to produce a <code>ScheduledThreadPoolExecutor</code>. A <code>ScheduledThreadPoolExecutor</code> enables tasks to be executed after a delay or at repeating intervals. Here, we see some thread-scheduling code in action:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un752-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un752-03.jpg" width="647" height="207"></p>
<h5 class="h5"><span id="page_753" epub:type="pagebreak"></span>The Callable Interface</h5>
<p class="noindent">So far, the <code>Executors</code> examples have used a <code>Runnable</code> instance to represent the task to be executed. The <code>java.util.concurrent.Callable</code> interface serves the same purpose as the <code>Runnable</code> interface, but provides more flexibility. Unlike the <code>Runnable</code> interface, a <code>Callable</code> may return a result upon completing execution and may throw a checked exception. An <code>ExecutorService</code> can be passed a <code>Callable</code> instead of a <code>Runnable</code>.</p>
<p class="text-icon"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/onjob.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/onjob.jpg" width="116" height="80"></p>
<p class="noindent"><strong><em>Avoid using methods such as <code>Object.wait, Object.notify,</code> and <code>Object.notifyAll</code> in tasks (<code>Runnable</code> and <code>Callable</code> instances) that are submitted to an <code>Executor</code> or <code>ExecutorService</code>. Because you might not know what the threading behavior of an <code>Executor</code>
 is, it is a good idea to avoid operations that may interfere with 
thread execution. Avoiding these types of methods is advisable anyway 
since they are easy to misuse.</em></strong></p>
<p class="indentt"><strong>The primary benefit of using a Callable is the ability to return a result</strong>. Because an <code>ExecutorService</code> may execute the <code>Callable</code> asynchronously (just like a <code>Runnable</code>), you need a way to check the completion status of a <code>Callable</code> and obtain the result later. A <code>java.util.concurrent.Future</code> is used to obtain the status and result of a <code>Callable</code>. Without a <code>Future</code>, you’d have no way to obtain the result of a completed <code>Callable</code> and you might as well use a <code>Runnable</code> (which returns void) instead of a <code>Callable</code>. Here’s a simple <code>Callable</code> example that loops a random number of times and returns the random loop count:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un753-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un753-01.jpg" width="547" height="266"></p>
<p class="indent"><span id="page_754" epub:type="pagebreak"></span>Submitting a <code>Callable</code> to an <code>ExecutorService</code> returns a <code>Future</code> reference. When you use the <code>Future</code> to obtain the <code>Callable</code>’s result, you will have to handle two possible exceptions:</p>
<p class="bullt"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<strong>InterruptedException</strong> Raised when the thread calling the <code>Future</code>’s <code>get()</code> method is interrupted before a result can be returned</p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<strong>ExecutionException</strong> Raised when an exception was thrown during the execution of the <code>Callable</code>’s <code>call()</code> method</p>
<p class="bull-h"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un754-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un754-01.jpg" width="550" height="189"></p>
<p class="text-icon"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/onjob.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/onjob.jpg" width="116" height="80"></p>
<p class="noindent"><strong><em>I/O activities in your <code>Runnable</code> and <code>Callable</code> instances can be a serious bottleneck. In preceding examples, the use of <code>System.out.println()</code> will cause I/O activity. If this wasn’t a trivial example being used to demonstrate <code>Callable</code> and <code>ExecutorService</code>, you would probably want to avoid repeated calls to <code>println()</code> in the <code>Callable</code>. One possibility would be to use <code>StringBuilder</code> to concatenate all output strings and have a single <code>println()</code> call before the <code>call()</code> method returns. Another possibility would be to use a logging framework (see <code>java.util.logging</code>) in place of any <code>println()</code> calls.</em></strong></p>
<h5 class="h5">ThreadLocalRandom</h5>
<p class="noindent">The first <code>Callable</code> example used a <code>java.util.concurrent.ThreadLocalRandom</code>. <code>ThreadLocalRandom</code> was introduced in Java 7 as a new way to create random numbers. <code>Math.random()</code> and shared <code>Random</code> instances are thread-safe, but suffer from contention when used by multiple threads. A <code>ThreadLocalRandom</code> is unique to a thread and will perform better because it avoids any contention. <code>ThreadLocalRandom</code> also provides several convenient methods such as <code>nextInt(int,int)</code> that allow you to specify the range of possible values returned.</p>
<h5 class="h5">ExecutorService Shutdown</h5>
<p class="noindent">You’ve seen how to create <code>Executors</code> and how to submit <code>Runnable</code> and <code>Callable</code> tasks to those <code>Executors</code>. The final component to using an <code>Executor</code> is shutting it down once it is done processing tasks. An <code>ExecutorService</code> should be shut <span id="page_755" epub:type="pagebreak"></span>down
 once it is no longer needed to free up system resources and to allow 
graceful application shutdown. Because the threads in an <code>ExecutorService</code>
 may be nondaemon threads, they may prevent normal application 
termination. In other words, your application stays running after 
completing its main method. You could perform a <code>System.exit(0)</code> call, but it would preferable to allow your threads to complete their current activities (especially if they are writing data).</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un755-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un755-01.jpg" width="538" height="306"></p>
<p class="indent">For long-running tasks (especially those with looping constructs), consider using <code>Thread.currentThread().isInterrupted()</code> to determine if a <code>Runnable</code> or <code>Callable</code> should return early. The <code>ExecutorService.shutdownNow()</code> method will typically call <code>Thread.interrupt()</code> in an attempt to terminate any unfinished tasks.</p>
<p class="title-o"><span class="white"><strong>CERTIFICATION OBJECTIVE</strong></span></p>
<h3 class="h3" id="ch11lev1sec5"><strong>Use the Parallel Fork/Join Framework (OCP Objective 10.5)</strong></h3>
<p class="noindent"><em>10.5&nbsp;&nbsp;&nbsp;Use the parallel Fork/Join Framework.</em></p>
<p class="indentt">The Fork-Join Framework provides a highly specialized <code>ExecutorService</code>. The other <code>ExecutorService</code> instances you’ve seen so far are centered on the concept of submitting multiple tasks to an <code>ExecutorService</code>. By doing this, you provide an easy avenue for an <code>ExecutorService</code> to take advantage of all the <span id="page_756" epub:type="pagebreak"></span>CPUs
 in a system by using threads to complete tasks. Sometimes, you don’t 
have multiple tasks; instead, you have one really big task.</p>
<p class="indent">There are many large tasks or problems you might need 
to solve in your application. For example, you might need to initialize 
the elements of a large array with values. You might think that 
initializing an array doesn’t sound like a large complex task in need of
 a framework. The key is that it needs to be a <strong>large</strong> 
task. What if you need to fill up a 100,000,000-element array with 
randomly generated values? The Fork/Join Framework makes it easier to 
tackle big tasks like this, while leveraging all of the CPUs in a 
system.</p>
<h4 class="h4" id="ch11lev2sec12">Divide and Conquer</h4>
<p class="noindent">Certain types of large tasks can be split up into 
smaller subtasks; those subtasks might, in turn, be split up into even 
smaller tasks. There is no limit to how many times you might subdivide a
 task. For example, imagine the task of having to repaint a single long 
fence that borders several houses. The “paint the fence” task could be 
subdivided so that each household would be responsible for painting a 
section of the fence. Each household could then subdivide their section 
into subsections to be painted by individual family members. In this 
example, there are three levels of recursive calls. The calls are 
considered recursive because at each step we are trying to accomplish 
the same thing: paint the fence. In other words, Joe, one of the home 
owners, was told by his wife, “paint that (huge) fence; it looks old.” 
Joe decides that painting the whole fence is too much work and talks all
 the households along the fence into taking a subsection. Now Joe is 
telling himself “paint that (subsection of) fence; it looks old.” Again,
 Joe decides that it is still too much work and subdivides his section 
into smaller sections for each member of his household. Again, Joe tells
 himself “paint that (subsection of) fence; it looks old,” but this 
time, he decides that the amount of work is manageable and proceeds to 
paint his section of fence. Assuming everyone else paints their 
subsections (hopefully in a timely fashion), the result is the entire 
fence being painted.</p>
<p class="text-icon"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/onjob.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/onjob.jpg" width="116" height="80"></p>
<p class="noindent"><strong><em>When using the Fork/Join Framework, your
 tasks will be coded to decide how many levels of recursion (how many 
times to subdivide) are appropriate. You’ll want to split things up into
 enough subtasks that you have adequate tasks to keep all of your CPUs 
utilized. Sometimes, the best number of tasks can be a little hard to 
determine because of factors we will discuss later. You might have to 
benchmark different numbers of task divisions to find the optimal number
 of subtasks that should be created.</em></strong></p>
<p class="indentt"><span id="page_757" epub:type="pagebreak"></span>Just
 because you can use Fork/Join to solve a problem doesn’t always mean 
you should. If our initial task is to paint eight fence planks, then Joe
 might just decide to paint them himself. The effort involved in 
subdividing the problem and assigning those tasks to workers (threads) 
can sometimes be more than the actual work you want to perform. The 
number of elements (or fence planks) is not the only thing to 
consider—the amount of work performed on each element is also important.
 Imagine if Joe was asked to paint a mural on each fence plank. Because 
processing each element (fence plank) is so time consuming, in this 
case, it might be beneficial to adopt a divide-and-conquer solution even
 though there is a small number of elements.</p>
<h4 class="h4" id="ch11lev2sec13">ForkJoinPool</h4>
<p class="noindent">The Fork/Join <code>ExecutorService</code> implementation is <code>java.util.concurrent.ForkJoinPool</code>. You will typically submit a single task to a <code>ForkJoinPool</code> and await its completion. The <code>ForkJoinPool</code>
 and the task itself work together to divide and conquer the problem. 
Any problem that can be recursively divided can be solved using 
Fork/Join. Anytime you want to perform the same operation on a 
collection of elements (painting thousands of fence planks or 
initializing 100,000,000 array elements), consider using Fork/Join.</p>
<p class="indent">To create a <code>ForkJoinPool</code>, simply call its no-arg constructor:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un757-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un757-01.jpg" width="378" height="13"></p>
<p class="indent">The no-arg <code>ForkJoinPool</code> constructor creates an instance that will use the <code>Runtime.availableProcessors()</code>
 method to determine the level of parallelism. The level of parallelism 
determines the number of threads that will be used by the <code>ForkJoinPool</code>.</p>
<p class="indent">There is also a <code>ForkJoinPool(int parallelism)</code> constructor that allows you to override the number of threads that will be used.</p>
<h4 class="h4" id="ch11lev2sec14">ForkJoinTask</h4>
<p class="noindent">Just as with <code>Executors</code>, you must capture the task to be performed as Java code. With the Fork/Join Framework, a <code>java.util.concurrent.ForkJoinTask</code>
 instance (actually a subclass—more on that later) is created to 
represent the task that should be accomplished. This is different from 
other executor services that primarily used either <code>Runnable</code> or <code>Callable</code>. A <code>ForkJoinTask</code> concrete subclass has many methods (most of which you will never use), <strong>but the following methods are important: compute(), fork(), and join().</strong></p>
<p class="indent"><span id="page_758" epub:type="pagebreak"></span>A <code>ForkJoinTask</code> subclass is where you will perform most of the work involved in completing a Fork/Join task. <code>ForkJoinTask</code> is an abstract base class; we will discuss the two subclasses, <code>RecursiveTask</code> and <code>RecursiveAction</code>, later. The basic structure of any <code>ForkJoinTask</code> is shown in this pseudocode example:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un758-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un758-01.jpg" width="661" height="249"></p>
<h5 class="h5">Fork</h5>
<p class="noindent"><strong>With the Fork/Join Framework, each thread in the <code>ForkJoinPool</code> has a queue of the tasks it is working on; this is unlike most <code>ExecutorService</code> implementations that have a single shared task queue.</strong> The <code>fork()</code> method places a <code>ForkJoinTask</code> in the current thread’s task queue. A normal thread does not have a queue of tasks—only the specialized threads in a <code>ForkJoinPool</code> do. This means that you can only call <code>fork()</code> if you are within a <code>ForkJoinTask</code> that is being executed by a <code>ForkJoinPool</code>.</p>
<p class="indent">Initially, only a single thread in a <code>ForkJoinPool</code>
 will be busy when you submit a task. That thread will begin to 
subdivide the tasks into smaller tasks. Each time a task is subdivided 
into two subtasks, you fork (or queue) the first task and compute the 
second task. In the event you need to subdivide a task into more than 
two subtasks, each time you split a task, you would fork every new 
subtask except one (which would be computed).</p>
<p class="imagef"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un758-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un758-02.jpg" width="798" height="155"></p>
<h5 class="h5"><span id="page_759" epub:type="pagebreak"></span>Work Stealing</h5>
<p class="noindent">Notice how the call to <code>fork()</code> is placed before the call to <code>compute()</code> or <code>join()</code>. A key feature of the Fork/Join Framework is work stealing. Work stealing is how the other threads in a <code>ForkJoinPool</code> will obtain tasks. When initially submitting a Fork/Join task for execution, a single thread from a <code>ForkJoinPool</code> begins executing (and subdividing) that task. Each call to <code>fork()</code>
 placed a new task in the calling thread’s task queue. The order in 
which the tasks are queued is important. The tasks that have been queued
 the longest represent larger amounts of work. In the <code>ForkJoinPaintTask</code>
 example, the task that represents 100 percent of the work would begin 
executing, and its first queued (forked) task would represent 50 percent
 of the fence, the next 25 percent, then 12.5 percent, and so on. Of 
course, this can vary, depending on how many times the task will be 
subdivided and whether we are 760splitting the task into halves or 
quarters or some other division, but in this example, we are splitting 
each task into two parts: queuing one part and executing the second 
part.</p>
<p class="indent">The nonbusy threads in a <code>ForkJoinPool</code> will attempt to steal the oldest (and, therefore, largest) task from any Fork/Join thread with queued tasks. Given a <code>ForkJoinPool</code>
 with four threads, one possible sequence of events could be that the 
initial thread queues tasks that represent 50 percent and 25 percent of 
the work, which are then stolen by two different threads. The thread 
that stole the 50 percent task then subdivides that task and places a 25
 percent task on its queue, which is then stolen by a fourth thread, 
resulting in four threads that each process 25 percent of the work.</p>
<p class="imagef"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un759-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un759-01.jpg" width="786" height="454"></p>
<p class="indent"><span id="page_760" epub:type="pagebreak"></span>Of 
course, if everything was always this evenly distributed, you might not 
have as much of a need for Fork/Join. You could just presplit the work 
into a number of tasks equal to the number of threads in your system and
 use a regular <code>ExecutorService</code>. In practice, each of the 
four threads will not finish their 25 percent of the work at the same 
time—one thread will be the slow thread that doesn’t get as much work 
done. There are many reasons for this: The data being processed may 
affect the amount of computation (25 percent of an array might not mean 
25 percent of the workload), or a thread might not get as much time to 
execute as the other threads. Operating systems and other running 
applications are also going to consume CPU time. In order to finish 
executing the Fork/Join task as 761soon as possible, the threads that 
finish their portions of the work first will start to steal work from 
the slower threads—this way, you will be able to keep all of the CPU 
involved. If you only split the tasks into 25 percent of the data (with 
four threads), then there would be nothing for the faster threads to 
steal from when they finish early. In the beginning, if the slower 
thread stole 25 percent of the work and started processing it without 
further subdividing and queuing, then there would be no work on the slow
 thread’s queue to steal. You should subdivide the tasks into a few more
 sections than are needed to evenly distribute the work among the number
 of threads in your <code>ForkJoinPool</code>s because threads will most
 likely not perform exactly the same. Subdividing the tasks is extra 
work—if you do it too much, you might hurt performance. Subdivide your 
tasks enough to keep all CPUs busy, but not more than is needed. 
Unfortunately, there is no magic number to split your tasks into—it 
varies based on the complexity of the task, the size of the data, and 
even the performance characteristics of your CPUs.</p>
<p class="indent">Back to fence painting, make the <code>isFenceSectionSmall()</code>
 logic as simple as possible (low overhead) and easy to change. You 
should benchmark your Fork/Join code (using the hardware that you expect
 the code to typically run on) and find an amount of task subdivision 
that works well. It doesn’t have to be perfect; once you are close to 
the ideal range, you probably won’t see much variation in performance 
unless other factors come into play (different CPUs, etc.).</p>
<h5 class="h5">Join</h5>
<p class="noindent">When you call <code>join()</code> on the (left) task, it should be one of the last steps in the <code>compute</code> method, after calling <code>fork()</code> and <code>compute()</code>. Calling <code>join()</code> says, “I can only proceed when this (left) task is done.” Several possible things can happen when you call <code>join()</code>:</p>
<p class="bullt"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;The task you call <code>join()</code> on might already be done. Remember you are calling <code>join()</code> on a task that already had <code>fork()</code> called. The task might have been stolen and completed by another thread. In this case, calling <code>join()</code> just verifies the task is complete and you can continue on.</p>
<p class="bull"><span id="page_761" epub:type="pagebreak"></span><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;The task you call <code>join()</code>
 on might be in the middle of being processed. Another thread could have
 stolen the task, and you’ll have to wait until the joined task is done 
before continuing.</p>
<p class="bullb"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;The task you call <code>join()</code> on might still be in the queue (not stolen). In this case, the thread calling <code>join()</code> will execute the joined task.</p>
<h5 class="h5">RecursiveAction</h5>
<p class="noindent"><code>ForkJoinTask</code> is an abstract base class that outlines most of the methods, such as <code>fork()</code> and <code>join()</code>, in a Fork/Join task. If you need to create a <code>ForkJoinTask</code> that does not return a result, then you should subclass <code>RecursiveAction</code>. <code>RecursiveAction</code> extends <code>ForkJoinTask</code> and has a single abstract compute method that you must implement:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un761-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un761-01.jpg" width="314" height="13"></p>
<p class="indent">An example of a task that does not need to return a 
result would be any task that initializes an existing data structure. 
The following example will initialize an array to contain random values.
 Notice that there is only a single array throughout the entire process.
 When subdividing an array, you should avoid creating new objects when 
possible.</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un761-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un761-02.jpg" width="637" height="481"></p>
<p class="imageip"><span id="page_762" epub:type="pagebreak"></span><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un762-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un762-01.jpg" width="523" height="91"></p>
<p class="indent">Sometimes, you will see one of the <code>invokeAll</code> methods from the <code>ForkJoinTask</code> class used in place of the fork/compute/join method combination. 763The <code>invokeAll</code> methods are convenience methods that can save some typing. Using them will also help you avoid bugs! The first task passed to <code>invokeAll</code>
 will be executed (compute is called), and all additional tasks will be 
forked and joined. In the preceding example, you could eliminate the 
three fork/compute/join lines and replace them with a single line:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un762-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un762-02.jpg" width="163" height="13"></p>
<p class="indent">To begin the application, we create a large array and initialize it using Fork/Join:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un762-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un762-03.jpg" width="519" height="133"></p>
<p class="indent">Notice that we do not expect any return values when calling invoke. A <code>RecursiveAction</code> returns nothing.</p>
<h5 class="h5">RecursiveTask</h5>
<p class="noindent">If you need to create a <code>ForkJoinTask</code> that does return a result, then you should subclass <code>RecursiveTask</code>. <code>RecursiveTask</code> extends <code>ForkJoinTask</code> and has a single abstract compute method that you must implement:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un762-04.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un762-04.jpg" width="504" height="14"></p>
<p class="indent">The following example will find the position in an 
array with the greatest value; if duplicate values are found, the first 
occurrence is returned. Notice that there is only a single array 
throughout the entire process. (Just like before, when subdividing an 
array, you should avoid creating new objects when possible.)</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un762-05.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un762-05.jpg" width="641" height="92"></p>
<p class="imageip"><span id="page_763" epub:type="pagebreak"></span><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un763-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un763-01.jpg" width="666" height="714"></p>
<p class="indent">To begin the application, we reuse the <code>RecursiveAction</code>
 example to create a large array and initialize it using Fork/Join. 
After initializing the array with random values, we reuse the <code>ForkJoinPool</code> with our <code>RecursiveTask</code> to find the position with the greatest value:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un763-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un763-02.jpg" width="487" height="131"></p>
<p class="imageip"><span id="page_764" epub:type="pagebreak"></span><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un764-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un764-01.jpg" width="669" height="91"></p>
<p class="indent">Notice that a value is returned by the call to invoke when using a <code>RecursiveTask</code>.</p>
<p class="text-icon"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/onjob.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/onjob.jpg" width="116" height="80"></p>
<p class="noindent"><strong><em>If your application will repeatedly submit tasks to a <code>ForkJoinPool</code>, then you should reuse a single <code>ForkJoinPool</code> instance and avoid the overhead involved in creating a new instance.</em></strong></p>
<h5 class="h5">Embarrassingly Parallel</h5>
<p class="noindent">A problem or task is said to be embarrassingly 
parallel if little or no additional work is required to solve the 
problem in a parallel fashion. Sometimes, solving a problem in parallel 
adds so much more overhead that the problem can be solved faster 
serially. The <code>RandomInitRecursiveAction</code> example, which 
initializes an array to random values, has no additional overhead 
because what happens when processing one subsection of an array has no 
bearing on the processing of another subsection. Technically, there is a
 small amount of overhead even in the <code>RandomInitRecursiveAction</code>; the Fork/Join Framework and the <code>if</code>
 statement that determines whether the problem should be subdivided both
 introduce some overhead. Be aware that it can be difficult to get 
performance gains that scale with the number of CPUs you have. 
Typically, four CPUs will result in less than a 4× speedup when moving 
from a serial to a parallel solution.</p>
<p class="indent">The <code>FindMaxPositionRecursiveTask</code> example,
 which finds the largest value in an array, does introduce a small 
additional amount of work because you must compare the result from each 
subsection and determine which is greater. This is only a small amount, 
however, and adds little overhead. Some tasks may introduce so much 
additional work that any advantage of using parallel processing is 
eliminated (the task runs slower than serial execution). If you find 
yourself performing a lot of processing after calling <code>join()</code>,
 then you should benchmark your application to determine if there is a 
performance benefit to using parallel processing. Be aware that 
performance benefits might only be seen with a certain number of CPUs. A
 task might run on one CPU in 5 seconds, on two CPUs in 6 seconds, and 
on four CPUs in 3.5 seconds.</p>
<p class="indent">The Fork/Join Framework is designed to have minimal 
overhead as long as you don’t over-subdivide your tasks and the amount 
of work required to join results can <span id="page_765" epub:type="pagebreak"></span>be
 kept small. A good example of a task that incurs additional overhead 
but still benefits from Fork/Join is array sorting. When you split an 
array into two 766halves and sort each half separately, you then have to
 combine the two sorted arrays, as shown in the following example:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un765-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un765-01.jpg" width="576" height="792"></p>
<p class="imageip"><span id="page_766" epub:type="pagebreak"></span><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un766-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un766-01.jpg" width="564" height="133"></p>
<p class="indent">In the previous example, everything after the call to <code>invokeAll</code> is related to merging two sorted subsections of an array into a single larger sorted subsection.</p>
<p class="text-icon"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/onjob.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/onjob.jpg" width="116" height="80"></p>
<p class="noindent"><strong><em>Because Java applications are portable, 
the system running your application may not have the hardware resources 
required to see a performance benefit. Always perform testing to 
determine which problem and hardware combinations see performance 
increases when using Fork/Join.</em></strong></p>
<p class="title-o"><span class="white"><strong>CERTIFICATION OBJECTIVE</strong></span></p>
<h3 class="h3" id="ch11lev1sec6"><strong>Parallel Streams (OCP Objective 10.6)</strong></h3>
<p class="noindent"><em>10.6&nbsp;&nbsp;&nbsp;Use parallel Streams including reduction, decomposition, merging processes, pipelines and performance.</em></p>
<p class="indentt">Parallel streams are designed for problems you can 
divide and conquer, just like the problems described in the previous 
section. In fact, parallel streams are implemented with Fork/Join tasks 
under the covers, so you’re essentially doing the same thing: that is, 
splitting up a problem into subtasks that can be executed on separate 
threads and then joining them back together to produce a result.</p>
<p class="indent">Unlike the code you write to take advantage of the 
Fork/Join Framework, parallel stream code is relatively easy to write. 
If you think writing <code>RecursiveAction</code>s and <code>RecursiveTask</code>s
 is tricky (we do too!), you’ll be pleased with how much easier parallel
 streams can be. That said, there are several gotchas to watch out for 
when using parallel streams, so even though the code is easier to write,
 you need to pay close attention.</p>
<p class="indent">And, like we said about using the Fork/Join Framework,
 just because you can use parallel streams to solve a problem doesn’t 
always mean you should. The same concerns apply: the effort to create 
tasks that can run in threads can add enough overhead that using 
parallel <span id="page_767" epub:type="pagebreak"></span>streams is 
sometimes slower than using sequential streams. We’ll do testing as we 
work through some parallel stream code and check our results as we go to
 make sure we get the performance gains we expect.</p>
<h4 class="h4" id="ch11lev2sec15">How to Make a Parallel Stream Pipeline </h4>
<p class="noindent">In <a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch9.xhtml#ch9">Chapter 9</a>, “Streams,” we made a stream parallel by calling the <code>parallel()</code> method on the stream, like this:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un767-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un767-01.jpg" width="612" height="111"></p>
<p class="indent">Here, we take a list of numbers, stream them, map each <code>Integer</code> to an <code>int</code>, and sum. To make this very simple stream pipeline parallel, we simply call the <code>parallel()</code> method on the stream.</p>
<p class="indent">Let’s take a peek at how the tasks created by this parallel stream get split up and handled by workers in the <code>ForkJoinPool</code>. We can do that by adding a <code>peek()</code> into the pipeline and then printing the name of the thread handling each <code>Integer</code> in the stream:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un767-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un767-02.jpg" width="612" height="168"></p>
<p class="noindent">The output (on our computer) is</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un767-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un767-03.jpg" width="334" height="204"></p>
<p class="indent"><span id="page_768" epub:type="pagebreak"></span>You 
will likely see different output (although the same final sum) because 
your computer may have a different number of cores, and the tasks will 
likely get split up differently. We ran this code on a computer with 
eight cores, and you can see that the computer used all eight. We might 
not actually want the computer to use all eight cores (especially for 
this simple sum), so we can tell the computer 769exactly how many 
workers to use by creating a custom <code>ForkJoinPool</code> and then submitting a task to the pool for execution:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un768-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un768-01.jpg" width="630" height="364"></p>
<p class="noindent">Here is our output now:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un768-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un768-02.jpg" width="278" height="207"></p>
<p class="noindent">We get the same sum, 55, but now we’re using only 
two workers to do it. This is friendlier to the computer, which may want
 some cores to do other things while this task is running.</p>
<p class="indent">When we call the <code>submit()</code> method of the <code>ForkJoinPool</code>, we use this method:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un768-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un768-03.jpg" width="405" height="12"></p>
<p class="noindent"><span id="page_769" epub:type="pagebreak"></span>and pass a lambda expression for the <code>Callable</code>. <code>Callable</code>
 is a functional interface, which is why we can express an instance of a
 class implementing that interface with the lambda expression. The 
functional method in <code>Callable</code> is <code>call()</code>, which “computes a result” (thus, the lambda we are supplying for the <code>Callable</code> is a <code>Supplier</code>: it takes no arguments and supplies a result).</p>
<p class="indent">You’ve seen how to create a parallel stream with <code>parallel()</code>; you can also combine the methods <code>stream()</code> and <code>parallel()</code> into one method, <code>parallelStream()</code>, like this:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un769-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un769-01.jpg" width="612" height="130"></p>
<p class="indent">When we run this code (similar to the first version of the code above), we get the following output:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un769-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un769-02.jpg" width="334" height="205"></p>
<p class="indent">Notice the ordering of the processing: the ordering is
 totally different from the first example above! When summing numbers, 
it doesn’t matter in what order they are summed; we’ll get the same 
result every time. In <a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch9.xhtml#ch9">Chapter 9</a>,
 you saw that if you display the result of a parallel stream pipeline, 
the ordering is not guaranteed, and you can see that mixed-up ordering 
in the output here, too.</p>
<p class="indent">You can check to see if a stream is parallel with the <code>isParallel()</code>
 method. This might come in handy if someone hands you a stream and 
you’re not sure. For instance, the following code checks to see if <code>numsStream</code> is parallel:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un769-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un769-03.jpg" width="612" height="110"></p>
<p class="noindent"><span id="page_770" epub:type="pagebreak"></span>You should see the output:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un770-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un770-01.jpg" width="353" height="13"></p>
<p class="indent">What if you have a parallel stream and you want to make it not parallel (i.e., sequential)? You can do that with the <code>sequential()</code> method:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un770-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un770-02.jpg" width="558" height="72"></p>
<p class="noindent">and get the output:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un770-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un770-03.jpg" width="390" height="13"></p>
<p class="indent">Note here that <code>parallel()</code>, <code>isParallel()</code>, and <code>sequential()</code> are methods of <code>BaseStream</code> (which is the superinterface of <code>Stream</code>), and <code>parallelStream()</code> is a method of the <code>Collection</code> interface. <a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11tab1">Table 11-1</a>
 summarizes the methods related to parallel streams that you are 
expected to know for the exam, which we’ll cover in this chapter.</p>
<p class="tabcap" id="ch11tab1"><span class="table"><strong>TABLE 11-1</strong></span> Methods Related to Parallel Streams</p>
<p class="imaget"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tab11-01.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tab11-01.jpg" width="901" height="321"></p>
<h4 class="h4" id="ch11lev2sec16">Embarrassingly Parallel, Take Two (with Parallel Streams)</h4>
<p class="noindent">Earlier we talked about how some problems are 
“embarrassingly parallel”: that is, they’re easily split up into 
independent pieces that can be computed separately and then combined. 
These are precisely the kinds of problems that work well <span id="page_771" epub:type="pagebreak"></span>with
 parallel streams. The sum example we’ve been using in this section is a
 great example of an embarrassingly parallel problem: we can split up 
the stream into subsections, compute the sum of the subsection, and then
 combine the sums from each to make one total sum. We visualized this 
process in <a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch9.xhtml#ch9">Chapter 9</a> with two images. The first illustrates how we compute a sum with a sequential stream:</p>
<p class="imagef"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un771-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un771-01.jpg" width="321" height="274"></p>
<p class="noindent">while the second image illustrates how we can compute a sum with a parallel stream that is using two workers:</p>
<p class="imagef"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un771-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un771-02.jpg" width="304" height="214"></p>
<p class="indent">As you can see in the second illustration, the stream 
can be split in two and each sum computed completely independently from 
the other and then combined at the end. Again, this is precisely the 
kind of problem that works well with parallel streams.</p>
<p class="indent">We can summarize the conditions that make for 
successful parallel streams as follows: a problem is most suitable for 
parallel streams if the pipeline operations are <em>stateless,</em> the reduction operation used to compute the result is <em>associative</em> and <em>stateless,</em> and the stream is <em>unordered</em>.</p>
<p class="indent">Let’s take a look at each of these.</p>
<h5 class="h5"><span id="page_772" epub:type="pagebreak"></span>Associative Operations</h5>
<p class="noindent">We talked about associative operations earlier in <a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch9.xhtml#ch9">Chapter 9</a>. Recall from that chapter that <code>sum()</code>
 is an example of an associative operation. That is, we can compute the 
sum of a + b, and then add c, or we can compute b + c, and then add a, 
and get the same result.</p>
<p class="indent">Some operations are definitely not associative. We discovered in <a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch9.xhtml#ch9">Chapter 9</a>
 that computing the average of a stream of numbers is not associative. 
Recall that when we implemented our own average reduction operation, we 
got an incorrect result. Using the built-in <code>average()</code> method solved the problem in that chapter.</p>
<p class="indent">Because parallel streams are split up for processing 
in unpredictable ways, operations that aren’t associative will probably 
fail. Just to reinforce how important associativity is in properly 
reducing a stream, let’s review how computing the average fails when we 
don’t use the built-in <code>average()</code> method:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un772-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un772-01.jpg" width="636" height="246"></p>
<p class="indent">In the first stream pipeline, we make the stream parallel, then we map to a stream of <code>double</code>s so we can compute the average and return a <code>double</code> value; then we reduce using our own reduction function, which sums two numbers from the stream and divides by 2.</p>
<p class="indent">In the second stream pipeline, we do the same except we reduce with the built-in <code>average()</code>
 stream method, which is implemented in a way to produce the correct 
result (accounting for the inherent nonassociativity of the average 
function).</p>
<p class="indent">We get the output:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un772-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un772-02.jpg" width="539" height="34"></p>
<p class="indent">The point is, just as with sequential stream 
reductions, parallel stream reductions need to be associative. This is 
even more important for parallel streams given that we don’t know how 
the system will split up and then recombine the stream results.</p>
<h5 class="h5"><span id="page_773" epub:type="pagebreak"></span>Stateless Operations (and Streams)</h5>
<p class="noindent">A stateless operation in a stream pipeline is an 
operation that does not depend on the context in which it’s operating. 
Before we talk more about what stateless operations are, let’s talk 
about what they are not.</p>
<p class="indent">There are two main ways you can create a state<em>ful</em> stream pipeline. The first is with <em>side effects</em>. We talked about this in <a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch9.xhtml#ch9">Chapter 9</a>, too; side effects occur when your result creates or depends on changes to state in the pipeline.</p>
<p class="noindentt"><strong>Side Effects and Parallel Streams</strong>&nbsp;&nbsp;&nbsp;We
 already said not to ever modify the source of a stream from within the 
stream pipeline, so you haven’t been—right? Right. That’s one way you 
can create side effects, but you know not to do that.</p>
<p class="indent">Another way you can create side effects is to modify 
the field of an object. In sequential stream pipelines, you can get away
 with these kinds of side effects, and you may recall from <a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch9.xhtml#ch9">Chapter 9</a>
 how we created a list of DVDs from a file input stream. However, in 
parallel stream pipelines, these kinds of side effects will fail unless 
the objects you’re modifying from within the pipeline are synchronized 
(either via a synchronized accessor method or if the objects are a 
concurrent data type).</p>
<p class="indent">Here’s an example: We’re streaming integers between 0 
and 50 (noninclusive), filtering to find integers divisible by 10 and 
then summing those. We’re also attempting to count the integers as we go
 by updating the field of an object. Although we aren’t allowed to 
update a plain variable counter from within a lambda (you’ll get a 
compiler error if you try to do this), we are allowed to update the 
field of an object, as we’re doing here:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un773-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un773-01.jpg" width="661" height="366"></p>
<p class="noindent"><span id="page_774" epub:type="pagebreak"></span>The first time we ran this code, we got:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un774-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un774-01.jpg" width="165" height="12"></p>
<p class="noindent">The next time:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un774-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un774-02.jpg" width="165" height="12"></p>
<p class="indent">Hmmm. We get the right sum (the sum doesn’t depend on 
the counter and doesn’t depend on the ordering), but the counter is not 
always correct (try a bigger number than 50 in the range if this code 
doesn’t produce different <code>counter</code> values for you). That’s because, when we are using a parallel stream, multiple threads are accessing the <code>Count</code> object to modify the counter field and <code>Count</code> is not thread-safe.</p>
<p class="indent">We could use a synchronized object to store our 
counter and that would solve the problem, but it would also defeat the 
purpose of using parallel streams in this example.</p>
<p class="indent">We can fix the code above by removing the count in the parallel stream pipeline and computing it separately from the sum.</p>
<p class="noindentt"><strong>Stateful Operations in the Stream Pipeline</strong>&nbsp;&nbsp;&nbsp;Another
 way we can create stateful stream pipelines is with stateful stream 
operations. A stateful stream operation is one that requires some 
knowledge about the stream in order to operate. Take a look at the 
following stream pipeline:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un774-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un774-03.jpg" width="388" height="52"></p>
<p class="indent">In this code, we are creating a stream of ten <code>int</code>s, limiting the stream to the first five of those <code>int</code>s (0–4) and summing those. The result, as you’d expect, is 10:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un774-04.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un774-04.jpg" width="91" height="10"></p>
<p class="indent">Now think about this operation, <code>limit(5)</code>.
 This is a stateful operation. Why? Because it requires context: the 
stream has to keep some intermediate state to know when it has five 
items and can stop streaming from the source (that is, short circuit the
 stream). So adding <code>parallel()</code> to this stream will not 
improve performance and might even hurt performance because now that 
state has to be synchronized across threads.</p>
<p class="indent">Let’s test this and see what performance we get. We’ll create a stream of 100 million <code>int</code>s, limit the stream to the first 5 <code>int</code>s, and sum, like we just did above. We’ll also time the operation:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un774-05.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un774-05.jpg" width="397" height="52"></p>
<p class="imageip"><span id="page_775" epub:type="pagebreak"></span><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un775-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un775-01.jpg" width="448" height="168"></p>
<p class="noindent">When we run this on our machine (eight cores), we get</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un775-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un775-02.jpg" width="399" height="13"></p>
<p class="noindent">Running it several times takes 28 or 29 milliseconds each time.</p>
<p class="indent">Now, let’s make this a parallel stream and see what we get:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un775-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un775-03.jpg" width="448" height="188"></p>
<p class="noindent">Running this, we get</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un775-04.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un775-04.jpg" width="399" height="13"></p>
<p class="noindent">The performance is worse! Repeated runs yield running times of between 33 and 36 milliseconds each time. Increasing the <code>SIZE</code> to 400 million yields similar results.</p>
<p class="indent">One thing we should consider here is that the overhead
 of creating eight threads might be contributing to the performance 
problem. To really test that a parallel pipeline can hurt (or, at least,
 not help) when using <code>limit()</code>, we should try our experiment with a custom <code>ForkJoinPool</code> and set the number of threads ourselves. Let’s do that.</p>
<p class="indent">The code is similar to what you’ve seen before: we create a custom <code>ForkJoinPool</code>, submit the task to the <code>ForkJoinPool</code>, get the result from the <code>FutureTask</code> that’s returned, and time the whole thing. We’ve bumped up the 777size of the stream to 400 million <code>int</code>s, but we’re still limiting to 5 <code>int</code>s for the sum. For this initial test, <span id="page_776" epub:type="pagebreak"></span>we’ve commented out the call to <code>parallel()</code> in the stream pipeline, so our first test will be on a sequential stream with one thread in the <code>ForkJoinPool</code>:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un776-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un776-01.jpg" width="633" height="422"></p>
<p class="indent">When we ran this code, we got</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un776-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un776-02.jpg" width="492" height="13"></p>
<p class="indent">Now let’s make the stream pipeline parallel and increase the number of threads to two:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un776-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un776-03.jpg" width="623" height="286"></p>
<p class="imageip"><span id="page_777" epub:type="pagebreak"></span><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un777-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un777-01.jpg" width="470" height="74"></p>
<p class="noindent">Run it again and we get</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un777-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un777-02.jpg" width="492" height="13"></p>
<p class="indent">Now using parallel streams is not that much slower 
than running it sequential, but there’s still no benefit to using 
parallel streams; our results from this test indicate that whether we 
use two threads or eight, the parallel pipeline runs no faster than the 
sequential pipeline.</p>
<p class="indent">Run some more experiments yourself. Change the number of workers in the <code>ForkJoinPool</code>; see what happens. Change the <code>LIMIT</code>
 to a much larger number, like 500,000, and see what happens. More than 
likely, you’ll find that the parallel stream pipeline runs the same as 
or more slowly than the sequential stream pipeline for this operation, 
which is what we’d expect.</p>
<p class="indent">We’ve talked about a couple of ways that stream 
pipelines are stateful: that is, stream pipelines are stateful if we 
create side effects (modifying an object as we process the pipeline) or 
if we use a stateful stream operation, like <code>limit()</code>. Other stateful stream operations might be fairly obvious to you; they are <code>skip()</code>, <code>distinct()</code>, and <code>sorted()</code>.
 How do you know which stream operations are stateful? The documentation
 describing these methods says so. And if you think about it, each of 
these operations requires some knowledge about the stream in order for 
the stream to operate.</p>
<p class="indent">Stream operations that are not necessarily stateful include <code>map()</code>, <code>filter()</code>, and <code>reduce()</code>
 (among others), so there’s a lot we can do with streams that is 
stateless, although, as with all things related to concurrency, we need 
to be careful. As you saw in the example above, when we tried to count 
numbers in the stream using a <code>filter()</code>, we can make <code>filter()</code> stateful by creating a side effect.</p>
<p class="indent">Just to revisit quickly a simple example of a parallel stream using <code>map()</code>, <code>filter()</code>, and <code>reduce()</code> stateless operations, here’s a slightly modified take on our original example:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un777-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un777-03.jpg" width="612" height="149"></p>
<p class="indent"><span id="page_778" epub:type="pagebreak"></span>Run this and you should see the following:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un778-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un778-01.jpg" width="175" height="10"></p>
<p class="indent">None of these stream operations requires any state in 
order to operate on the values in the stream pipeline. The map simply 
converts the type of the stream value from <code>Integer</code> to <code>int</code>; the filter simply determines if the value is even or odd, and the reduction (<code>sum()</code>) sums the values, which can happen in any order because <code>sum()</code> is associative, so this operation requires no state either. This is an example of a stateless stream pipeline…well almost.</p>
<p class="indent">Hopefully now, you can see the difference between a 
stateless and a stateful stream pipeline. We’ve mostly talked about what
 a stateless stream pipeline is by talking about what a stateful stream 
pipeline is. The short story is that a stateless stream pipeline is one 
that requires no underlying intermediate state to be stored and accessed
 by the thread(s) in order to execute properly. And that statelessness 
is what helps make parallel stream pipelines more efficient.</p>
<p class="indent">However, we need to do one more thing to make this stream pipeline completely stateless, as you’ll see next.</p>
<h5 class="h5">Unordered Streams</h5>
<p class="noindent">Earlier we said a problem is suitable for parallel 
streams if the operations used to compute the result are associative and
 stateless and the stream is unordered. We’ve talked about the first 
two; what about unordered?</p>
<p class="indent">By default, many (but not all!) streams are ordered. 
That means there is an inherent ordering to the items in the stream. A 
stream of <code>int</code>s created by <code>range()</code> and a stream of <code>Integer</code>s created from a <code>List</code> of <code>Integer</code>s are both ordered streams. Intuitively that makes sense; technically, ordering is determined by whether the stream has an <code>ORDERED</code> <em>characteristic</em>.
 This is just a bit that is set on the underlying implementation of a 
stream. There are other characteristics of streams, including <code>SORTED</code> and <code>DISTINCT</code>,
 but you don’t need to worry too much about characteristics of streams 
except to know that the characteristics of a stream can affect how that 
stream performs, especially if you make the stream parallel.</p>
<p class="indent">Sometimes we want our streams to retain their order; for instance, if we are mapping stream values from <code>int</code>s to <code>Integer</code>,
 filtering to extract the even numbers, and then displaying the results,
 we might want the ordering of the stream to be maintained so we see the
 results in order.</p>
<p class="indent">However, an ordered stream pipeline will not execute 
as efficiently in parallel. Again, it comes down to context: an ordered 
stream has to maintain some state—in this case, the ordering of the 
stream values—to keep the stream values in order, which adds overhead to
 the processing.</p>
<p class="text-icon"><span id="page_779" epub:type="pagebreak"></span><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/onjob.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/onjob.jpg" width="116" height="80"></p>
<p class="noindent"><strong><em>The characteristics of a stream can be inspected by using a <code>Spliterator</code>,
 which is an object for traversing a source, like a collection or a 
stream, that can also split up that source for potential parallel 
processing. <code>Spliterator</code> and its characteristics are not on 
the exam, but if you want to explore how streams (and collections) are 
traversed and partitioned in more detail, you can study <code>Spliterator</code> in depth.</em></strong></p>
<p class="noindentt"><strong><em>Here’s how you can use a stream’s <code>spliterator()</code> method to determine if that stream is ordered:</em></strong></p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un779-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un779-01.jpg" width="612" height="71"></p>
<p class="noindent1"><strong><em>In this case you’ll see that, indeed, the stream of Integers we make from a <code>List</code> is ordered.</em></strong></p>
<p class="indent">If a stream is ordered and we process it in parallel, 
the stream will remain ordered, but at the price of some efficiency. If 
we don’t care about the ordering, as is the case when we are summing 
numbers, we might as well remove the ordering on the stream in scenarios
 where we are using a parallel stream pipeline. That way we get the 
extra performance benefits of working with an unordered stream in a 
situation where we shouldn’t be concerned about the ordering anyway 
(because if we are, then the problem we’re trying to solve probably 
isn’t appropriate for a parallel stream pipeline).</p>
<p class="indent">So how do we make sure we’re working with an unordered
 stream? We can explicitly tell the stream to not worry about remaining 
ordered by calling the <code>unordered()</code> stream method. Of course, we should do this <em>before</em> we call <code>parallel()</code>
 so we can maximize the efficiency of the parallel processing. Here’s 
how we can modify the previous example to create an unordered stream 
pipeline:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un779-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un779-02.jpg" width="612" height="149"></p>
<p class="indent">Calling <code>unordered()</code> doesn’t change the ordering of the stream; it just unsets that <code>ORDERED</code> bit so the stream doesn’t have to maintain the ordering state. <span id="page_780" epub:type="pagebreak"></span>Depending
 on how the stream is processed in the parallel pipeline, you may find 
that the final stream (before the reduction) is in the same order as the
 source, or not. Note that an ordered stream is not the same thing as a 
sorted stream. Once you’ve made a stream unordered, there is no way to 
order it again, except by calling <code>sorted()</code>, which makes it sorted <em>and</em> ordered but not necessarily in the same order as it was in the original source.</p>
<p class="indent">Don’t worry too much about ordering for the exam; do 
remember that ordering has an implication for performance and make sure 
to note which collections create ordered streams (e.g., <code>List</code>) and which create unordered streams (e.g., <code>HashSet</code>) when you call that collection’s <code>stream()</code> method, so you know the performance implications.</p>
<p class="indent">To summarize: to make the most efficient parallel stream, you should:</p>
<p class="bullt"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;Make sure your reductions are associative and stateless.</p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;Avoid side effects.</p>
<p class="bullb"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;Make sure your pipeline is stateless by avoiding contextual operations such as <code>limit()</code>, <code>skip()</code>, <code>distinct()</code>, and <code>sorted()</code>.</p>
<h5 class="h5">forEach() and forEachOrdered()</h5>
<p class="noindent">As you know, <code>forEach()</code> is a terminal stream operation that takes a <code>Consumer</code> and consumes each item in the stream. We often use <code>forEach()</code> to show the values in a stream after a map and/or filter operation, for example:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un780-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un780-01.jpg" width="659" height="13"></p>
<p class="noindent">will display any <code>Dog</code> in the stream whose age is &gt; 7 in the order in which the values in the stream are encountered.</p>
<p class="indent">Imagine we have a <code>Dog</code> class and a <code>Dog</code> constructor that takes the name and age of a dog. You’ve seen the <code>Dog</code> class often enough that we probably don’t have to repeat it. Given that <code>Dog</code> class, we can make some dogs, like this:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un780-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un780-02.jpg" width="444" height="149"></p>
<p class="indent"><span id="page_781" epub:type="pagebreak"></span>Notice
 that we’ve added the dogs in alphabetical order on purpose, so we can 
watch the ordering of our stream when we use a sequential stream and 
when we use a parallel stream.</p>
<p class="indent">Running the code:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un781-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un781-01.jpg" width="659" height="13"></p>
<p class="noindent">gives us the output:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un781-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un781-02.jpg" width="205" height="52"></p>
<p class="noindent">That is, we see all dogs whose age is &gt; 7 in the 
order in which they are encountered in the stream (which is the order in
 which they are added to the <code>List</code>). This is because, by default, when we stream the <code>List</code>, we get a sequential, ordered stream.</p>
<p class="indent">Now, as you might expect at this point, when we make this a parallel stream, we get different results:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un781-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un781-03.jpg" width="332" height="71"></p>
<p class="noindent">This code produced the output:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un781-04.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un781-04.jpg" width="205" height="52"></p>
<p class="indent">The output is unpredictable; if you run it again, you 
may get different results. Even though the stream is ordered (since 
we’re streaming a <code>List</code>), we see the output in a random 
order because the stream is parallel, so the dogs can be processed by 
different threads that may finish at different times, and the <code>forEach() Consumer</code> is stateful: it is essentially creating a side effect by outputting data to the console, which is not thread-safe.</p>
<p class="indent">We can make sure we see the dogs in the order in which they appear in the original source by using the method <code>forEachOrdered()</code> instead:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un781-05.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un781-05.jpg" width="615" height="32"></p>
<p class="indent">We can do this because the underlying stream is ordered (it’s made from a <code>List</code> and its <code>ORDERED</code> characteristic is set), and the <code>forEachOrdered()</code> method will <span id="page_782" epub:type="pagebreak"></span>make sure the items are seen in the same order as they are encountered in the ordered stream. (Note that if we call <code>unordered()</code> on the stream, then the order will not be guaranteed!)</p>
<p class="indent">Of course, this takes a bit of overhead to perform, 
right? As we discussed earlier, an ordered stream is going to be less 
efficient when processed in parallel than an unordered stream. However, 
there may be times when you want to maintain the ordering of the stream 
when processing in parallel and you’re willing to sacrifice a bit of 
efficiency.</p>
<p class="indent">Typically, you won’t end up using <code>forEachOrdered()</code>
 much in the real world; you’re sacrificing performance, and usually you
 don’t want to see the results of a big data operation on a parallel 
stream; you want to collect the results in a new data structure or 
compute some final result like a sum. However, you will see <code>forEachOrdered()</code> on the exam, so make sure you understand how it works.</p>
<p class="indent">Also, note that <code>forEach()</code> (and <code>forEachOrdered()</code>) as well as <code>peek()</code> are stream operations that are designed for side effects. That is, they consume elements from the stream: <code>peek()</code>
 typically creates a side effect (say, printing the stream element 
passing through) and then passes the values on unchanged to the stream; <code>forEach()</code>
 consumes the stream values and produces a result (it’s a terminal 
operation), and typically that result is output to the console or saves 
each item to the field of an object. So take care when using <code>forEach()</code>, <code>forEachOrdered()</code>, and <code>peek()</code>
 with parallel streams, remembering that stream pipelines with side 
effects (even just printing to the console) can change how the stream 
pipeline operates, and reduce the performance of parallel streams.</p>
<h5 class="h5">A Quick Word About findAny()</h5>
<p class="noindent">You might remember from <a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch9.xhtml#ch9">Chapter 9</a> that we used the <code>findAny()</code> stream operation to find any value in the stream pipeline that matched a <code>filter()</code>. For instance, we can use <code>findAny()</code> to find any even <code>int</code> in a stream like this:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un782-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un782-01.jpg" width="556" height="110"></p>
<p class="indent">With a sequential stream, <code>findAny()</code> will likely return the first value in the stream, 0, every time, even though it’s not guaranteed.</p>
<p class="indent"><span id="page_783" epub:type="pagebreak"></span>Now, let’s parallelize this stream and see what happens. We’ll add a <code>peek()</code>, so we can see the thread workers as they work on the problem:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un783-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un783-01.jpg" width="556" height="188"></p>
<p class="indent">We run this and get</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un783-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un783-02.jpg" width="335" height="168"></p>
<p class="indent">Remember, our computer has eight cores, so this stream
 pipeline has been split up into eight workers, each tackling part of 
the stream. The <code>findAny()</code> method is short circuiting, so 
even though we still have 12 more values in the stream to process (since
 the stream has 20 values), we stop as soon as we find the first even 
number. In this run, we had several threads with even numbers: the main 
worker, worker-1, worker-4, and worker-5. It just so happens that the 
main thread probably got done first, and so as soon as that even number 
was found, everything else stopped, and that result, 12, was returned.</p>
<p class="indent">Run the code again, and you’ll likely get a different answer.</p>
<p class="indent">This example illustrates that <code>findAny()</code> really does find any result, particularly when you’re working with a parallel stream pipeline.</p>
<h4 class="h4" id="ch11lev2sec17">A Parallel Stream Implementation of a RecursiveTask</h4>
<p class="noindent">Let’s write code to sum an array of <code>int</code>s with a <code>ForkJoinPool RecursiveTask</code>, and compare that code with a parallel stream (which, remember, uses <code>ForkJoinPool</code> under the covers). We’ll also implement it with a plain-old <code>for</code> loop, so you can see <span id="page_784" epub:type="pagebreak"></span>not
 only how the code itself compares, but also how the performance 
compares. Much of this code should look familiar to you by now.</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un784-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un784-01.jpg" width="644" height="928"></p>
<p class="imageip"><span id="page_785" epub:type="pagebreak"></span><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un785-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un785-01.jpg" width="464" height="933"></p>
<p class="imageip"><span id="page_786" epub:type="pagebreak"></span><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un786-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un786-01.jpg" width="546" height="91"></p>
<p class="indent">This code first generates a large array of random 
numbers between 1 and 10 and then computes the sum of all numbers &gt; 5
 four different times (from the same data, so we should get the same 
answer each time): first, using a plain-old <code>for</code> loop; second, using a <code>RecursiveTask</code>, third, using a parallel stream on the default <code>ForkJoinPool</code> (that is, using all eight cores of our machine); and finally, using a parallel stream on a custom <code>ForkJoinPool</code> with four workers (using four cores).</p>
<p class="indent">Here are our results:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un786-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un786-02.jpg" width="604" height="71"></p>
<p class="noindent">We ran it again and this time we got</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un786-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un786-03.jpg" width="604" height="71"></p>
<p class="indent">In the first run, the parallel stream running on all 
eight cores was the winner, slightly faster than the parallel stream 
running on four cores. Both parallel streams were far superior to the <code>RecursiveTask</code> and the <code>for</code> loop.</p>
<p class="indent">In the second run, this time the parallel stream running on four cores was the clear winner, with the <code>RecursiveTask</code> and the parallel stream running on eight cores about the same, both much faster than the <code>for</code> loop.</p>
<p class="indent">As you can see, your results will vary depending on 
the solution you choose as well as your underlying machine architecture.
 If you get an <code>OutOfMemoryError</code> when you run this, try reducing the <code>SIZE</code>.</p>
<h4 class="h4" id="ch11lev2sec18">Reducing Parallel Streams with reduce()</h4>
<p class="noindent">Let’s say you want to reduce your stream to a value, but none of the built-in stream reduction methods (like <code>sum()</code>) suffice. You can build your own custom reduction with the <code>reduce()</code> function, as you saw in <a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch9.xhtml#ch9">Chapter 9</a>.</p>
<p class="indent">How about building a custom reduction that multiplies 
all the elements of a stream? It’s a bit like computing the sum, except 
we’re multiplying instead. This is known as computing the <em>product</em> (as compared to the sum). Before we write this <span id="page_787" epub:type="pagebreak"></span>reduction, we should check a few things. First, remember that a reduction produces an <code>Optional</code> value unless we provide an identity.</p>
<p class="indent">Recall the type signature of <code>reduce()</code>:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un787-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un787-01.jpg" width="471" height="13"></p>
<p class="noindent">Although the identity is optional, providing one is a good idea because it allows us to get a result (rather than an <code>Optional</code>
 result), and that identity value is also used to make the first result 
in the stream pipeline, and we want to make sure the correct identity is
 being used in our custom reduction.</p>
<p class="indent">For the sum, the identity value is 0 because any 
number added to 0 is that number. For the product, the identity is 1 
because any number multiplied by 1 is that number. So, we’ll use 1. 
That’s easy enough.</p>
<p class="indent">The accumulator is a <code>BinaryOperator</code> that takes two values and produces one value. Remember that an <code>Operator</code> produces a value of the same type as its arguments. Our <code>BinaryOperator</code> is simple; it just takes two numbers and multiples them together, returning a number:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un787-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un787-02.jpg" width="172" height="13"></p>
<p class="indent">Another thing we should check is that our accumulator 
function is associative. Remember the trouble we ran into when we tried 
to reduce using a custom average function? We didn’t get a correct 
result because our average function is not associative, so we had to use
 the built-in <code>average()</code> reduction method instead.</p>
<p class="indent">Is our product function associative? It is. That is, 
we can multiply a * b and then by c and get the same answer as when we 
multiply b * c and then by a.</p>
<p class="indent">Another quick check: Is our accumulator stateless? 
That is, does it rely on any additional state in the stream to be 
computed? If it’s not stateless, then we could run into trouble; either 
we’ll potentially get incorrect results or we’ll drastically reduce the 
performance of the parallel stream (or both!). In this case, our 
reduction function is, indeed, stateless. There is no state needed in 
order to properly multiply two values from the stream and produce a 
result.</p>
<p class="indent">Okay! We’ve got our identity, and we’ve got our 
associative, stateless reduction function. Now we can write the code to 
reduce a parallel stream to the product of all values in the stream:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un787-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un787-03.jpg" width="644" height="111"></p>
<p class="indent"><span id="page_788" epub:type="pagebreak"></span>Here, we start with a <code>List</code> of <code>Integer</code> values and create a stream. We call <code>unordered()</code>
 on that stream so we can get additional efficiency from parallel 
processing—and this works great, because just like addition, computing 
the product does not depend on the order of the values. We then make the
 stream parallel and call the <code>reduce()</code> terminal operation method, passing in our identity, 1, and our product accumulator. Here is the result we get:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un788-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un788-01.jpg" width="240" height="10"></p>
<p class="noindent">That’s the correct answer (phew!). Running the code 
again several times produces the same result each time. It looks like we
 got the code correct.</p>
<p class="indent">As an exercise, you can try this reduction on a much 
larger stream of numbers and time the performance, comparing the 
parallel version with the sequential version. See what results you get!</p>
<h5 class="h5">Collecting Values from a Parallel Stream</h5>
<p class="noindent">As we’ve said before, when processing data with 
streams, you will most likely want to reduce the stream to a single 
value, like a sum or a product or a count, or you might want to collect 
results into a new collection with <code>collect()</code> (which is a reduction, too).</p>
<p class="indent">Consider again our <code>ArrayList</code> of dogs we used above, containing aiko, boi, charis, clover, and zooey.</p>
<p class="indent">If you forget that you aren’t supposed to create side 
effects from a parallel stream pipeline, you might do something like 
this to collect dogs who are older than 7 into a new <code>List</code> collection:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un788-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un788-02.jpg" width="662" height="149"></p>
<p class="indent">Here, we’re initializing a new <code>List</code>, <code>dogsOlderThan7</code>; we’re streaming our original dogs <code>ArrayList</code>,
 making it unordered, making it parallel, filtering for dogs older than 
7, and then making the mistake of saving those dogs older than 7 to our 
new <code>List</code> using a side effect from within a <code>peek()</code> lambda expression. We then terminate the pipeline with the <code>count()</code> operation.</p>
<p class="indent"><span id="page_789" epub:type="pagebreak"></span>The first time we ran this we got the following:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un789-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un789-01.jpg" width="592" height="13"></p>
<p class="noindent">Hmm, definitely a problem there! Running it again, we got this:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un789-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un789-02.jpg" width="667" height="13"></p>
<p class="indent">Clearly, as you should know well by now, this is not 
the way to collect results from a stream pipeline. The reason this fails
 is because we have multiple threads trying to access the <code>List dogsOlderThan7</code> at the same time and <code>dogsOlderThan7</code> is not thread-safe.</p>
<p class="indent">We could fix this code by using a synchronized list, like this:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un789-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un789-03.jpg" width="482" height="32"></p>
<p class="indent">Now, the <code>List</code> is thread-safe. The order of the dogs in the resulting <code>List</code>
 may not be the same as in the source, but at least you’ll get the right
 set of dogs. However, you’re also sacrificing some performance because 
you’re forcing a synchronization of all the threads attempting to write 
to the synchronized <code>List</code>.</p>
<p class="indent">A better way to collect values from a parallel stream pipeline is to use <code>Collectors</code>, as we did in <a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch9.xhtml#ch9">Chapter 9</a> with sequential streams. Here’s how:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un789-04.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un789-04.jpg" width="637" height="129"></p>
<p class="indent">When we run this code, we see the output:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un789-05.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un789-05.jpg" width="602" height="32"></p>
<p class="indent">Now you might be thinking, “Didn’t you just say that the <code>List</code> is not thread-safe? We’re still using a <code>List</code> in the <code>collect()</code> method with <code>Collectors.toList()</code>, so how is this working?”</p>
<p class="indent">Good question. It turns out that the way <code>collect()</code>
 works under the covers is that each worker processing a piece of the 
stream collects its data into its own collection. Worker 1 will create a
 <code>List</code> of dogs older than 7; worker 2 will create a <code>List</code> of dogs older than 7; and so on. Each of these <code>List</code>s is separate, built from <span id="page_790" epub:type="pagebreak"></span>the
 pieces of the stream that each worker got when the stream was split up 
across the parallel workers. At the end, once each thread is complete, 
the separate <code>List</code>s are merged together, in a thread-safe manner, to create one final <code>List</code> of dogs.</p>
<p class="indent"><code>List</code>s are inherently ordered, so we will 
get a reduction in efficiency unless we make sure the stream is 
unordered, which we’ve done by adding a call to <code>unordered()</code>
 at the beginning of the pipeline. (Of course, this means the dogs may 
not be in the same order as they were in the source, but you expected 
that, right?). You can also collect values from a parallel stream with <code>toSet()</code> and <code>toMap()</code>, and a method <code>toConcurrentMap()</code> is there for additional efficiency since merging maps is expensive.</p>
<p class="indent">As we mentioned in <a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch9.xhtml#ch9">Chapter 9</a>, you can use the <code>collect()</code> method with your own supplier, accumulator, and combiner functions if you need a way to collect that isn’t provided for by the <code>Collectors</code> class:</p>
<p class="imageip"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un790-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un790-01.jpg" width="462" height="52"></p>
<p class="indent">If you use a custom collector, just like with the 
custom reduction, you’ll need to make sure that your accumulator is 
associative and stateless. In addition, your combiner should be 
stateless and thread-safe. Typically, the combiner will be adding values
 to a new collection, so using a concurrent collection here is a good 
idea.</p>
<h3 class="h3b" id="ch11lev1sec7">CERTIFICATION SUMMARY</h3>
<hr class="hr">
<p class="noindent">This chapter covered the required concurrency knowledge you’ll need to apply on the certification exam. The <code>java.util.concurrent</code>
 package and its subpackages form a high-level multithreading framework 
in Java. You should become familiar with threading basics before 
attempting to apply the Java concurrency libraries, but once you learn <code>java.util.concurrent</code>, you may never extend <code>Thread</code> again.</p>
<p class="indent"><code>Callable</code>s and <code>Executors</code> (and their underlying thread pools) form the basis of a high-level alternative to creating new <code>Threads</code>
 directly. As the trend of adding more CPU cores continues, knowing how 
to get Java to make use of them all concurrently could put you on easy 
street. The high-level APIs provided by <code>java.util.concurrent</code> help you create efficient multithreaded applications while eliminating the need to use low-level threading APIs such as <code>wait()</code>, <code>notify()</code>, and <code>synchronized</code>, which can be a source of hard-to-detect bugs.</p>
<p class="indent"><span id="page_791" epub:type="pagebreak"></span>When using an <code>Executor</code>, you will commonly create a <code>Callable</code> implementation to represent the work that needs to be executed concurrently. A <code>Runnable</code> can be used for the same purpose, but a <code>Callable</code> leverages generics to allow a generic return type from its <code>call</code> method. <code>Executor</code> or <code>ExecutorService</code> instances with predefined behavior can be obtained by calling one of the factory methods in the <code>Executors</code> class like so: <code>ExecutorService</code> es <code>= Executors.newFixedThreadPool(100);</code>.</p>
<p class="indent">Once you obtain an <code>ExecutorService</code>, you submit a task in the form of a <code>Runnable</code> or <code>Callable</code>, or a collection of <code>Callable</code> instances to the <code>ExecutorService</code> using one of the <code>execute</code>, <code>submit</code>, <code>invokeAny</code>, or <code>invokeAll</code> methods. An <code>ExecutorService</code>
 can be held onto during the entire life of your application if needed, 
but once it is no longer needed, it should be terminated using the <code>shutdown</code> and <code>shutdownNow</code> methods.</p>
<p class="indent">We looked at the Fork/Join Framework, which supplies a highly specialized type of <code>Executor</code>. Use the Fork/Join Framework when the work you would typically put in a <code>Callable</code>
 can be split into multiple units of work. The purpose of the Fork/Join 
Framework is to decrease the amount of time it takes to solve a problem 
by leveraging the additional CPUs in a system. You should only run a 
single Fork/Join task at a time in an application, because the goal of 
the framework is to allow a single task to consume all available CPU 
resources in order to be solved as quickly as possible. In most cases, 
the effort of splitting a single task into multiple tasks that can be 
operated on by the underlying Fork/Join threads will introduce 
additional overhead. Don’t assume that applying Fork/Join will grant you
 a performance benefit for all problems. The overhead involved may be 
large enough that any benefit of applying the framework is offset.</p>
<p class="indent">When applying the Fork/Join Framework, first subclass either <code>RecursiveTask</code> (if a return result is desired) or <code>RecursiveAction</code>. Within one of these <code>ForkJoinTask</code> subclasses, you must implement the <code>compute</code> method. The <code>compute()</code> method is where you divide the work of a task into parts and then call the <code>fork</code> and <code>join</code> methods or the <code>invokeAll</code> method. To execute the task, create a <code>ForkJoinPool</code> instance with <code>ForkJoinPool pool = new ForkJoinPool();</code> and submit the <code>RecursiveTask</code> or <code>RecursiveAction</code> to the pool with the <code>pool.invoke(task)</code> method. Although the Fork/Join API itself is not that large, creating a correct and efficient implementation of a <code>ForkJoinTask</code> can be challenging.</p>
<p class="indent">Java 8 added parallel streams to make the Fork/Join 
Framework easier to use. Parallel streams are built on top of the 
Fork/Join Framework and allow you to split a task into parts more easily
 than when using the Fork/Join API directly. Simply <span id="page_792" epub:type="pagebreak"></span>create a stream and call <code>parallel()</code>,
 and your stream pipeline will be split into tasks that execute in 
separate threads. However, as you saw, you need to be aware of the 
potential issues with parallel streams and make sure you are using them 
to solve the appropriate kinds of problems.</p>
<p class="indent">We learned about the <code>java.util.concurrent</code>
 collections. There are three categories of collections: copy-on-write 
collections, concurrent collections, and blocking queues. The 
copy-on-write and concurrent collections are similar in use to the 
traditional <code>java.util</code> collections but are designed to be used efficiently in a thread-safe fashion. The copy-on-write collections (<code>CopyOnWriteArrayList</code> and <code>CopyOnWriteArraySet</code>)
 should be used for read-heavy scenarios. When attempting to loop 
through all the elements in one of the copy-on-write collections, always
 use an <code>Iterator</code>. The concurrent collections included</p>
<p class="bullt"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>ConcurrentHashMap</code></p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>ConcurrentLinkedDeque</code></p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>ConcurrentLinkedQueue</code></p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>ConcurrentSkipListMap</code></p>
<p class="bullb"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>ConcurrentSkipListSet</code></p>
<p class="indent">These collections are meant to be used concurrently 
without requiring locking. Remember that iterators of these five 
concurrent collections are weakly consistent. <code>ConcurrentHashMap</code> and <code>ConcurrentSkipListMap</code> are <code>ConcurrentMap</code> implementations that add atomic <code>putIfAbsent</code>, <code>remove</code>, and <code>replace</code> methods to the <code>Map</code> interface. Seven blocking queue implementations are provided by the <code>java.util.concurrent</code> package:</p>
<p class="bullt"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>ArrayBlockingQueue</code></p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>LinkedBlockingDeque</code></p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>LinkedBlockingQueue</code></p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>PriorityBlockingQueue</code></p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>DelayQueue</code></p>
<p class="bull"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>LinkedTransferQueue</code></p>
<p class="bullb"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box.jpg" width="15" height="15">&nbsp;&nbsp;&nbsp;<code>SynchronousQueue</code></p>
<p class="indent">These blocking queues are used to exchange objects 
between threads—one thread will deposit an object and another thread 
will retrieve that object. Depending on which queue type is used, the 
parameters used to create the queue, <span id="page_793" epub:type="pagebreak"></span>and the method being called, an insert or a removal operation may block until it can be completed successfully. In Java 7, the <code>LinkedTransferQueue</code> class was added and acts as a superset of several blocking queue types; you should prefer it when possible.</p>
<p class="indent">Another way to coordinate threads is to use a <code>CyclicBarrier</code>. A <code>CyclicBarrier</code>
 creates a barrier where all threads must wait until all participating 
threads reach that barrier; once they do, then the threads can continue.
 You can have an optional <code>Runnable</code> run before the threads continue; the last thread to reach the barrier is the thread that’s used to run that <code>Runnable</code>.</p>
<p class="indent">The <code>java.util.concurrent.atomic</code> and <code>java.util.concurrent.locks</code> packages contain additional utility classes you might consider using in concurrent applications. The <code>java.util.concurrent.atomic</code> package supplies thread-safe classes that are similar to the traditional wrapper classes (such as <code>java.lang.Integer</code>) but with methods that support atomic modifications. The <code>java.util.concurrent.locks.Lock</code>
 interface and supporting classes enable you to create highly customized
 locking behaviors that are more flexible than traditional object 
monitor locking (the <code>synchronized</code> keyword).</p>
<h3 class="h3b" id="ch11lev1sec8"><span id="page_794" epub:type="pagebreak"></span><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick1.jpg" width="58" height="60"> TWO-MINUTE DRILL</h3>
<p class="noindent">Here are some of the key points from the certification objectives in this chapter.</p>
<h4 class="h4">Apply Atomic Variables and Locks (OCP Objective 10.3)</h4>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;The <code>java.util.concurrent.atomic</code>
 package provides classes that are similar to volatile fields (changes 
to an atomic object’s value will be correctly read by other threads 
without the need for synchronized code blocks in your code).</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;The atomic classes provide a <code>compareAndSet</code> method that is used to validate that an atomic variable’s value will only be changed if it matches an expected value.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;The atomic classes provide several convenience methods such as <code>addAndGet</code> that will loop repeatedly until a <code>compareAndSet</code> succeeds.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;The <code>java.util.concurrent.locks</code>
 package contains a locking mechanism that is an alternative to 
synchronized methods and blocks. You get greater flexibility at the cost
 of a more verbose syntax (such as having to manually call <code>lock.unlock()</code> and having an automatic release of a synchronization monitor at the end of a synchronized code block).</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;The <code>ReentrantLock</code> class provides the basic Lock implementation. Commonly used methods are <code>lock()</code>, <code>unlock()</code>, <code>isLocked()</code>, and <code>tryLock()</code>. Calling <code>lock()</code> increments a counter and <code>unlock()</code> decrements the counter. A thread can only obtain the lock when the counter is zero.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;The <code>ReentrantReadWriteLock</code> class provides a <code>ReadWriteLock</code> implementation that supports a read lock (obtained by calling <code>readLock()</code>) and a write lock (obtained by calling <code>writeLock()</code>).</p>
<h4 class="h4">Use java.util.concurrent Collections (OCP Objective 10.4)</h4>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;Copy-on-write
 collections work well when there are more reads than writes because 
they make a new copy of the collection for each write. When looping 
through a copy-on-write collection, use an iterator (remember, <code>for-each</code> loops use an iterator).</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;None
 of the concurrent collections make the elements stored in the 
collection thread-safe—just the collection itself.</p>
<p class="bull-image"><span id="page_795" epub:type="pagebreak"></span><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;<code>ConcurrentHashMap</code>, <code>ConcurrentSkipListMap</code>, and <code>ConcurrentSkipListSet</code> should be preferred over synchronizing with the more traditional collections.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;<code>ConcurrentHashMap</code> and <code>ConcurrentSkipListMap</code> are <code>ConcurrentMap</code>
 implementations that enhance a standard Map by adding atomic operations
 that validate the presence and value of an element before performing an
 operation: <code>putIfAbsent(K key, V value)</code>, <code>remove(Object key, Object value)</code>, <code>replace(K key, V value)</code>, and <code>replace(K key, V oldValue, V newValue)</code>.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;Blocking
 queues are used to exchange objects between threads. Blocking queues 
will block (hence the name) when you call certain operations, such as 
calling <code>take()</code> when there are no elements to take. There 
are seven different blocking queues that have slightly different 
behaviors; you should be able to identify the behavior of each type.</p>
<p class="imaget"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/t0795-01.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/t0795-01.jpg" width="826" height="749"></p>
<p class="bull-image"><span id="page_796" epub:type="pagebreak"></span><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;Some
 blocking queues are bounded, meaning they have an upper bound on the 
number of elements that can be added, and a thread calling <code>put(e)</code> may block until space becomes available.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;<code>CyclicBarrier</code>
 creates a barrier at which threads must wait until all participating 
threads reach that barrier. Once all of the threads have reached the 
barrier, they can continue running. You can use <code>CyclicBarrier</code>
 to coordinate threads so that an action occurs only after another 
action is complete or to manage data in Collections that are not 
thread-safe.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;<code>CyclicBarrier</code> takes the number of threads that can wait at the barrier and an optional <code>Runnable</code>
 that is run after all threads reach the barrier, but before they 
continue execution. The last thread to reach the barrier is used to run 
this <code>Runnable</code>.</p>
<h4 class="h4">Use Executors and ThreadPools (OCP Objective 10.1)</h4>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;An <code>Executor</code>
 is used to submit a task for execution without being coupled to how or 
when the task is executed. Basically, it creates an abstraction that can
 be used in place of explicit thread creation and execution.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;An <code>ExecutorService</code> is an enhanced <code>Executor</code> that provides additional functionality, such as the ability to execute a <code>Callable</code> instance and to shut down (nondaemon threads in an <code>Executor</code> may keep the JVM running after your main method returns).</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;The <code>Callable</code> interface is similar to the <code>Runnable</code> interface, but adds the ability to return a result from its <code>call</code> method and can optionally throw an exception.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;The <code>Executors</code> (plural) class provides factory methods that can be used to construct <code>ExecutorService</code> instances, for example: <code>ExecutorService ex = Executors.newFixedThreadPool(4);</code>.</p>
<h4 class="h4">Use the Parallel Fork/Join Framework (OCP Objective 10.5)</h4>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;Fork/Join
 enables work stealing among worker threads in order to keep all CPUs 
utilized and to increase the performance of highly parallelizable tasks.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;A pool of worker threads of type <code>ForkJoinWorkerThread</code> is created when you create a <code>new ForkJoinPool()</code>. By default, one thread per CPU is created.</p>
<p class="bull-image"><span id="page_797" epub:type="pagebreak"></span><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;To
 minimize the overhead of creating new threads, you should create a 
single Fork/Join pool in an application and reuse it for all recursive 
tasks.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;A Fork/Join task represents a large problem to solve (often involving a collection or array).</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;When executed by a <code>ForkJoinPool</code>, the Fork/Join task will subdivide itself into Fork/Join tasks that represent smaller segments of the problem to be solved.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;A Fork/Join task is a subclass of the <code>ForkJoinTask</code> class, either <code>RecursiveAction</code> or <code>RecursiveTask</code>.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;Extend <code>RecursiveTask</code> when the <code>compute()</code> method must return a value, and extend <code>RecursiveAction</code> when the return type is void.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;When writing a <code>ForkJoinTask</code> implementation’s <code>compute()</code> method, always call <code>fork()</code> before <code>join()</code> or use one of the <code>invokeAll()</code> methods instead of calling <code>fork()</code> and <code>join()</code>.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;You
 do not need to shut down a Fork/Join pool before exiting your 
application because the threads in a Fork/Join pool typically operate in
 daemon mode.</p>
<h4 class="h4">Use Parallel Streams Including Reduction, Decomposition, Merging Processes, Pipelines, and Performance (OCP Objective 10.6)</h4>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;Parallel streams are built on top of the Fork/Join pool.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;Parallel streams provide an easier syntax for creating tasks in the Fork/Join pool.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;You
 can use the default Fork/Join pool, or create a custom pool and submit 
tasks expressed as parallel streams via a <code>Callable</code>.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;Parallel
 streams split the stream into subtasks that represent portions of the 
problem to be solved. Each subtask solution is then combined to produce a
 final result for the terminal operation of the parallel stream.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;Create a parallel stream by calling <code>parallel()</code> on a stream object or <code>parallelStream()</code> on a <code>Collection</code> object.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;Make a parallel stream sequential again by calling the <code>sequential()</code> method.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;Test to see if a stream is parallel with the <code>isParallel()</code> method.</p>
<p class="bull-image"><span id="page_798" epub:type="pagebreak"></span><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;Parallel
 stream pipelines should be stateless, and for optimum performance, 
parallel streams should be unordered. Reduction operations on parallel 
streams should be associative and stateless.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;Stateful parallel stream pipelines will either create an error or unexpected results.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;Nonassociative reductions on streams will produce unexpected results.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;Just
 like sequential streams, parallel streams can have multiple 
intermediate operations and must have one terminal operation to produce a
 result.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;Test
 your parallel streams to verify you are getting the performance 
benefits you expect. The performance overhead of creating threads can be
 greater than the performance gain of a parallel stream in some 
situations.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;Stateful stream operations, such as <code>distinct()</code>, <code>limit()</code>, <code>skip()</code>, and <code>sorted()</code>, will limit the performance of your parallel streams.</p>
<p class="bull-image"><img class="inline" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/box1.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/box1.jpg" width="15" height="15">&nbsp;&nbsp;Collect results from a parallel stream pipeline with <code>collect()</code>, just as we did with sequential streams. The collecting happens in a thread-safe way, so you can use <code>collect()</code> with <code>Collectors.toList()</code>, <code>toSet()</code>, and <code>toMap()</code> safely.</p>
<h3 class="h3b" id="ch11lev1sec9"><span id="page_799" epub:type="pagebreak"></span><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/qs.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/qs.jpg" width="50" height="62"> SELF TEST</h3>
<p class="noindent">The following questions might be some of the hardest
 in the book. It’s just a difficult topic, so don’t panic. (We know some
 Java book authors who didn’t do well with these topics and still 
managed to pass the exam.)</p>
<p class="que"><strong><a id="ch11ans1" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#r_ch11ans1" class="totri-footnote">1</a>.</strong>&nbsp;&nbsp;&nbsp;The following block of code creates a <code>CopyOnWriteArrayList</code>, adds elements to it, and prints the contents:</p>
<p class="num-pre"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un799-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un799-01.jpg" width="705" height="165"></p>
<p class="alpha-no">What is the result?</p>
<p class="alpha">A. <code>6</code></p>
<p class="alpha">B. <code>12</code></p>
<p class="alpha">C. <code>4 2</code></p>
<p class="alpha">D. <code>4 2 6</code></p>
<p class="alpha">E. Compilation fails</p>
<p class="alpha">F. An exception is thrown at runtime</p>
<p class="que"><strong><a id="ch11ans2" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#r_ch11ans2" class="totri-footnote">2</a>.</strong>&nbsp;&nbsp;&nbsp;Given:</p>
<p class="num-pre"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un799-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un799-02.jpg" width="640" height="169"></p>
<p class="alpha-no">Which shows the output that will be produced?</p>
<p class="alpha">A. <code>12</code></p>
<p class="alpha">B. <code>10</code></p>
<p class="alpha">C. <code>4 2 6</code></p>
<p class="alpha">D. <code>4 6</code></p>
<p class="alpha">E. Compilation fails</p>
<p class="alpha">F. An exception is thrown at runtime</p>
<p class="que"><span id="page_800" epub:type="pagebreak"></span><strong><a id="ch11ans3" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#r_ch11ans3" class="totri-footnote">3</a>.</strong>&nbsp;&nbsp;&nbsp;Which methods from a <code>CopyOnWriteArrayList</code> will cause a new copy of the internal array to be created? (Choose all that apply.)</p>
<p class="alpha">A. <code>add</code></p>
<p class="alpha">B. <code>get</code></p>
<p class="alpha">C. <code>iterator</code></p>
<p class="alpha">D. <code>remove</code></p>
<p class="que"><strong><a id="ch11ans4" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#r_ch11ans4" class="totri-footnote">4</a>.</strong>&nbsp;&nbsp;&nbsp;Given:</p>
<p class="num-pre"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un800-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un800-01.jpg" width="585" height="13"></p>
<p class="alpha-no">Which operation(s) can block indefinitely? (Choose all that apply.)</p>
<p class="alpha"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un800-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un800-02.jpg" width="427" height="102"></p>
<p class="que"><strong><a id="ch11ans5" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#r_ch11ans5" class="totri-footnote">5</a>.</strong>&nbsp;&nbsp;&nbsp;Given the following code fragment:</p>
<p class="num-pre"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un800-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un800-03.jpg" width="631" height="541"></p>
<p class="num-pre"><span id="page_801" epub:type="pagebreak"></span><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un801-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un801-01.jpg" width="387" height="152"></p>
<p class="alpha-no">What do you expect the output to be, and which thread(s) will be responsible for the output? (Choose all that apply.)</p>
<p class="alpha"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un801-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un801-02.jpg" width="841" height="727"></p>
<p class="que"><span id="page_802" epub:type="pagebreak"></span><strong><a id="ch11ans6" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#r_ch11ans6" class="totri-footnote">6</a>.</strong>&nbsp;&nbsp;&nbsp;Given:</p>
<p class="num-pre"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un802-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un802-01.jpg" width="584" height="33"></p>
<p class="alpha-no">Which method(s) would delete <code>John</code> from the map only if his value was still equal to 23?</p>
<p class="alpha"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un802-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un802-02.jpg" width="404" height="102"></p>
<p class="que"><strong><a id="ch11ans7" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#r_ch11ans7" class="totri-footnote">7</a>.</strong>&nbsp;&nbsp;&nbsp;Which
 method represents the best approach to generating a random number 
between 1 and 10 if the method will be called concurrently and 
repeatedly by multiple threads?</p>
<p class="alpha"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un802-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un802-03.jpg" width="660" height="407"></p>
<p class="que"><strong><a id="ch11ans8" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#r_ch11ans8" class="totri-footnote">8</a>.</strong>&nbsp;&nbsp;&nbsp;Given:</p>
<p class="num-pre"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un802-04.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un802-04.jpg" width="352" height="13"></p>
<p class="alpha-no">Which atomically increment <code>i</code> by 9? (Choose all that apply.)</p>
<p class="alpha"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un802-05.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un802-05.jpg" width="275" height="129"></p>
<p class="que"><span id="page_803" epub:type="pagebreak"></span><strong><a id="ch11ans9" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#r_ch11ans9" class="totri-footnote">9</a>.</strong>&nbsp;&nbsp;&nbsp;Given:</p>
<p class="num-pre"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un803-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un803-01.jpg" width="659" height="560"></p>
<p class="alpha-no">Which block(s) of code best match the behavior of the methods in the <code>LeaderBoard</code> class? (Choose all that apply.)</p>
<p class="alpha"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un803-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un803-02.jpg" width="781" height="210"></p>
<p class="que1"><span id="page_804" epub:type="pagebreak"></span><strong><a id="ch11ans10" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#r_ch11ans10">10</a>.</strong>&nbsp;&nbsp;&nbsp;Given:</p>
<p class="num-pre"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un804-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un804-01.jpg" width="538" height="246"></p>
<p class="alpha-no">What is the result?</p>
<p class="alpha">A. The code will not compile</p>
<p class="alpha">B. The code will compile and output:</p>
<p class="num-pre"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un804-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un804-02.jpg" width="119" height="67"></p>
<p class="alpha">C. The code will compile and output:</p>
<p class="num-pre"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un804-03.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un804-03.jpg" width="129" height="106"></p>
<p class="alpha">D. A <code>java.lang.IllegalMonitorStateException</code> will be thrown</p>
<p class="que1"><strong><a id="ch11ans11" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#r_ch11ans11">11</a>.</strong>&nbsp;&nbsp;&nbsp;Which class contains factory methods to produce preconfigured <code>ExecutorService</code> instances?</p>
<p class="alpha">A. <code>Executor</code></p>
<p class="alpha">B. <code>Executors</code></p>
<p class="alpha">C. <code>ExecutorService</code></p>
<p class="alpha">D. <code>ExecutorServiceFactory</code></p>
<p class="que1"><span id="page_805" epub:type="pagebreak"></span><strong><a id="ch11ans12" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#r_ch11ans12">12</a>.</strong>&nbsp;&nbsp;&nbsp;Given:</p>
<p class="num-pre"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un805-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un805-01.jpg" width="492" height="72"></p>
<p class="alpha-no">Which set(s) of lines, when inserted, would correctly use the <code>ExecutorService</code> argument to execute the <code>Callable</code> and return the <code>Callable</code>’s result? (Choose all that apply.)</p>
<p class="alpha"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un805-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un805-02.jpg" width="614" height="559"></p>
<p class="que1"><strong><a id="ch11ans13" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#r_ch11ans13">13</a>.</strong>&nbsp;&nbsp;&nbsp;Which are true? (Choose all that apply.)</p>
<p class="alpha">A. A <code>Runnable</code> may return a result but must not throw an <code>Exception</code></p>
<p class="alpha">B. A <code>Runnable</code> must not return a result nor throw an <code>Exception</code></p>
<p class="alpha">C. A <code>Runnable</code> must not return a result but may throw an <code>Exception</code></p>
<p class="alpha">D. A <code>Runnable</code> may return a result and throw an <code>Exception</code></p>
<p class="alpha">E. A <code>Callable</code> may return a result but must not throw an <code>Exception</code></p>
<p class="alpha">F. A <code>Callable</code> must not return a result nor throw an <code>Exception</code></p>
<p class="alpha">G. A <code>Callable</code> must not return a result but may throw an <code>Exception</code></p>
<p class="alpha">H. A <code>Callable</code> may return a result and throw an <code>Exception</code></p>
<p class="que1"><span id="page_806" epub:type="pagebreak"></span><strong><a id="ch11ans14" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#r_ch11ans14">14</a>.</strong>&nbsp;&nbsp;&nbsp;Given:</p>
<p class="num-pre"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un806-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un806-01.jpg" width="707" height="521"></p>
<p class="alpha-no">Which line(s), when inserted at the end of the <code>compute</code> method, would correctly take the place of separate calls to <code>fork()</code> and <code>join()</code>? (Choose all that apply.)</p>
<p class="alpha"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un806-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un806-02.jpg" width="264" height="101"></p>
<p class="que1"><strong><a id="ch11ans15" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#r_ch11ans15">15</a>.</strong>&nbsp;&nbsp;&nbsp;When writing a <code>RecursiveTask</code> subclass, which are true? (Choose all that apply.)</p>
<p class="alpha">A. <code>fork()</code> and <code>join()</code> should be called on the same task</p>
<p class="alpha">B. <code>fork()</code> and <code>compute()</code> should be called on the same task</p>
<p class="alpha">C. <code>compute()</code> and <code>join()</code> should be called on the same task</p>
<p class="alpha">D. <code>compute()</code> should be called before <code>fork()</code></p>
<p class="alpha">E. <code>fork()</code> should be called before <code>compute()</code></p>
<p class="alpha">F. <code>join()</code> should be called after <code>fork()</code> but before <code>compute()</code></p>
<p class="que1"><span id="page_807" epub:type="pagebreak"></span><strong><a id="ch11ans16" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#r_ch11ans16">16</a>.</strong>&nbsp;&nbsp;&nbsp;Given the following code fragment:</p>
<p class="num-pre"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un807-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un807-01.jpg" width="454" height="171"></p>
<p class="alpha-no">What is the result?</p>
<p class="alpha">A. 0</p>
<p class="alpha">B. 40</p>
<p class="alpha">C. The result is unpredictable</p>
<p class="alpha">D. Compilation fails</p>
<p class="alpha">E. An exception is thrown at runtime</p>
<p class="que1"><strong><a id="ch11ans17" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#r_ch11ans17">17</a>.</strong>&nbsp;&nbsp;&nbsp;Given the following code fragment:</p>
<p class="num-pre"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un807-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un807-02.jpg" width="704" height="149"></p>
<p class="alpha-no">What is the result?</p>
<p class="alpha">A. <code>BOI AIKO CHARIS ZOOEY CLOVER BOI AIKO CHARIS ZOOEY CLOVER</code></p>
<p class="alpha">B. Most likely, although not guaranteed: <code>BOI AIKO CHARIS ZOOEY CLOVER BOI AIKO CHARIS ZOOEY CLOVER</code></p>
<p class="alpha">C. A <code>ConcurrentModificationException</code> is thrown</p>
<p class="alpha">D. Compilation fails</p>
<p class="alpha">E. An exception other than <code>ConcurrentModificationException</code> is thrown at runtime</p>
<p class="que1"><span id="page_808" epub:type="pagebreak"></span><strong><a id="ch11ans18" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#r_ch11ans18">18</a>.</strong>&nbsp;&nbsp;&nbsp;Given the following code fragment:</p>
<p class="num-pre"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un808-01.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un808-01.jpg" width="639" height="168"></p>
<p class="alpha-no">What is the result?</p>
<p class="alpha">A. <code>BOI AIKO CHARIS ZOOEY CLOVER BOI AIKO CHARIS ZOOEY CLOVER</code></p>
<p class="alpha">B. The result is unpredictable</p>
<p class="alpha">C. A <code>ConcurrentModificationException</code> is thrown</p>
<p class="alpha">D. Compilation fails</p>
<p class="alpha">E. An exception is thrown at runtime</p>
<p class="que1"><strong><a id="ch11ans19" href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#r_ch11ans19">19</a>.</strong>&nbsp;&nbsp;&nbsp;Given the code fragment:</p>
<p class="num-pre"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/un808-02.jpg" alt="images" data-mfp-src="/library/view/ocp-java-se/9781260117370/un808-02.jpg" width="687" height="52"></p>
<p class="alpha-no">What is the result?</p>
<p class="alpha">A. 1</p>
<p class="alpha">B. 2</p>
<p class="alpha">C. The result is unpredictable; it could be any one of the numbers in the stream</p>
<p class="alpha">D. A <code>ConcurrentModificationException</code> is thrown</p>
<p class="alpha">E. Compilation fails</p>
<p class="alpha">F. An exception is thrown at runtime</p>
<h3 class="h3b" id="ch11lev2sec19"><span id="page_809" epub:type="pagebreak"></span><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/aself.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/aself.jpg" width="50" height="52"> SELF TEST ANSWERS</h3>
<p class="que-q"><strong><a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11ans1" id="r_ch11ans1" class="totri-footnote">1</a>.</strong>&nbsp;&nbsp;&nbsp;<img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick2.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick2.jpg" width="14" height="14"> <strong>C</strong> is correct. The <code>Iterator</code> is obtained before 6 is added. As long as the reference to the <code>Iterator</code> is maintained, it will only provide access to the values 4 and 2.</p>
<p class="quep"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/times.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/times.jpg" width="14" height="14"> <strong>A, B, D, E,</strong> and <strong>F</strong> are incorrect based on the above. (OCP Objective 10.4)</p>
<p class="que-q"><strong><a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11ans2" id="r_ch11ans2" class="totri-footnote">2</a>.</strong>&nbsp;&nbsp;&nbsp;<img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick2.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick2.jpg" width="14" height="14"> <strong>C</strong> is correct. Because the <code>Iterator</code> is obtained before <code>remove()</code> is invoked, it will reflect all the elements that have been added to the collection.</p>
<p class="quep"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/times.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/times.jpg" width="14" height="14"> <strong>A, B, D, E,</strong> and <strong>F</strong> are incorrect based on the above. (OCP Objective 10.4)</p>
<p class="que-q"><strong><a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11ans3" id="r_ch11ans3" class="totri-footnote">3</a>.</strong>&nbsp;&nbsp;&nbsp;<img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick2.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick2.jpg" width="14" height="14"> <strong>A</strong> and <strong>D</strong> are correct. Of the methods listed, only <code>add</code> and <code>remove</code> will modify the list and cause a new internal array to be created.</p>
<p class="quep"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/times.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/times.jpg" width="14" height="14"> <strong>B</strong> and <strong>C</strong> are incorrect based on the above. (OCP Objective 10.4)</p>
<p class="que-q"><strong><a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11ans4" id="r_ch11ans4" class="totri-footnote">4</a>.</strong>&nbsp;&nbsp;&nbsp;<img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick2.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick2.jpg" width="14" height="14"> <strong>C</strong> is correct. The <code>add</code> method will throw an <code>IllegalStateException</code> if the queue is full. The two <code>offer</code> methods will return false if the queue is full. Only the <code>put</code> method will block until space becomes available.</p>
<p class="quep"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/times.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/times.jpg" width="14" height="14"> <strong>A, B,</strong> and <strong>D</strong> are incorrect based on the above. (OCP Objective 10.4)</p>
<p class="que-q"><strong><a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11ans5" id="r_ch11ans5" class="totri-footnote">5</a>.</strong>&nbsp;&nbsp;&nbsp;<img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick2.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick2.jpg" width="14" height="14"> <strong>C</strong> is correct; you could see the output in either order because we don’t know in advance if threads <code>t1</code>, <code>t2</code>, and <code>t3</code> will complete before the main thread or if the main thread will complete first. However, in either case, <code>t1</code>, <code>t2</code>, and <code>t3</code>
 will wait at the barrier until t1, t2, and t3 are all at the barrier, 
and the last thread to reach the barrier will display the output.</p>
<p class="quep"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/times.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/times.jpg" width="14" height="14"> <strong>A, B, D,</strong> and <strong>E</strong> are incorrect; <strong>A</strong> and <strong>B</strong> are incorrect because of the above. <strong>D</strong> is incorrect because the <code>Singleton</code> is thread-safe; <code>enum</code> singletons are guaranteed to be created in a thread-safe manner, and we have synchronized the <code>updateValue()</code> method. <strong>E</strong>
 is incorrect because it is highly unlikely one of these threads will 
get stuck or time out and none is accessing any collection that is not 
thread-safe. (OCP Objective 10.4)</p>
<p class="que-q"><strong><a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11ans6" id="r_ch11ans6" class="totri-footnote">6</a>.</strong>&nbsp;&nbsp;&nbsp;<img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick2.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick2.jpg" width="14" height="14"> <strong>C</strong> is correct; it uses the correct syntax.</p>
<p class="quep"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/times.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/times.jpg" width="14" height="14"> The methods for answers <strong>A, B,</strong> and <strong>D</strong> do not exist in a <code>ConcurrentHashMap</code>. A traditional <code>Map</code> contains a single-argument <code>remove</code> method that removes an element based on its key. The <code>ConcurrentMap</code> interface (which <code>ConcurrentHashMap</code> implements) added the two-argument <code>remove</code> method, which takes a key and a value. An element will only be removed from the <code>Map</code> if its value matches the second argument. A boolean is returned to indicate if the element was removed. (OCP Objective 10.4)</p>
<p class="que-q"><strong><a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11ans7" id="r_ch11ans7" class="totri-footnote">7</a>.</strong>&nbsp;&nbsp;&nbsp;<img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick2.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick2.jpg" width="14" height="14"> <strong>D</strong> is correct. The <code>ThreadLocalRandom</code> creates and retrieves <code>Random</code> instances that are specific to a thread. You could achieve the same effect prior to Java 7 by using the <code>java.lang.ThreadLocal</code> and <code>java.util.Random</code> classes, but it would require several lines of code. <code>Math.random()</code> is thread-safe, but uses a shared <code>java.util.Random</code> instance and can suffer from contention problems.</p>
<p class="quep"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/times.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/times.jpg" width="14" height="14"> <strong>A, B,</strong> and <strong>C</strong> are incorrect based on the above. (OCP Objective 10.1)</p>
<p class="que-q"><span id="page_810" epub:type="pagebreak"></span><strong><a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11ans8" id="r_ch11ans8" class="totri-footnote">8</a>.</strong>&nbsp;&nbsp;&nbsp;<img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick2.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick2.jpg" width="14" height="14"> <strong>A</strong> and <strong>B</strong> are correct. The <code>addAndGet</code> and <code>getAndAdd</code> both increment the value stored in an <code>AtomicInteger</code>.</p>
<p class="quep"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/times.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/times.jpg" width="14" height="14"> Answer <strong>C</strong> is not atomic because in between the call to <code>get</code> and <code>set</code>, the value stored by <code>i</code> may have changed. Answer <strong>D</strong> is invalid because the <code>atomicIncrement</code> method is fictional, and answer <strong>E</strong> is invalid because auto-boxing is not supported for the atomic classes. The difference between the <code>addAndGet</code> and <code>getAndAdd</code> methods is that the first is a prefix method (++x) and the second is a postfix method (x++). (Objective 10.3)</p>
<p class="que-q"><strong><a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11ans9" id="r_ch11ans9" class="totri-footnote">9</a>.</strong>&nbsp;&nbsp;&nbsp;<img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick2.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick2.jpg" width="14" height="14"> <strong>D</strong> and <strong>E</strong> are correct. The <code>addScore</code> method modifies the collection and, therefore, should use a write lock, whereas the <code>getHighScores</code> method only reads the collection and should use a read lock.</p>
<p class="quep"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/times.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/times.jpg" width="14" height="14"> <strong>A, B, C,</strong> and<strong> F</strong> are incorrect; they will not behave correctly. (Objective 10.3)</p>
<p class="que-q1"><strong><a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11ans10" id="r_ch11ans10">10</a>.</strong>&nbsp;&nbsp;&nbsp;<img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick2.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick2.jpg" width="14" height="14"> <strong>D</strong>
 is correct. A lock counts the number of times it has been locked. 
Calling lock increments the count, and calling unlock decrements the 
count. If a call to unlock decreases the count below zero, an exception 
is thrown.</p>
<p class="quep"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/times.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/times.jpg" width="14" height="14"> <strong>A, B,</strong> and <strong>C</strong> are incorrect based on the above. (OCP Objective 10.3)</p>
<p class="que-q1"><strong><a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11ans11" id="r_ch11ans11">11</a>.</strong>&nbsp;&nbsp;&nbsp;<img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick2.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick2.jpg" width="14" height="14"> <strong>B</strong> is correct. <code>Executor</code> is the super-interface for <code>ExecutorService</code>. You use <code>Executor</code>s to easily obtain <code>ExecutorService</code> instances with predefined threading behavior. If the <code>Executor</code> interface does not produce <code>ExecutorService</code> instances with the behaviors that you desire, you can always look into using <code>java.util.concurrent.AbstractExecutorService</code> or <code>java.util.concurrent.ThreadPoolExecutor</code> directly.</p>
<p class="quep"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/times.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/times.jpg" width="14" height="14"> <strong>A, C,</strong> and <strong>D</strong> are incorrect based on the above. (OCP Objective 10.1)</p>
<p class="que-q1"><strong><a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11ans12" id="r_ch11ans12">12</a>.</strong>&nbsp;&nbsp;&nbsp;<img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick2.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick2.jpg" width="14" height="14"> <strong>C</strong> is correct. When you submit a <code>Callable</code> to an <code>ExecutorService</code> for execution, you will receive a <code>Future</code> as the result. You can use the <code>Future</code> to check on the status of the <code>Callable</code>’s execution, or just use the <code>get()</code> method to block until the result is available.</p>
<p class="quep"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/times.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/times.jpg" width="14" height="14"> <strong>A, B,</strong> and <strong>D</strong> are incorrect based on the above. (OCP Objective 10.1)</p>
<p class="que-q1"><strong><a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11ans13" id="r_ch11ans13">13</a>.</strong>&nbsp;&nbsp;&nbsp;<img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick2.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick2.jpg" width="14" height="14"> <strong>B</strong> and <strong>H</strong> are correct. <code>Runnable</code> and <code>Callable</code> serve similar purposes. <code>Runnable</code> has been available in Java since version 1. <code>Callable</code> was introduced in Java 5 and serves as a more flexible alternative to <code>Runnable</code>. A <code>Callable</code> allows a generic return type and permits thrown exceptions, whereas a <code>Runnable</code> does not.</p>
<p class="quep"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/times.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/times.jpg" width="14" height="14"> <strong>A, C, D, E, F,</strong> and <strong>G</strong> are incorrect statements. (Objective 10.1)</p>
<p class="que-q1"><strong><a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11ans14" id="r_ch11ans14">14</a>.</strong>&nbsp;&nbsp;&nbsp;<img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick2.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick2.jpg" width="14" height="14"> <strong>D</strong> is correct. The <code>invokeAll</code> method is a var-args method that will fork all Fork/Join tasks, except one that will be invoked directly.</p>
<p class="quep"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/times.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/times.jpg" width="14" height="14"> <strong>A, B,</strong> and <strong>C</strong> are incorrect; they would not correctly complete the Fork/Join process. (OCP Objective 10.5)</p>
<p class="que-q1"><span id="page_811" epub:type="pagebreak"></span><strong><a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11ans15" id="r_ch11ans15">15</a>.</strong>&nbsp;&nbsp;&nbsp;<img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick2.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick2.jpg" width="14" height="14"> <strong>A</strong> and <strong>E</strong> are correct. When creating multiple <code>ForkJoinTask</code>
 instances, all tasks except one should be forked first, so they can be 
picked up by other Fork/Join worker threads. The final task should then 
be executed within the same thread (typically by calling <code>compute()</code>) before calling <code>join()</code>
 on all the forked tasks to await their results. In many cases, calling 
the methods in the wrong order will not result in any compiler errors, 
so care must be taken to call the methods in the correct order.</p>
<p class="quep"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/times.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/times.jpg" width="14" height="14"> <strong>B, C, D,</strong> and <strong>F</strong> are incorrect based on the above. (OCP Objective 10.5)</p>
<p class="que-q1"><strong><a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11ans16" id="r_ch11ans16">16</a>.</strong>&nbsp;&nbsp;&nbsp;<img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick2.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick2.jpg" width="14" height="14"> <strong>C</strong> is correct. The result is unpredictable because the reduction function is not associative and the stream is parallel.</p>
<p class="quep"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/times.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/times.jpg" width="14" height="14"> <strong>A, B, D,</strong> and <strong>E</strong> are incorrect based on the above (OCP Objective 10.6)</p>
<p class="que-q1"><strong><a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11ans17" id="r_ch11ans17">17</a>.</strong>&nbsp;&nbsp;&nbsp;<img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick2.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick2.jpg" width="14" height="14"> <strong>B</strong> is correct. Because of the <code>limit(2)</code>, we will see the dog names twice, most likely in order. The <code>limit()</code>
 forces the stream to maintain state about the source data, so it is 
likely the stream will retain the original source ordering (although 
that is not guaranteed) even though it’s an unordered parallel stream.</p>
<p class="quep"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/times.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/times.jpg" width="14" height="14"> <strong>A, C, D,</strong> and <strong>E</strong> are incorrect based on the above (OCP Objective 10.6)</p>
<p class="que-q1"><strong><a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11ans18" id="r_ch11ans18">18</a>.</strong>&nbsp;&nbsp;&nbsp;<img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick2.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick2.jpg" width="14" height="14"> <strong>B</strong> is correct. Unlike the previous sample question, we have no <code>limit()</code>
 so we have a stateless stream pipeline. The stream is unordered, and 
the pipeline is executing in parallel, so we cannot predict the ordering
 of the output. Note that if we were using <code>forEachOrdered()</code> instead of <code>forEach()</code> as the terminal operation, it is likely, but not guaranteed, that we would see the results in the same ordering as the source.</p>
<p class="quep"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/times.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/times.jpg" width="14" height="14"> <strong>A, C, D,</strong> and <strong>E</strong> are incorrect based on the above (OCP Objective 10.6)</p>
<p class="que-q1"><strong><a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch11.xhtml#ch11ans19" id="r_ch11ans19">19</a>.</strong>&nbsp;&nbsp;&nbsp;<img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/tick2.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/tick2.jpg" width="14" height="14"> <strong>C</strong> is correct. For a parallel stream, any of the numbers can be multiplied by 2 and returned by <code>findAny()</code>.</p>
<p class="quep"><img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/times.jpg" alt="Images" data-mfp-src="/library/view/ocp-java-se/9781260117370/times.jpg" width="14" height="14"> <strong>A, B, D, E,</strong> and <strong>F</strong> are incorrect based on the above (OCP Objective 10.6)<span id="page_812" epub:type="pagebreak"></span></p>
</section>
<div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-8" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders ">
		
		<li class="copy"><a href="#">Copy</a></li>
		
		<li class="add-highlight"><a href="#">Add Highlight</a></li>
		<li class="add-note"><a href="#">
			
				Add Note
			
		</a></li>
		
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch10.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">10 Threads</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/ocp-java-se/9781260117370/ch12.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">12 JDBC</div>
        </a>
    
  
  </div>

</section>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  




    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel t-subscribe-nag collapsed slideUp">
        
        
          
          
            <p class="usage-data">Find answers on the fly, or master something new. Subscribe today. <a href="https://www.safaribooksonline.com/subscribe/" class="ga-active-trial-subscribe-nag">See pricing options.</a></p>
          

          
        
        

      </div>

    
    



        
      </div>
      




  <footer class="pagefoot t-pagefoot" style="padding-bottom: 69px;">
    <a href="#" class="icon-up" style="display: block;"><div class="visuallyhidden">Back to top</div></a>
    <ul class="js-footer-nav">
      
        <li><a class="t-recommendations-footer" href="https://www.safaribooksonline.com/r/">Recommended</a></li>
      
      <li>
      <a class="t-queue-footer" href="https://www.safaribooksonline.com/playlists/">Playlists</a>
      </li>
      
        <li><a class="t-recent-footer" href="https://www.safaribooksonline.com/history/">History</a></li>
        <li><a class="t-topics-footer" href="https://www.safaribooksonline.com/topics?q=*&amp;limit=21">Topics</a></li>
      
      
        <li><a class="t-tutorials-footer" href="https://www.safaribooksonline.com/tutorials/">Tutorials</a></li>
      
      <li><a class="t-settings-footer js-settings" href="https://www.safaribooksonline.com/u/">Settings</a></li>
      <li class="full-support"><a href="https://www.safaribooksonline.com/public/support">Support</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="https://www.safaribooksonline.com/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright">© 2018 <a href="https://www.safaribooksonline.com/" target="_blank">Safari</a>.</span>
    <a href="https://www.safaribooksonline.com/terms/">Terms of Service</a> /
    <a href="https://www.safaribooksonline.com/privacy/">Privacy Policy</a>
  </footer>

<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"queueTime":10,"beacon":"bam.nr-data.net","licenseKey":"510f1a6865","transactionName":"YgdaZ0NSW0cEB0RdWltNfkZfUEFdCgofXFBHDVYdR1pQQxZeRl1QQj1aWkU=","errorBeacon":"bam.nr-data.net","applicationID":"3275661,67267027,67267028","applicationTime":641,"agent":""}</script>


    
    
      <img src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/a.html" alt="" style="display:none;">
    
    <script src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/a_004" charset="utf-8"></script>
    <script src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/a_005" charset="utf-8"></script>
  

<div class="annotator-notice"></div><div class="font-flyout" style="top: 201px; left: 1354px;"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="#">Reset</a>
</div>
</div><script type="text/javascript" id="">(function(){window.medalliaUserIdentifier=document.documentElement.dataset.userUuid;window.medalliaUserName=document.documentElement.dataset.username})();</script>
<script type="text/javascript" id="" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/embed.js"></script><script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","1732687426968531");fbq("track","PageView");</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=1732687426968531&amp;ev=PageView&amp;noscript=1"></noscript>


<div style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.1246184670167011"><img style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.22773896615689526" alt="" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/0.txt" width="0" height="0"></div><script type="text/javascript" async="" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/generic1536157006019.js" charset="UTF-8"></script><script src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/a_003" type="text/javascript"></script><iframe style="display: none;" src="11%20Concurrency%20-%20OCP%20Java%20SE%208%20Programmer%20II%20Exam%20Guide%20(Exam%201Z0-809),%207th%20Edition_files/pixel.html"></iframe><span><div id="KampyleAnimationContainer" style="z-index: 2147483000; border: 0px none; position: fixed; display: block; width: 0px; height: 0px;"></div></span></body></html>